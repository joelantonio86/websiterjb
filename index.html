<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Racional Jazz Band - M√∫sica, Arte e Cultura</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>


    <script>

        // --- Configura√ß√£o Tailwind ---
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'rjb-yellow': '#FFD700',
                        'rjb-text': '#2A2A2A',
                        'rjb-bg-light': '#F8F9FA',
                        'rjb-card-light': '#FFFFFF',
                        'rjb-bg-dark': '#121212',
                        'rjb-card-dark': '#1E1E1E',
                        'rjb-text-dark': '#E0E0E0',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas'],
                    },
                    boxShadow: {
                        'soft-glow': '0 0 20px rgba(255, 215, 0, 0.6)',
                        'subtle-glow': '0 0 10px rgba(255, 215, 0, 0.2)',
                        'deep-shadow': '0 10px 30px rgba(0, 0, 0, 0.1)',
                    },
                }
            }
        }

        // --- DADOS E VARI√ÅVEIS GLOBAIS ---
        let currentPage = 'home';
        let currentAudio = null;
        let playingButton = null;
        let sortDirection = true; // true = crescente, false = decrescente
        let currentSortColumn = 'name';
        let memberFilters = { name: '', instrument: '', location: '' };
        let lastFetchedData = null; // Cache dos dados dos membros
        let currentMemberPage = 1; // P√°gina atual da pagina√ß√£o de membros
        const MEMBERS_PER_PAGE = 10; // Membros por p√°gina
        let searchDebounceTimer = null; // Timer para debounce de busca

        const subMenuRJB = {
            'apresentacoes': 'Apresenta√ß√µes / Nossas apresenta√ß√µes ',
            'bastidores': 'Ensaios / Pessoas de diversos estados ',
            'repertorio': 'Repert√≥rio/ M√∫sicas originais',
            'partituras': 'Partituras / √Årea Exclusiva para M√∫sicos',
            'fotos': 'Fotos / Fotos de apresenta√ß√µes',
        };

        // Estrutura de v√≠deos organizados por apresenta√ß√£o/data
        const APRESENTACOES_BY_EVENT = [
            {
                date: '2025-10-04',
                dateFormatted: '04 de Outubro de 2025',
                eventTitle: 'Apresenta√ß√£o - Retiro Racional',
                location: 'Retiro Racional - Nova Igua√ßu (RJ)',
                videos: [
                    { title: 'Canto das tr√™s Ra√ßas - Retiro Racional', id: '9n4l2zXi_yE' },
                    { title: 'Do seu lado - Retiro Racional', id: 'ZWNoul_SB0c' },
                ]
            },
            {
                date: '2017-11-04',
                dateFormatted: '04 de Novembro de 2017',
                eventTitle: 'Apresenta√ß√£o - Retiro Racional',
                location: 'Retiro Racional - Nova Igua√ßu (RJ)',
                videos: [
                    { title: 'Oxig√™nio - Retiro Racional', id: 'U5vlHEpb82Q' },
                ]
            },
            // Adicione mais apresenta√ß√µes aqui seguindo o mesmo formato
        ];

        const BASTIDORES_BY_EVENT = [
            {
                date: '2025-12-15',
                dateFormatted: '15 de Dezembro de 2025',
                eventTitle: 'Ensaios e Pr√°ticas',
                location: 'Retiro Racional - Nova Igua√ßu (RJ)',
                videos: [
                    { title: 'Whisky √† go-go', id: 'Cnj23NucMnY' },
                ]
            },
            {
                date: '2025-10-04',
                dateFormatted: '04 de Outubro de 2025',
                eventTitle: 'Ensaios e Pr√°ticas',
                location: 'Retiro Racional - Nova Igua√ßu (RJ)',
                videos: [
                    { title: 'O Dever de Fazer Propaganda Deste Conhecimento', id: 'aCdnUJeLzRQ' },
                    { title: 'Titanium', id: '73XEtc64fdw' },
                    { title: 'Titanium - Guitarra', id: 'pXIKPmZB0IM' },
                    { title: 'Trompeta da Espanha', id: 'RF7dOiaO5cw' },
                    { title: 'Anuncia√ß√£o - Guitarra', id: 'THH7BrWbC6o' },
                ]
            },
            // Adicione mais ensaios aqui seguindo o mesmo formato
        ];
        // index.html: DADOS E VARI√ÅVEIS GLOBAIS
        // Substitua o placeholder pela URL p√∫blica do seu bucket R2
        const R2_BASE_URL = 'https://pub-934c96bc6fb449a7ad7b3491065976d3.r2.dev';
        // OU, se voc√™ usa dom√≠nio pr√≥prio:
        // const R2_BASE_URL = 'https://files.rjb.com.br/sheets';
        const racionais = [
            { title: 'A Consci√™ncia Positiva', time: '3:00', mp3: 'A_Consciencia_Positiva' },
            { title: 'A Luz do Saber', time: '3:00', mp3: 'A_Luz_Do_Saber' },
            { title: 'A Luz que Mudou o Meu Destino', time: '3:00', mp3: 'A_Luz_Que_Mudou_O_Meu_Destino' },
            { title: 'Apoteose Racional', time: '3:00', mp3: 'Apoteose_Racional' },
            { title: 'Cascalho', time: '3:00', mp3: 'Cascalho' },
            //{ title: 'De Onde Veio e Vai', time: '3:00', mp3: 'De_Onde_Veio_e_Vai' },
            { title: 'Deixa Quem Quiser Falar', time: '3:00', mp3: 'Deixa_Quem_Quiser_Falar' },
            { title: 'Desencanto Universal', time: '3:00', mp3: 'Desencanto_Universal' },
            { title: 'Homenagem a Brud', time: '3:00', mp3: 'Homenagem_A_Brud' },
            { title: 'Jubileu de Ouro', time: '3:00', mp3: 'Jubileu_De_Ouro' },
            { title: 'Menino Rei', time: '3:00', mp3: 'Menino_Rei' },
            { title: 'Meu Lugar N√£o √© Aqui', time: '3:00', mp3: 'Meu_Lugar_Nao_E_Aqui' },
            { title: 'Mundo Racional', time: '3:00', mp3: 'Mundo_Racional' },
            { title: 'Natureza', time: '3:00', mp3: 'Natureza' },
            { title: 'O Homem', time: '3:00', mp3: 'O_Homem' },
            //{ title: 'Os Caravaneiros - Em Andamento', time: '3:00', mp3: 'Os_Caravaneiros_Em_Andamento' },
            { title: 'Oxig√™nio - Rosa de Deus', time: '3:00', mp3: 'Oxigenio' },
            { title: 'Oxig√™nio da Vida - Alison Grillo', time: '3:00', mp3: 'Oxigenio_Da_Vida' },
            { title: 'Para√≠so Racional', time: '3:00', mp3: 'Paraiso_Racional' },
            { title: 'Paz Interior', time: '3:00', mp3: 'Paz_Interior' },
            { title: 'Salve o Retiro Racional', time: '3:00', mp3: 'Salve_O_Retiro_Racional' },
            { title: 'Ser Iluminado', time: '3:00', mp3: 'Ser_Iluminado' },
            //{ title: 'Viva a Cultura Racional', time: '3:00', mp3: 'Viva_A_Cultura_Racional' },
        ];

        const diversas = [
            { title: 'Ai Que Saudade Do C√™', time: '3:00', mp3: 'Ai_Que_Saudade_Doce' },
            { title: 'Anuncia√ß√£o', time: '4:10', mp3: 'Anunciacao' },
            { title: '√Åria Cantinela', time: '3:20', mp3: 'Aria_Cantinela' },
            { title: 'As For√ßas da Natureza', time: '4:55', mp3: 'As_Forcas_Da_Natureza' },
            { title: 'Billie Jean', time: '4:50', mp3: 'Billie_Jean' },
            { title: 'Boleto de Ravel', time: '4:50', mp3: 'Bolero_De_Ravel' },
            { title: 'Caruso', time: '4:20', mp3: 'Caruso' },
            { title: 'Cheia de Manias', time: '3:50', mp3: 'Cheia_De_Manias' },
            { title: 'Colo de Menina', time: '3:55', mp3: 'Colo_De_Menina' },
            { title: 'Con te Partir√≥', time: '4:40', mp3: 'Conte_Te_Partiro' },
            { title: 'Daqui Pra Sempre', time: '3:15', mp3: 'Daqui_Pra_Sempre' },
            { title: 'Do Seu Lado', time: '3:35', mp3: 'Do_Seu_Lado' },
            { title: 'Eu S√≥ Quero Um Xod√≥', time: '3:05', mp3: 'Eu_So_Quero_Um_Xodo' },
            { title: 'Felicidade', time: '3:25', mp3: 'Felicidade' },
            { title: 'Fulminante', time: '4:35', mp3: 'Fulminante' },
            { title: 'Game of Thrones', time: '3:40', mp3: 'Game_Of_Thrones' },
            { title: 'Girls Just Want to Have Fun', time: '4:00', mp3: 'Girls_Just_Want_To_Have_Fun' },
            { title: 'Heal the World', time: '5:00', mp3: 'Heal_The_World' },
            { title: 'Menina Carolina', time: '3:10', mp3: 'Menina_Carolina' },
            { title: 'Naquela Mesa', time: '3:58', mp3: 'Naquela_Mesa' },
            { title: 'Olhos Coloridos', time: '3:40', mp3: 'Olhos_Coloridos' },
            { title: 'Ouro Negro', time: '3:55', mp3: 'Ouro_Negro' },
            { title: 'O Canto das Tr√™s Ra√ßas', time: '4:25', mp3: 'O_Canto_Das_Tres_Racas' },
            { title: 'O Homem - Roberto Carlos', time: '4:15', mp3: 'O_Homem_Roberto_Carlos' },
            { title: 'O Rei Le√£o', time: '4:30', mp3: 'O_Rei_Leao' },
            { title: 'Parab√©ns', time: '3:00', mp3: 'Parabens' },
            { title: 'Preciso Me Encontrar', time: '4:02', mp3: 'Preciso_Me_Encontrar' },
            { title: 'Que Nem Mar√©', time: '3:28', mp3: 'Que_Nem_Mare' },
            { title: 'Sweet Child O Mine', time: '5:05', mp3: 'Sweet_Child_O_Mine' },
            { title: 'The Final Countdown', time: '5:10', mp3: 'The_Final_Countdown' },
            { title: 'Titanium', time: '4:40', mp3: 'Titanium' },
            { title: 'Trompeta de Espanha', time: '3:08', mp3: 'Trompeta_De_Espanha' },
            { title: 'Vilarejo', time: '3:18', mp3: 'Vilarejo' },
            { title: 'Whisky a Go Go', time: '3:33', mp3: 'Whisky_A_Go_Go' },
        ];
        // --- FUN√á√ïES DE UTILIDADE GERAL ---
        // index.html (Adicionar no bloco de Fun√ß√µes de Utilidade Geral)

        function toggleLoader(show, message = 'Carregando...') {
            const loader = document.getElementById('loading-overlay');
            const loaderMessage = document.getElementById('loader-message');

            if (!loader || !loaderMessage) return;

            if (show) {
                loaderMessage.textContent = message;
                loader.classList.remove('hidden');
                // For√ßa o reflow para garantir que a transi√ß√£o de opacidade funcione
                void loader.offsetWidth;
                loader.classList.add('opacity-100', 'flex');
                document.body.style.overflow = 'hidden'; // Opcional: trava o scroll
            } else {
                loader.classList.remove('opacity-100');
                loader.classList.add('opacity-0');
                setTimeout(() => {
                    loader.classList.add('hidden');
                    loader.classList.remove('flex');
                    document.body.style.overflow = '';
                }, 300); // Tempo igual √† transi√ß√£o CSS
            }
        }

        function toggleDarkMode() {
            const html = document.documentElement;
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }

        function navigateTo(page) {
            const content = document.getElementById('main-content');
            closeVideoModal();
            stopCurrentAudio();

            if (currentPage === page) {
                window.scrollTo({ top: 0, behavior: 'smooth' });
                return;
            }

            content.classList.add('opacity-0');
            window.scrollTo({ top: 0, behavior: 'smooth' });

            setTimeout(() => {
                currentPage = page;
                renderPage();
                // --- ADICIONE ESTA LINHA ABAIXO ---
                // Se for a home, remove o hash. Se for cadastro, usa um nome amig√°vel.
                const hashName = (page === 'member-registration') ? 'cadastro' : page;
                window.location.hash = (page === 'home') ? '' : hashName;
                content.classList.remove('opacity-0');

                const menu = document.getElementById('mobile-menu');
                if (menu && !menu.classList.contains('hidden')) {
                    document.getElementById('mobile-menu-button').click();
                }
            }, 500);
        }

        function updateActiveMenu() {
            document.querySelectorAll('.nav-link').forEach(btn => {
                btn.classList.remove('nav-link-active');
            });

            const activeLink = document.getElementById(`nav-${currentPage}`);
            if (activeLink) {
                activeLink.classList.add('nav-link-active');
            }

            // Tratamento de links adicionais
            if (currentPage === 'member-registration') {
                const cadastroDesktop = document.getElementById('nav-cadastro-desktop');
                const cadastroMobile = document.getElementById('nav-cadastro-mobile');
                if (cadastroDesktop) cadastroDesktop.classList.add('nav-link-active');
                if (cadastroMobile) cadastroMobile.classList.add('nav-link-active');
            }
            if (currentPage === 'reports') {
                const relatoriosDesktop = document.getElementById('nav-relatorios-desktop');
                const relatoriosMobile = document.getElementById('nav-relatorios-mobile');
                if (relatoriosDesktop) relatoriosDesktop.classList.add('nav-link-active');
                if (relatoriosMobile) relatoriosMobile.classList.add('nav-link-active');
            }

            if (subMenuRJB[currentPage]) {
                const rjbButton = document.getElementById('nav-rjb-dropdown');
                if (rjbButton) rjbButton.classList.add('nav-link-active');
            }
        }

        function stopCurrentAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                currentAudio = null;
            }
            if (playingButton) {
                playingButton.classList.remove('playing');
                playingButton = null;
            }
        }

        function togglePlay(title, mp3File) {
            const button = event.currentTarget;
            const isPlaying = button.classList.contains('playing');

            if (isPlaying) {
                stopCurrentAudio();
                return;
            }

            stopCurrentAudio();

            currentAudio = new Audio(`/audio/${mp3File}.mp3`);
            currentAudio.load();

            playingButton = button;
            button.classList.add('playing');
            currentAudio.play();

            showMessage(`Tocando: ${title}`);

            currentAudio.onended = () => {
                stopCurrentAudio();
            };

            currentAudio.onerror = () => {
                showMessage(`Erro ao carregar o √°udio de: ${title}. Arquivo /audio/${mp3File}.mp3 n√£o encontrado ou inv√°lido.`, true);
                stopCurrentAudio();
            };
        }

        // NOVO: Fun√ß√£o de Play para URLs Externas (R2)
        function togglePlayExternal(title, audioUrl) {
            const button = event.currentTarget;
            const isPlaying = button.classList.contains('playing');

            if (isPlaying) {
                stopCurrentAudio();
                return;
            }

            stopCurrentAudio();

            // CR√çTICO: Usa a URL de √°udio completa que veio como par√¢metro
            currentAudio = new Audio(audioUrl);
            currentAudio.load();

            playingButton = button;
            button.classList.add('playing');
            currentAudio.play();

            showMessage(`Tocando: ${title}`);

            currentAudio.onended = () => {
                stopCurrentAudio();
            };

            currentAudio.onerror = () => {
                showMessage(`Erro ao carregar o √°udio de: ${title}. Arquivo ${audioUrl} n√£o encontrado ou inv√°lido.`, true);
                stopCurrentAudio();
            };
        }

        function openModal(imageUrl) {
            const modal = document.getElementById('image-modal');
            const modalImage = document.getElementById('modal-image');

            modalImage.src = imageUrl;
            modal.classList.remove('hidden');
            void modal.offsetWidth;
            modal.classList.add('opacity-100');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            const modal = document.getElementById('image-modal');
            modal.classList.remove('opacity-100');

            setTimeout(() => {
                modal.classList.add('hidden');
                document.getElementById('modal-image').src = "";
                document.body.style.overflow = '';
            }, 300);
        }

        function openVideoModal(videoId) {
            const modal = document.getElementById('video-modal');
            const iframe = document.getElementById('video-iframe');

            iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0`;

            modal.classList.remove('hidden');
            void modal.offsetWidth;
            modal.classList.add('opacity-100');
            document.body.style.overflow = 'hidden';
        }

        function closeVideoModal() {
            const modal = document.getElementById('video-modal');
            const iframe = document.getElementById('video-iframe');

            modal.classList.remove('opacity-100');

            setTimeout(() => {
                modal.classList.add('hidden');
                iframe.src = ""; // Importante: Limpa o src para parar o som/v√≠deo
                document.body.style.overflow = '';
            }, 300);
        }

        function showMessage(msg, isError = false) {
            const messageBox = document.getElementById('custom-message-box');
            const messageText = document.getElementById('message-text');
            messageText.textContent = msg;

            messageBox.classList.remove('hidden', 'opacity-0', 'message-error', 'bg-rjb-yellow', 'text-rjb-text');

            if (isError) {
                messageBox.classList.add('message-error');
            } else {
                messageBox.classList.add('bg-rjb-yellow', 'text-rjb-text');
            }

            messageBox.classList.add('opacity-100');
            const displayTime = isError ? 5000 : 2500;
            const hideTime = isError ? 5500 : 3000;

            setTimeout(() => {
                messageBox.classList.remove('opacity-100');
                messageBox.classList.add('opacity-0');
            }, displayTime);

            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, hideTime);
        }
        // index.html (Adicionar no bloco de Fun√ß√µes de Utilidade Geral)
        function filterPartituras() {
            const input = document.getElementById('search-input');
            // Normalize o termo de busca para min√∫sculas e sem acentos para uma busca robusta
            const filterText = input.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");

            // Seleciona todos os itens em ambas as listas
            const items = document.querySelectorAll('.sheet-item');

            let totalVisible = 0;

            items.forEach(item => {
                // Pega o t√≠tulo, que √© o primeiro <p> dentro do item
                const titleElement = item.querySelector('p:first-child');
                if (titleElement) {
                    const title = titleElement.textContent.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");

                    if (title.includes(filterText)) {
                        item.style.display = 'flex'; // Torna o item vis√≠vel
                        totalVisible++;
                    } else {
                        item.style.display = 'none'; // Oculta o item
                    }
                }
            });

            // Voc√™ pode adicionar um feedback visual se nenhum item for encontrado
            const noResultsMessage = document.getElementById('no-results-message');
            if (filterText.length > 0 && totalVisible === 0) {
                if (!noResultsMessage) {
                    const div = document.createElement('div');
                    div.id = 'no-results-message';
                    div.innerHTML = '<p class="text-center text-xl text-red-500 mt-8">Nenhuma m√∫sica encontrada com esse nome.</p>';
                    document.querySelector('.space-y-6').appendChild(div);
                }
            } else if (noResultsMessage) {
                noResultsMessage.remove();
            }
        }
        // index.html (Adicionar no bloco de Fun√ß√µes de Utilidade Geral)
        function toggleAccordion(accordionId) {
            const header = document.getElementById(accordionId + '-header');
            const content = document.getElementById(accordionId + '-content');

            if (!header || !content) return;

            // Toggle classes no header
            header.classList.toggle('open');

            // Toggle classes no conte√∫do (accordion-content)
            content.classList.toggle('open');
        }
        // --- FUN√á√ïES DE SUBMISS√ÉO E LOGIN (NOVAS) ---

        async function submitContactForm(event) {
            event.preventDefault();

            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const message = document.getElementById('message').value;

            const endpointUrl = 'https://rjb-email-sender-215755766100.europe-west1.run.app';

            showMessage('Enviando mensagem...');

            const formData = {
                to: 'contato.racionaljazzband@gmail.com',
                subject: `Nova Mensagem da RJB de ${name}`,
                senderName: name,
                senderEmail: email,
                body: message
            };

            try {
                const response = await fetch(endpointUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData),
                });

                if (response.ok) {
                    showMessage('Mensagem enviada com sucesso! Entraremos em contato em breve.');
                    document.getElementById('contact-form').reset();
                } else {
                    const errorDetails = await response.text();
                    console.error('Erro no Backend:', response.status, errorDetails);
                    showMessage(`Falha ao enviar. Erro ${response.status}. Verifique o console.`, true);
                }

            } catch (error) {
                console.error('ERRO DE CONEX√ÉO/REDE:', error);
                showMessage('Erro de conex√£o. O endpoint do backend pode estar incorreto ou offline.', true);
            }
        }

        // Fun√ß√£o para normalizar nomes: primeira letra mai√∫scula, demais min√∫sculas
        function normalizeName(name) {
            if (!name) return '';
            
            return name
                .toLowerCase()
                .split(' ')
                .map(word => {
                    if (word.length === 0) return word;
                    return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
                })
                .join(' ')
                .trim();
        }

        // Fun√ß√£o para normalizar o campo de nome quando o usu√°rio sair dele
        function normalizeNameField(field) {
            if (field && field.value) {
                const normalized = normalizeName(field.value);
                if (normalized !== field.value) {
                    field.value = normalized;
                }
            }
        }

        async function submitMemberRegistration(event) {
            event.preventDefault();

            const inviteKey = document.getElementById('reg-invite-key').value.trim();
            let name = document.getElementById('reg-name').value.trim();
            const tefa = document.getElementById('reg-tefa').value.trim();
            const instrument = document.getElementById('reg-instrument').value.trim();
            const email = document.getElementById('reg-email').value.trim();
            const phone = document.getElementById('reg-phone').value.trim();
            const city = document.getElementById('reg-city').value; // Valor do select
            const state = document.getElementById('reg-state').value; // Valor do select
            const termsVersion = document.getElementById('reg-terms-version').value;
            const termsAccepted = document.getElementById('terms').checked;

            // Normaliza o nome antes de validar
            name = normalizeName(name);
            
            // Atualiza o campo visualmente para o usu√°rio ver a normaliza√ß√£o
            document.getElementById('reg-name').value = name;

            if (!inviteKey || !name || !instrument || !email || !city || !state || !phone) {
                showMessage('Por favor, preencha todos os campos obrigat√≥rios.', true);
                return;
            }

            if (tefa && !/^\d+$/.test(tefa)) {
                showMessage('O campo TEFA deve conter apenas n√∫meros.', true);
                return;
            }

            const endpointUrl = 'https://rjb-email-sender-215755766100.europe-west1.run.app/api/register-member';
            toggleLoader(true, 'Enviando sua inscri√ß√£o...');

            const memberData = { inviteKey, name, tefa, instrument, email, phone, city, state, termsVersion, termsAccepted };

            try {
                const response = await fetch(endpointUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(memberData),
                });

                const result = await response.json();
                if (response.ok) {
                    showMessage(result.message || 'Inscri√ß√£o conclu√≠da!');
                    document.getElementById('member-registration-form').reset();
                    // Reseta o select de cidades ap√≥s sucesso
                    document.getElementById('reg-city').disabled = true;
                    document.getElementById('reg-city').innerHTML = '<option value="">Selecione o Estado primeiro</option>';
                } else {
                    showMessage(result.message || 'Erro no cadastro.', true);
                }
            } catch (error) {
                showMessage('Erro de conex√£o.', true);
            } finally {
                toggleLoader(false);
            }
        }


        // index.html (SUBSTITUIR A FUN√á√ÉO handleAdminLogin)
        async function handleAdminLogin(event) {
            event.preventDefault();

            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            const endpointUrl = 'https://rjb-email-sender-215755766100.europe-west1.run.app/api/admin/login';

            toggleLoader(true, 'Verificando credenciais...'); // üëà ATIVA O LOADER

            try {
                const response = await fetch(endpointUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password }),
                });

                const result = await response.json();

                if (response.ok) {
                    localStorage.setItem('adminToken', result.token);
                    localStorage.setItem('adminRole', result.role);
                    console.log('Login realizado. Role recebido:', result.role);
                    toggleLoader(false); // üëà DESATIVA ANTES DE CARREGAR O RELAT√ìRIO
                    showMessage('Login bem-sucedido. Carregando relat√≥rios...');
                    renderProtectedReportView();
                    // Verifica acesso financeiro ap√≥s renderizar (com delay para garantir que o elemento existe)
                    setTimeout(() => {
                        checkFinanceAccess();
                    }, 300);
                } else {
                    toggleLoader(false); // üëà DESATIVA
                    showMessage(result.message || 'E-mail ou senha incorretos.', true);
                }

            } catch (error) {
                console.error('ERRO DE CONEX√ÉO/REDE ao fazer login:', error);
                toggleLoader(false); // üëà DESATIVA
                showMessage('Erro de conex√£o com a API de login.', true);
            }
        }
        // index.html (SUBSTITUIR A FUN√á√ÉO adminLogout)
        function adminLogout() {
            toggleLoader(true, 'Finalizando sess√£o...'); // üëà ATIVA O LOADER

            // 1. A√ß√£o CR√çTICA: Remove os tokens de acesso.
            localStorage.removeItem('adminToken');
            localStorage.removeItem('adminRole');

            // 2. Espera um breve momento (400ms) para a transi√ß√£o do loader
            setTimeout(() => {
                // 3. CORRE√á√ÉO APLICADA: Navega para a p√°gina Home. 
                navigateTo('home');

                // 4. Desativa o loader ap√≥s a navega√ß√£o ter sido iniciada.
                toggleLoader(false);

                // 5. Mostra a mensagem.
                showMessage('Voc√™ saiu da √Årea Administrativa.', false);
            }, 400);
        }
        // index.html (Adicionar dentro do bloco <script>, perto das outras fun√ß√µes de fetch/render)

        // ... (Fun√ß√µes de fetchMemberReport, renderReportData, etc.) ...

        // --- FUN√á√ïES DE ARQUIVOS (ANEXOS) ---

        // index.html (Aprox. Linha 470)

        // --- FUN√á√ïES DE ARQUIVOS (ANEXOS) ---

        async function fetchAttachmentsReport(token) {
            const endpointUrl = 'https://rjb-email-sender-215755766100.europe-west1.run.app/api/attachments/list';
            const attachmentsArea = document.getElementById('attachments-output-area');

            if (!attachmentsArea) return;

            try {
                const response = await fetch(endpointUrl, {
                    method: 'GET',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();

                if (response.ok) {
                    // Renderiza os arquivos com o bot√£o de excluir
                    if (data.length === 0) {
                        attachmentsArea.innerHTML = '<p class="text-center opacity-50 text-sm">Nenhum arquivo encontrado.</p>';
                        return;
                    }

                    attachmentsArea.innerHTML = data.map(f => `
                <div class="flex items-center justify-between p-3 bg-rjb-bg-light dark:bg-rjb-bg-dark rounded-lg border border-rjb-yellow/10 mb-2">
                    <div class="flex flex-col">
                        <span class="font-medium text-sm truncate max-w-[180px]">${f.name}</span>
                        <span class="text-[10px] opacity-50">${new Date(f.uploaded).toLocaleString()}</span>
                    </div>
                    <div class="flex space-x-3">
                        <a href="${f.downloadUrl}" target="_blank" class="text-rjb-yellow hover:underline text-xs font-bold">BAIXAR</a>
                        <button onclick="deleteAttachment('${f.name}')" class="text-red-500 hover:text-red-700 text-xs font-bold">EXCLUIR</button>
                    </div>
                </div>
            `).join('');
                }
            } catch (error) {
                console.error('Erro ao buscar anexos:', error);
            }
        }
        async function handleFileUpload(event) {
            event.preventDefault();

            const fileInput = document.getElementById('attachment-file');
            const token = localStorage.getItem('adminToken');

            if (!fileInput.files.length) {
                showMessage('Selecione um arquivo para upload.', true);
                return;
            }

            showMessage('Enviando arquivo...', false);

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            const endpointUrl = 'https://rjb-email-sender-215755766100.europe-west1.run.app/api/attachments/upload';

            try {
                const response = await fetch(endpointUrl, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` },
                    body: formData
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage(result.message || 'Arquivo enviado com sucesso!');
                    document.getElementById('file-upload-form').reset();
                    fetchAttachmentsReport(token); // Atualiza a lista
                } else {
                    console.error('Erro no Backend:', response.status, result.message);
                    showMessage(result.message || `Falha no upload. Erro ${response.status}.`, true);
                }

            } catch (error) {
                console.error('ERRO DE CONEX√ÉO/REDE ao fazer upload:', error);
                showMessage('Erro de conex√£o com a API de upload.', true);
            }
        }
        async function deleteAttachment(fileName) {
            if (!confirm(`Deseja realmente excluir o arquivo: ${fileName}?`)) return;

            const token = localStorage.getItem('adminToken');
            const API_BASE = 'https://rjb-email-sender-215755766100.europe-west1.run.app';

            showLoading(true, 'Excluindo arquivo...');

            try {
                const response = await fetch(`${API_BASE}/api/attachments/delete/${encodeURIComponent(fileName)}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    showMessage('Arquivo exclu√≠do com sucesso!');
                    fetchAttachmentsReport(token); // Atualiza a lista automaticamente
                } else {
                    const err = await response.json();
                    showMessage(err.message || 'Erro ao excluir.', true);
                }
            } catch (e) {
                showMessage('Erro de conex√£o ao excluir.', true);
            } finally {
                showLoading(false);
            }
        }
        async function handleDeleteFile(fileName) {
            if (!confirm(`Tem certeza que deseja EXCLUIR o arquivo '${fileName}'? Esta a√ß√£o √© irrevers√≠vel.`)) {
                return;
            }

            const token = localStorage.getItem('adminToken');
            const endpointUrl = `https://rjb-email-sender-215755766100.europe-west1.run.app/api/attachments/delete/${fileName}`;

            showMessage(`Excluindo ${fileName}...`);

            try {
                const response = await fetch(endpointUrl, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage(result.message || 'Arquivo exclu√≠do com sucesso!');
                    fetchAttachmentsReport(token); // Atualiza a lista
                } else {
                    console.error('Erro no Backend:', response.status, result.message);
                    showMessage(result.message || `Falha na exclus√£o. Erro ${response.status}.`, true);
                }

            } catch (error) {
                console.error('ERRO DE CONEX√ÉO/REDE ao deletar:', error);
                showMessage('Erro de conex√£o com a API de exclus√£o.', true);
            }
        }

        let memberToDelete = null;

        let memberToDeleteName = '';
        
        function deleteMember(memberId, memberName) {
            memberToDelete = memberId;
            memberToDeleteName = memberName;
            document.getElementById('delete-member-name').textContent = memberName;
            const modal = document.getElementById('delete-confirm-modal');
            const confirmInput = document.getElementById('confirm-delete-name');
            const confirmBtn = document.getElementById('confirm-delete-btn');
            const errorMsg = document.getElementById('confirm-delete-error');
            
            // Limpa o campo de confirma√ß√£o
            if (confirmInput) {
                confirmInput.value = '';
                confirmInput.oninput = function() {
                    const matches = this.value.trim().toLowerCase() === memberName.toLowerCase();
                    confirmBtn.disabled = !matches;
                    if (matches) {
                        errorMsg.classList.add('hidden');
                        this.classList.remove('border-red-500');
                        this.classList.add('border-green-500');
                    } else if (this.value.trim() !== '') {
                        errorMsg.classList.remove('hidden');
                        this.classList.remove('border-green-500');
                        this.classList.add('border-red-500');
                    } else {
                        errorMsg.classList.add('hidden');
                        this.classList.remove('border-red-500', 'border-green-500');
                    }
                };
            }
            
            if (confirmBtn) {
                confirmBtn.disabled = true;
                confirmBtn.onclick = () => {
                    if (confirmInput && confirmInput.value.trim().toLowerCase() === memberName.toLowerCase()) {
                        executeDelete(memberId);
                    }
                };
            }
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.add('opacity-100');
                if (confirmInput) confirmInput.focus();
            }, 10);
        }

        async function executeDelete(memberId) {
            const token = localStorage.getItem('adminToken');
            const API_BASE = 'https://rjb-email-sender-215755766100.europe-west1.run.app';

            closeDeleteModal();
            toggleLoader(true, 'Excluindo...');

            try {
                // CORRE√á√ÉO: Verifique se a URL termina exatamente com o ID
                const response = await fetch(`${API_BASE}/api/admin/delete-member/${memberId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    showMessage('Membro removido com sucesso!');
                    fetchMemberReport(token); // Recarrega a lista
                } else {
                    const errData = await response.json();
                    showMessage(errData.message || 'Erro ao excluir.', true);
                }
            } catch (e) {
                console.error('Erro na requisi√ß√£o DELETE:', e);
                showMessage('Erro de conex√£o ao tentar excluir.', true);
            } finally {
                toggleLoader(false);
            }
        }

        function renderAttachmentsData(files) {
            const attachmentsArea = document.getElementById('attachments-output-area');

            if (files.length === 0) {
                attachmentsArea.innerHTML = '<p class="text-center text-rjb-text/70 dark:text-rjb-text-dark/70">Nenhum anexo encontrado no Google Cloud Storage.</p>';
                return;
            }

            const formatSize = (bytes) => {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            };

            const fileListHtml = files.map(file => {
                const date = new Date(file.uploaded).toLocaleDateString('pt-BR');
                const time = new Date(file.uploaded).toLocaleTimeString('pt-BR');

                return `
            <div class="flex flex-col sm:flex-row justify-between items-center p-3 rounded-lg bg-rjb-bg-light dark:bg-rjb-bg-dark/50 hover:bg-rjb-yellow/10 dark:hover:bg-rjb-yellow/5 transition-colors duration-300 border-l-4 border-rjb-yellow/50">
                <div class="flex-grow mb-2 sm:mb-0 sm:mr-4">
                    <p class="font-medium text-rjb-text dark:text-rjb-text-dark break-all">${file.name}</p>
                    <p class="text-sm text-rjb-text/60 dark:text-rjb-text-dark/60">${formatSize(file.size)} &bull; ${date} ${time}</p>
                </div>
                <div class="flex space-x-2">
                    <a href="${file.downloadUrl}" target="_blank" download="${file.name}"
                        class="text-sm bg-rjb-yellow text-rjb-text font-bold py-1 px-3 rounded-md hover:bg-yellow-500 transition flex items-center">
                        Download
                    </a>
                    <button onclick="handleDeleteFile('${file.name.replace(/'/g, "\\'")}')"
                        class="text-sm bg-red-600 text-white font-bold py-1 px-3 rounded-md hover:bg-red-700 transition flex items-center">
                        Excluir
                    </button>
                </div>
            </div>
        `;
            }).join('');

            attachmentsArea.innerHTML = `
        <div class="space-y-3">${fileListHtml}</div>
    `;
        }

        async function handleDownloadCSV() {
            const token = localStorage.getItem('adminToken');
            const endpointUrl = 'https://rjb-email-sender-215755766100.europe-west1.run.app/api/reports/members';

            if (!token) {
                showMessage('Erro: Voc√™ n√£o est√° logado.', true);
                return;
            }

            showMessage('Gerando relat√≥rio CSV...');

            try {
                let data;
                
                // Se temos dados em cache, usa-os. Caso contr√°rio, busca da API
                if (lastFetchedData) {
                    data = lastFetchedData;
                } else {
                    const response = await fetch(endpointUrl, {
                        method: 'GET',
                        headers: { 'Authorization': `Bearer ${token}` }
                    });

                    if (!response.ok) {
                        throw new Error('Falha ao buscar dados da API');
                    }

                    data = await response.json();
                }

                // Aplica os filtros ativos
                const filteredMembers = getFilteredMembers(data);
                
                // Fun√ß√£o auxiliar para formatar data
                const formatDate = (submittedAt) => {
                    if (!submittedAt) return '';
                    try {
                        let date;
                        if (submittedAt.toDate && typeof submittedAt.toDate === 'function') {
                            date = submittedAt.toDate();
                        } else if (submittedAt.seconds) {
                            date = new Date(submittedAt.seconds * 1000);
                        } else if (typeof submittedAt === 'string') {
                            date = new Date(submittedAt);
                        } else if (submittedAt instanceof Date) {
                            date = submittedAt;
                        } else {
                            return '';
                        }
                        return date.toLocaleDateString('pt-BR', { 
                            day: '2-digit', 
                            month: '2-digit', 
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                    } catch (e) {
                        return '';
                    }
                };

                // Fun√ß√£o auxiliar para escapar campos CSV
                const escapeCSV = (field) => {
                    if (field === null || field === undefined) return '';
                    const str = String(field);
                    // Se cont√©m v√≠rgula, aspas ou quebra de linha, precisa ser envolvido em aspas
                    if (str.includes(',') || str.includes('"') || str.includes('\n')) {
                        return `"${str.replace(/"/g, '""')}"`;
                    }
                    return str;
                };

                // Ordena os membros filtrados alfabeticamente (para CSV)
                const sortedMembers = [...filteredMembers].sort(sortAlphabetically);

                // Verifica se h√° filtros ativos
                const hasFilters = memberFilters.name || memberFilters.instrument || memberFilters.location;
                
                // Cabe√ßalho do CSV
                let csv = '\ufeff'; // BOM para UTF-8 (Excel)
                csv += 'Relat√≥rio de Membros - Racional Jazz Band\n';
                csv += `Data de Exporta√ß√£o: ${new Date().toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' })}\n`;
                csv += `Total de Membros: ${filteredMembers.length}\n`;
                
                if (hasFilters) {
                    const filterParts = [];
                    if (memberFilters.name) filterParts.push(`Nome: ${memberFilters.name}`);
                    if (memberFilters.instrument) filterParts.push(`Instrumento: ${memberFilters.instrument}`);
                    if (memberFilters.location) filterParts.push(`Localidade: ${memberFilters.location}`);
                    csv += `Filtros Aplicados: ${filterParts.join(' | ')}\n`;
                }
                
                csv += '\n'; // Linha em branco
                
                // Cabe√ßalho das colunas
                csv += 'N¬∫,ID,Nome,TEFA,Instrumento,Email,Telefone,Cidade,Estado,Localidade Completa,Data de Cadastro\n';
                
                // Dados dos membros (numera√ß√£o crescente em ordem alfab√©tica)
                sortedMembers.forEach((member, index) => {
                    const seq = index + 1; // Numera√ß√£o crescente
                    const location = `${member.city || ''}/${member.state || ''}`.trim();
                    const date = formatDate(member.submittedAt);
                    
                    csv += [
                        seq,
                        member.id || '',
                        escapeCSV(member.name || ''),
                        escapeCSV(member.tefa || ''),
                        escapeCSV(member.instrument || ''),
                        escapeCSV(member.email || ''),
                        escapeCSV(member.phone || ''),
                        escapeCSV(member.city || ''),
                        escapeCSV(member.state || ''),
                        escapeCSV(location),
                        escapeCSV(date)
                    ].join(',') + '\n';
                });

                // Cria o blob e faz o download
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                
                const fileName = hasFilters 
                    ? `rjb_relatorio_filtrado_${new Date().toISOString().split('T')[0]}.csv`
                    : `rjb_relatorio_${new Date().toISOString().split('T')[0]}.csv`;
                
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                a.remove();
                window.URL.revokeObjectURL(url);
                
                showMessage(`CSV baixado com sucesso! ${filteredMembers.length} membro(s) exportado(s).`);
            } catch (error) {
                console.error('Erro ao gerar CSV:', error);
                showMessage('Erro ao gerar arquivo CSV.', true);
            }
        }

        function renderProtectedReportView() {
            const token = localStorage.getItem('adminToken');
            const authArea = document.getElementById('admin-login-area');
            const outputArea = document.getElementById('report-output-area');

            if (!authArea || !outputArea) return;

            if (token) {
                authArea.classList.add('hidden');
                outputArea.classList.remove('hidden');
                // Verifica acesso financeiro ap√≥s renderizar a √°rea
                checkFinanceAccess();
                fetchMemberReport(token); // Busca membros e, sequencialmente, anexos
            } else {
                authArea.classList.remove('hidden');
                outputArea.classList.add('hidden');
            }
        }


        // index.html (NOVA VERS√ÉO ROBUSTA DE fetchMemberReport)
        async function fetchMemberReport(token) {
            const endpointUrl = 'https://rjb-email-sender-215755766100.europe-west1.run.app/api/reports/members';
            const reportArea = document.getElementById('member-report-details');

            if (reportArea) {
                reportArea.innerHTML = generateSkeletonScreen('members');
            } else {
                return;
            }

            try {
                const response = await fetch(endpointUrl, {
                    method: 'GET',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();

                if (response.ok) {
                    showMessage('Relat√≥rio carregado com sucesso!');

                    // --- AQUI EST√Å A CORRE√á√ÉO ---
                    lastFetchedData = data; // 1. Salva no cache global
                    processAndRenderMembers(data);// 2. Renderiza com filtros/ordem
                    fetchAttachmentsReport(token); // 3. Busca anexos
                    // ---------------------------

                } else if (response.status === 401 || response.status === 403) {
                    localStorage.removeItem('adminToken');
                    localStorage.removeItem('adminRole');
                    showMessage(data.message || 'Sess√£o expirada. Fa√ßa login novamente.', true);
                    renderProtectedReportView();
                } else {
                    showMessage(data.message || `Erro ${response.status} ao buscar o relat√≥rio.`, true);
                    reportArea.innerHTML = `<p class="text-center text-red-500">Erro: ${data.message || 'Falha ao carregar relat√≥rio de membros.'}</p>`;
                }

            } catch (error) {
                console.error('ERRO DE CONEX√ÉO/REDE:', error);
                showMessage('Erro de conex√£o com a API.', true);
                if (reportArea) reportArea.innerHTML = `<p class="text-center text-red-500">Erro de rede.</p>`;
            }
        }
        // index.html (FUN√á√ÉO renderProtectedReportView CORRIGIDA PARA GARANTIR ESTRUTURA)
        // Fun√ß√£o para verificar acesso financeiro (role 'financeiro' ou 'admin-financeiro')
        function checkFinanceAccess() {
            const role = localStorage.getItem('adminRole');
            const financeLinkArea = document.getElementById('finance-link-area');
            
            // Debug: verificar role
            console.log('[Finance] Verificando acesso. Role atual:', role);
            
            if (financeLinkArea) {
                if (role === 'financeiro' || role === 'admin-financeiro') {
                    financeLinkArea.classList.remove('hidden');
                    console.log('[Finance] ‚úÖ Link financeiro EXIBIDO');
                } else {
                    financeLinkArea.classList.add('hidden');
                    console.log('[Finance] ‚ùå Link financeiro OCULTO - role:', role);
                }
            } else {
                console.log('[Finance] ‚ö†Ô∏è Elemento finance-link-area n√£o encontrado ainda. Tentando novamente...');
                // Tenta novamente ap√≥s um pequeno delay se o elemento n√£o existir
                setTimeout(() => {
                    const retryElement = document.getElementById('finance-link-area');
                    if (retryElement) {
                        console.log('[Finance] ‚úÖ Elemento encontrado na segunda tentativa');
                        if (role === 'financeiro' || role === 'admin-financeiro') {
                            retryElement.classList.remove('hidden');
                            console.log('[Finance] ‚úÖ Link financeiro EXIBIDO (retry)');
                        } else {
                            retryElement.classList.add('hidden');
                            console.log('[Finance] ‚ùå Link financeiro OCULTO (retry) - role:', role);
                        }
                    } else {
                        console.log('[Finance] ‚ùå Elemento ainda n√£o encontrado ap√≥s retry');
                    }
                }, 500);
            }
        }

        function renderProtectedReportView() {
            const token = localStorage.getItem('adminToken');
            const authArea = document.getElementById('admin-login-area');
            const outputArea = document.getElementById('report-output-area');

            if (!authArea || !outputArea) return;

            if (token) {
                authArea.classList.add('hidden');
                outputArea.classList.remove('hidden');
                checkFinanceAccess(); // Verifica acesso financeiro
                // A√ß√£o: Inicia a busca dos relat√≥rios de Membros (que dispara a busca de Anexos)
                fetchMemberReport(token);
            } else {
                authArea.classList.remove('hidden');
                outputArea.classList.add('hidden');
                // Oculta a √°rea de membros se n√£o estiver logado
                document.getElementById('member-report-details').innerHTML = '<p class="text-center text-rjb-text/70 dark:text-rjb-text-dark/70">Carregando relat√≥rio de membros...</p>';
            }
        }

        // Fun√ß√µes auxiliares para obter valores √∫nicos
        function getUniqueInstruments(members) {
            const instruments = new Set();
            members.forEach(m => {
                if (m.instrument && m.instrument.trim()) {
                    instruments.add(m.instrument.trim());
                }
            });
            return Array.from(instruments).sort();
        }

        function getUniqueLocations(members) {
            const locations = new Set();
            members.forEach(m => {
                const location = `${m.city || ''}/${m.state || ''}`.trim();
                if (location && location !== '/') {
                    locations.add(location);
                }
            });
            return Array.from(locations).sort();
        }

        // Fun√ß√£o para calcular n√∫mero sequencial baseado na data de cadastro
        function calculateSequentialNumbers(members) {
            if (!members || members.length === 0) return {};
            
            // Fun√ß√£o auxiliar para converter data do Firestore
            const getDate = (submittedAt) => {
                if (!submittedAt) return new Date(0);
                // Se for um objeto Timestamp do Firestore
                if (submittedAt.toDate && typeof submittedAt.toDate === 'function') {
                    return submittedAt.toDate();
                }
                // Se for uma string ISO
                if (typeof submittedAt === 'string') {
                    return new Date(submittedAt);
                }
                // Se for um objeto Date
                if (submittedAt instanceof Date) {
                    return submittedAt;
                }
                // Se for um objeto com seconds (Timestamp do Firestore serializado)
                if (submittedAt.seconds) {
                    return new Date(submittedAt.seconds * 1000);
                }
                return new Date(0);
            };
            
            // Cria uma c√≥pia e ordena por data de cadastro (mais antigo primeiro)
            const sorted = [...members].sort((a, b) => {
                const dateA = getDate(a.submittedAt);
                const dateB = getDate(b.submittedAt);
                // Se as datas forem iguais, ordena por ID para manter consist√™ncia
                if (dateA.getTime() === dateB.getTime()) {
                    return (a.id || '').localeCompare(b.id || '');
                }
                return dateA - dateB;
            });
            
            // Cria um mapa de ID para n√∫mero sequencial
            const sequenceMap = {};
            sorted.forEach((member, index) => {
                sequenceMap[member.id] = index + 1;
            });
            
            return sequenceMap;
        }

        // Fun√ß√£o auxiliar para atualizar estilo do select baseado no valor
        function updateSelectStyle(selectId, value) {
            const select = document.getElementById(selectId);
            if (select) {
                if (value) {
                    select.classList.remove('text-gray-500', 'dark:text-gray-400');
                    select.classList.add('text-gray-900', 'dark:text-gray-100');
                } else {
                    select.classList.remove('text-gray-900', 'dark:text-gray-100');
                    select.classList.add('text-gray-500', 'dark:text-gray-400');
                }
            }
        }

        // Fun√ß√£o auxiliar para obter dados filtrados (usada pelo PDF)
        function getFilteredMembers(data) {
            if (!data || !data.allMembers) return [];
            
            let filtered = [...data.allMembers];
            
            // Aplicar Filtros com tratamento para nulos
            filtered = filtered.filter(m => {
                const name = (m.name || "").toLowerCase();
                const instrument = (m.instrument || "").toLowerCase();
                const location = `${m.city || ''}/${m.state || ''}`.trim();
                
                const nameMatch = !memberFilters.name || name.includes(memberFilters.name.toLowerCase());
                const instrumentMatch = !memberFilters.instrument || instrument === memberFilters.instrument.toLowerCase();
                const locationMatch = !memberFilters.location || location === memberFilters.location;
                
                return nameMatch && instrumentMatch && locationMatch;
            });
            
            return filtered;
        }

   function renderReportData(data) {
    const reportArea = document.getElementById('member-report-details');
    if (!reportArea) return;

    const totalMembros = data.totalMembers || 0;
    
    // Usa dados originais (n√£o filtrados) para popular os selects
    const originalMembers = (lastFetchedData && lastFetchedData.allMembers) ? lastFetchedData.allMembers : (data.allMembers || []);

    // Vers√£o Mobile: Cards melhorados
    // Numera√ß√£o baseada na ordem alfab√©tica (√≠ndice + 1)
    const membersCardsHtml = data.allMembers && data.allMembers.length > 0 ? data.allMembers.map((m, index) => {
        const sequenceNumber = (data.currentPage - 1) * MEMBERS_PER_PAGE + index + 1;
        return `
        <div class="lg:hidden bg-white dark:bg-rjb-card-dark rounded-xl border border-gray-200 dark:border-gray-700 p-4 shadow-sm hover:shadow-md transition-all duration-300 animate-fade-in overflow-hidden" style="animation-delay: ${index * 50}ms">
            <!-- Cabe√ßalho do Card -->
            <div class="mb-4">
                <div class="flex items-start gap-3">
                    <div class="flex-shrink-0">
                        <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-gradient-to-br from-rjb-yellow/30 to-rjb-yellow/20 text-rjb-yellow font-bold text-sm border-2 border-rjb-yellow/40 shadow-sm">
                            ${sequenceNumber}
                        </span>
                    </div>
                    <div class="flex flex-col flex-1 min-w-0">
                        <h3 class="font-bold text-rjb-text dark:text-rjb-text-dark text-lg leading-tight break-words mb-2">
                            ${m.name}
                        </h3>
                        <div class="flex items-center gap-2">
                            <svg class="w-4 h-4 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path>
                            </svg>
                            <span class="text-sm text-gray-600 dark:text-gray-400 font-medium break-words">${m.instrument}</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Informa√ß√µes do Card -->
            <div class="space-y-3 mb-4">
                <!-- TEFA -->
                <div class="flex items-center">
                    <span class="inline-flex items-center justify-center bg-gradient-to-br from-rjb-yellow/20 via-rjb-yellow/15 to-rjb-yellow/10 dark:text-rjb-yellow text-xs font-bold px-3 py-1.5 rounded-full border border-rjb-yellow/30" style="color: #8B6914;">
                        TEFA: ${m.tefa || '---'}
                    </span>
                </div>
                
                <!-- Localiza√ß√£o -->
                <div class="flex items-start gap-2">
                    <svg class="w-4 h-4 text-gray-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    <span class="text-sm text-gray-600 dark:text-gray-400 font-medium break-words flex-1">${m.city || ''}/${m.state || ''}</span>
                </div>
                
                <!-- WhatsApp -->
                ${m.phone ? `
                <div class="flex items-center gap-2">
                    <a href="https://wa.me/55${(m.phone || '').replace(/\D/g, '')}" target="_blank" 
                       class="inline-flex items-center gap-2 text-green-600 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300 transition-colors text-sm font-medium">
                        <svg class="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                        </svg>
                        <span class="break-all">${m.phone}</span>
                    </a>
                </div>
                ` : ''}
            </div>
            
            <!-- Bot√µes de a√ß√£o na √∫ltima linha -->
            <div class="flex justify-end gap-2 pt-3 border-t border-gray-100 dark:border-gray-700">
                <button onclick="editMember('${m.id}', '${m.name.replace(/'/g, "\\'")}', '${m.instrument.replace(/'/g, "\\'")}', '${m.city || ''}', '${m.state || ''}', '${m.tefa || ''}', '${m.phone || ''}')"
                    class="p-2 rounded-lg bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 hover:bg-blue-600 hover:text-white dark:hover:bg-blue-600 transition-all shadow-sm flex-shrink-0" title="Editar">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                </button>
                <button onclick="deleteMember('${m.id}', '${m.name.replace(/'/g, "\\'")}')" 
                    class="p-2 rounded-lg bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400 hover:bg-red-600 hover:text-white dark:hover:bg-red-600 transition-all shadow-sm flex-shrink-0" title="Excluir">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-4v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                </button>
            </div>
        </div>
    `;
    }).join('') : generateEmptyState('members', 'mobile');

    // Vers√£o Desktop: Tabela otimizada
    // Numera√ß√£o baseada na ordem alfab√©tica (√≠ndice + 1)
    const membersListHtml = data.allMembers && data.allMembers.length > 0 ? data.allMembers.map((m, index) => {
        const sequenceNumber = (data.currentPage - 1) * MEMBERS_PER_PAGE + index + 1;
        return `
        <tr class="hidden lg:table-row border-b border-gray-100 dark:border-gray-700/50 hover:bg-gradient-to-r hover:from-rjb-yellow/5 hover:to-transparent transition-all duration-300 group animate-fade-in" style="animation-delay: ${index * 50}ms">
            <td class="p-3 px-4 text-center">
                <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-gradient-to-br from-rjb-yellow/30 to-rjb-yellow/20 text-rjb-yellow font-bold text-sm border-2 border-rjb-yellow/40 shadow-sm">
                    ${sequenceNumber}
                </span>
            </td>
            <td class="p-3 px-4">
                <span class="font-semibold text-rjb-text dark:text-rjb-text-dark text-sm leading-relaxed break-words" style="word-break: break-word; line-height: 1.5;">${m.name}</span>
            </td>
            <td class="p-3 px-4">
                <div class="flex items-start gap-1.5">
                    <svg class="w-4 h-4 text-gray-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path>
                    </svg>
                    <span class="text-sm text-gray-700 dark:text-gray-300 font-medium leading-relaxed break-words" style="word-break: break-word; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; max-height: 3em;">${m.instrument}</span>
                </div>
            </td>
            <td class="p-3 px-4">
                <span class="inline-flex items-center justify-center bg-gradient-to-br from-rjb-yellow/20 via-rjb-yellow/15 to-rjb-yellow/10 dark:text-rjb-yellow text-xs font-bold px-2.5 py-1 rounded-full border border-rjb-yellow/30 shadow-sm" style="color: #8B6914;">
                    ${m.tefa || '---'}
                </span>
            </td>
            <td class="p-3 px-4">
                <div class="flex items-start gap-1.5">
                    <svg class="w-4 h-4 text-gray-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    <span class="text-sm text-gray-700 dark:text-gray-300 leading-relaxed break-words" style="word-break: break-word; line-height: 1.5;">${m.city || ''}/${m.state || ''}</span>
                </div>
            </td>
            <td class="p-3 px-4">
                ${m.phone ? (() => {
                    const phoneMatch = m.phone.match(/\((\d+)\)\s*(.+)/);
                    const areaCode = phoneMatch ? phoneMatch[1] : '';
                    const phoneNumber = phoneMatch ? phoneMatch[2] : m.phone.replace(/\([^)]*\)\s*/, '');
                    return `
                <a href="https://wa.me/55${(m.phone || '').replace(/\D/g, '')}" target="_blank" 
                   class="inline-block font-mono text-sm text-green-600 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300 transition-colors">
                    <div class="flex items-center gap-1.5 mb-0.5">
                        <svg class="w-4 h-4 group-hover/link:scale-110 transition-transform flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                        </svg>
                        <span class="hover:underline">${areaCode ? `(${areaCode})` : ''}</span>
                    </div>
                    <div class="pl-5.5">
                        <span class="hover:underline">${phoneNumber}</span>
                    </div>
                </a>
                `;
                })() : '<span class="text-gray-400 text-sm">---</span>'}
            </td>
            <td class="p-3 pr-4 text-right">
                <div class="flex flex-col items-end gap-1 opacity-100">
                    <button onclick="editMember('${m.id}', '${m.name.replace(/'/g, "\\'")}', '${m.instrument.replace(/'/g, "\\'")}', '${m.city || ''}', '${m.state || ''}', '${m.tefa || ''}', '${m.phone || ''}')"
                        class="p-1.5 rounded-lg bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 hover:bg-blue-600 hover:text-white dark:hover:bg-blue-600 transition-all shadow-sm flex-shrink-0" title="Editar">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                    </button>
                    <button onclick="deleteMember('${m.id}', '${m.name.replace(/'/g, "\\'")}')" 
                        class="p-1.5 rounded-lg bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400 hover:bg-red-600 hover:text-white dark:hover:bg-red-600 transition-all shadow-sm flex-shrink-0" title="Excluir">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-4v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                    </button>
                </div>
            </td>
        </tr>
    `;
    }).join('') : generateEmptyState('members', 'desktop');

    // Gerar controles de pagina√ß√£o
    const paginationHTML = generateMemberPaginationControls(data.totalPages || 1, data.totalFiltered || data.allMembers?.length || 0);

    reportArea.innerHTML = `
        <div class="bg-gradient-to-br from-white via-gray-50 to-rjb-yellow/5 dark:from-rjb-bg-dark dark:via-rjb-bg-dark/90 dark:to-rjb-yellow/5 p-6 sm:p-8 lg:p-10 rounded-xl sm:rounded-2xl mb-4 sm:mb-6 border border-gray-200/50 dark:border-rjb-yellow/10 shadow-lg backdrop-blur-sm">
            <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 sm:gap-6">
                <div class="flex items-center gap-3 sm:gap-4 w-full lg:w-auto">
                    <div class="w-12 h-12 sm:w-14 sm:h-14 rounded-lg sm:rounded-xl bg-gradient-to-br from-rjb-yellow to-rjb-yellow/80 flex items-center justify-center shadow-lg flex-shrink-0">
                        <svg class="w-6 h-6 sm:w-7 sm:h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                    </div>
                    <div class="flex-1 min-w-0">
                        <h3 class="text-lg sm:text-xl lg:text-2xl font-black text-rjb-text dark:text-rjb-text-dark uppercase tracking-tight mb-1 truncate">Membros Cadastrados</h3>
                        <div class="flex items-center gap-2 flex-wrap">
                            <span class="inline-flex items-center px-2 sm:px-3 py-1 rounded-full text-xs sm:text-sm font-bold bg-gradient-to-r from-rjb-yellow/20 to-rjb-yellow/10 text-rjb-yellow border border-rjb-yellow/30">
                                <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-1.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"></path>
                                    <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                                <span class="whitespace-nowrap">Total: ${totalMembros}</span>
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="flex flex-col gap-3 sm:gap-4 w-full lg:w-auto">
                    <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 w-full">
                        <div class="relative flex-grow w-full sm:min-w-[200px] lg:min-w-[250px]">
                             <span class="absolute inset-y-0 left-0 pl-3 sm:pl-4 flex items-center pointer-events-none text-gray-400 dark:text-gray-500">
                                <svg class="h-4 w-4 sm:h-5 sm:w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                            </span>
                            <input type="text" placeholder="Buscar por nome..." value="${memberFilters.name}" 
                                class="pl-10 sm:pl-12 pr-3 sm:pr-4 w-full py-2.5 sm:py-3 text-sm rounded-lg sm:rounded-xl border-2 border-gray-200 dark:border-gray-700 dark:bg-rjb-bg-dark/50 focus:border-rjb-yellow focus:ring-2 sm:focus:ring-4 focus:ring-rjb-yellow/20 outline-none transition-all shadow-sm hover:shadow-md" 
                                oninput="debounceSearch(() => { memberFilters.name = this.value; currentMemberPage = 1; processAndRenderMembers(lastFetchedData); })">
                        </div>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 w-full">
                        <div class="relative flex-grow w-full sm:min-w-[150px]">
                            <span class="absolute inset-y-0 left-0 pl-3 sm:pl-4 flex items-center pointer-events-none text-gray-400 dark:text-gray-500">
                                <svg class="h-4 w-4 sm:h-5 sm:w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path></svg>
                            </span>
                            <select id="filter-instrument" 
                                class="pl-10 sm:pl-12 pr-8 sm:pr-10 w-full py-2.5 sm:py-3 text-sm rounded-lg sm:rounded-xl border-2 border-gray-200 dark:border-gray-700 dark:bg-rjb-bg-dark/50 focus:border-rjb-yellow focus:ring-2 sm:focus:ring-4 focus:ring-rjb-yellow/20 outline-none transition-all shadow-sm hover:shadow-md appearance-none bg-white dark:bg-rjb-bg-dark/50 cursor-pointer ${!memberFilters.instrument ? 'text-gray-500 dark:text-gray-400' : 'text-gray-900 dark:text-gray-100'}"
                                onchange="memberFilters.instrument = this.value; currentMemberPage = 1; processAndRenderMembers(lastFetchedData); updateSelectStyle('filter-instrument', this.value);">
                                <option value="" ${!memberFilters.instrument ? 'selected' : ''} class="text-gray-500">Filtrar por instrumento...</option>
                                ${getUniqueInstruments(originalMembers).map(inst => 
                                    `<option value="${inst}" ${memberFilters.instrument === inst ? 'selected' : ''} class="text-gray-900 dark:text-gray-100">${inst}</option>`
                                ).join('')}
                            </select>
                        </div>
                        <div class="relative flex-grow w-full sm:min-w-[150px]">
                            <span class="absolute inset-y-0 left-0 pl-3 sm:pl-4 flex items-center pointer-events-none text-gray-400 dark:text-gray-500">
                                <svg class="h-4 w-4 sm:h-5 sm:w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                            </span>
                            <select id="filter-location" 
                                class="pl-10 sm:pl-12 pr-8 sm:pr-10 w-full py-2.5 sm:py-3 text-sm rounded-lg sm:rounded-xl border-2 border-gray-200 dark:border-gray-700 dark:bg-rjb-bg-dark/50 focus:border-rjb-yellow focus:ring-2 sm:focus:ring-4 focus:ring-rjb-yellow/20 outline-none transition-all shadow-sm hover:shadow-md appearance-none bg-white dark:bg-rjb-bg-dark/50 cursor-pointer ${!memberFilters.location ? 'text-gray-500 dark:text-gray-400' : 'text-gray-900 dark:text-gray-100'}"
                                onchange="memberFilters.location = this.value; currentMemberPage = 1; processAndRenderMembers(lastFetchedData); updateSelectStyle('filter-location', this.value);">
                                <option value="" ${!memberFilters.location ? 'selected' : ''} class="text-gray-500">Filtrar por localidade...</option>
                                ${getUniqueLocations(originalMembers).map(loc => 
                                    `<option value="${loc}" ${memberFilters.location === loc ? 'selected' : ''} class="text-gray-900 dark:text-gray-100">${loc}</option>`
                                ).join('')}
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bot√µes de A√ß√£o - Nova linha separada -->
            <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                <button onclick="handleDownloadCSV()" class="inline-flex items-center justify-center gap-2 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white px-4 py-2.5 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg transform hover:scale-105 active:scale-95 text-sm font-medium flex-1 sm:flex-none sm:min-w-[100px]" title="Exportar CSV">
                    <svg class="w-4 h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                    <span>CSV</span>
                </button>
                <button onclick="downloadPDF()" class="inline-flex items-center justify-center gap-2 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white px-4 py-2.5 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg transform hover:scale-105 active:scale-95 text-sm font-medium flex-1 sm:flex-none sm:min-w-[100px]" title="Exportar PDF">
                    <svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                    <span>PDF</span>
                </button>
                <button onclick="clearFilters()" class="inline-flex items-center justify-center gap-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 px-4 py-2.5 rounded-lg transition-all duration-300 shadow-sm hover:shadow-md transform hover:scale-105 active:scale-95 text-sm font-medium flex-1 sm:flex-none sm:min-w-[100px]" title="Limpar Filtros">
                    <svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    <span>Limpar</span>
                </button>
            </div>
        </div>

        <!-- Vers√£o Mobile: Cards -->
        <div class="lg:hidden space-y-3">
            ${membersCardsHtml}
        </div>

        <!-- Vers√£o Desktop: Tabela otimizada sem scroll -->
        <div class="hidden lg:block rounded-xl border border-gray-200/50 dark:border-rjb-yellow/10 shadow-xl bg-white dark:bg-rjb-card-dark backdrop-blur-sm">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-gradient-to-br from-amber-300 via-amber-300/95 to-amber-300/90 text-rjb-text dark:text-rjb-text-dark text-xs uppercase font-black tracking-wider shadow-lg relative">
                        <th class="p-3 px-4 text-center rounded-tl-xl relative whitespace-nowrap" style="width: 60px;">
                            <div class="flex items-center justify-center">
                                <span class="text-white drop-shadow-sm text-xs">N¬∫</span>
                            </div>
                        </th>
                        <th class="p-3 px-4 cursor-pointer group relative transition-all duration-300 hover:bg-rjb-yellow/20 hover:shadow-inner" onclick="handleSort('name')">
                            <div class="flex items-center gap-2">
                                <span class="text-white drop-shadow-sm text-xs">Membro</span>
                                <div class="flex flex-col items-center justify-center">
                                    ${currentSortColumn === 'name' ? `
                                    <svg class="w-3 h-3 text-white ${sortDirection ? '' : 'transform rotate-180'}" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                                    </svg>
                                    ` : `
                                    <svg class="w-3 h-3 text-white/50" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M5 12a1 1 0 102 0V6.414l1.293 1.293a1 1 0 001.414-1.414l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L5 6.414V12zM15 8a1 1 0 10-2 0v5.586l-1.293-1.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L15 13.586V8z"></path>
                                    </svg>
                                    `}
                                </div>
                            </div>
                        </th>
                        <th class="p-3 px-4 cursor-pointer group relative transition-all duration-300 hover:bg-rjb-yellow/20 hover:shadow-inner" onclick="handleSort('instrument')">
                            <div class="flex items-center gap-2">
                                <span class="text-white drop-shadow-sm text-xs">Instrumento</span>
                                <div class="flex flex-col items-center justify-center">
                                    ${currentSortColumn === 'instrument' ? `
                                    <svg class="w-3 h-3 text-white ${sortDirection ? '' : 'transform rotate-180'}" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                                    </svg>
                                    ` : `
                                    <svg class="w-3 h-3 text-white/50" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M5 12a1 1 0 102 0V6.414l1.293 1.293a1 1 0 001.414-1.414l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L5 6.414V12zM15 8a1 1 0 10-2 0v5.586l-1.293-1.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L15 13.586V8z"></path>
                                    </svg>
                                    `}
                                </div>
                            </div>
                        </th>
                        <th class="p-3 px-4 relative whitespace-nowrap" style="width: 90px;">
                            <div class="flex items-center">
                                <span class="text-white drop-shadow-sm text-xs">TEFA</span>
                            </div>
                        </th>
                        <th class="p-3 px-4 cursor-pointer group relative transition-all duration-300 hover:bg-rjb-yellow/20 hover:shadow-inner" onclick="handleSort('location')">
                            <div class="flex items-center gap-2">
                                <span class="text-white drop-shadow-sm text-xs">Localidade</span>
                                <div class="flex flex-col items-center justify-center">
                                    ${currentSortColumn === 'location' ? `
                                    <svg class="w-3 h-3 text-white ${sortDirection ? '' : 'transform rotate-180'}" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                                    </svg>
                                    ` : `
                                    <svg class="w-3 h-3 text-white/50" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M5 12a1 1 0 102 0V6.414l1.293 1.293a1 1 0 001.414-1.414l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L5 6.414V12zM15 8a1 1 0 10-2 0v5.586l-1.293-1.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L15 13.586V8z"></path>
                                    </svg>
                                    `}
                                </div>
                            </div>
                        </th>
                        <th class="p-3 px-4 relative">
                            <div class="flex items-center">
                                <span class="text-white drop-shadow-sm text-xs">WhatsApp</span>
                            </div>
                        </th>
                        <th class="p-3 pr-4 text-right rounded-tr-xl relative" style="width: 70px;">
                            <div class="flex items-center justify-end">
                                <span class="text-white drop-shadow-sm text-xs">Gerenciar</span>
                            </div>
                        </th>
                    </tr>
                </thead>
                <tbody class="text-rjb-text dark:text-rjb-text-dark/80 divide-y divide-gray-100 dark:divide-gray-700/50">${membersListHtml}</tbody>
            </table>
        </div>
        ${paginationHTML}
    `;
    
    // Atualiza estilos dos selects ap√≥s renderiza√ß√£o
    setTimeout(() => {
        updateSelectStyle('filter-instrument', memberFilters.instrument);
        updateSelectStyle('filter-location', memberFilters.location);
    }, 100);
}

        // Gerar controles de pagina√ß√£o para membros
        function generateMemberPaginationControls(totalPages, totalItems) {
            if (totalPages <= 1) return '';
            
            const startItem = (currentMemberPage - 1) * MEMBERS_PER_PAGE + 1;
            const endItem = Math.min(currentMemberPage * MEMBERS_PER_PAGE, totalItems);
            
            let paginationHTML = `
                <div class="mt-6 flex flex-col sm:flex-row items-center justify-between gap-4 pt-4 border-t border-rjb-yellow/20">
                    <div class="text-sm text-rjb-text/70 dark:text-rjb-text-dark/70">
                        Mostrando <span class="font-semibold">${startItem}</span> a <span class="font-semibold">${endItem}</span> de <span class="font-semibold">${totalItems}</span> membros
                    </div>
                    <div class="flex items-center gap-2">
                        <button 
                            onclick="changeMemberPage(${currentMemberPage - 1})" 
                            ${currentMemberPage === 1 ? 'disabled' : ''}
                            class="px-3 py-2 text-sm font-medium text-rjb-text dark:text-rjb-text-dark bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/30 rounded-lg hover:bg-rjb-yellow/10 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
                            Anterior
                        </button>
                        <div class="flex items-center gap-1">
            `;
            
            // Mostrar n√∫meros de p√°gina (m√°ximo 5 p√°ginas vis√≠veis)
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentMemberPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage < maxVisiblePages - 1) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            // Bot√£o primeira p√°gina
            if (startPage > 1) {
                paginationHTML += `
                    <button onclick="changeMemberPage(1)" class="px-3 py-2 text-sm font-medium text-rjb-text dark:text-rjb-text-dark bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/30 rounded-lg hover:bg-rjb-yellow/10 transition-all">
                        1
                    </button>
                `;
                if (startPage > 2) {
                    paginationHTML += `<span class="px-2 text-rjb-text/50 dark:text-rjb-text-dark/50">...</span>`;
                }
            }
            
            // N√∫meros de p√°gina
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <button 
                        onclick="changeMemberPage(${i})" 
                        ${i === currentMemberPage ? 'class="px-3 py-2 text-sm font-medium text-white bg-rjb-yellow border border-rjb-yellow rounded-lg transition-all"' : 'class="px-3 py-2 text-sm font-medium text-rjb-text dark:text-rjb-text-dark bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/30 rounded-lg hover:bg-rjb-yellow/10 transition-all"'}
                    >
                        ${i}
                    </button>
                `;
            }
            
            // Bot√£o √∫ltima p√°gina
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    paginationHTML += `<span class="px-2 text-rjb-text/50 dark:text-rjb-text-dark/50">...</span>`;
                }
                paginationHTML += `
                    <button onclick="changeMemberPage(${totalPages})" class="px-3 py-2 text-sm font-medium text-rjb-text dark:text-rjb-text-dark bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/30 rounded-lg hover:bg-rjb-yellow/10 transition-all">
                        ${totalPages}
                    </button>
                `;
            }
            
            paginationHTML += `
                        </div>
                        <button 
                            onclick="changeMemberPage(${currentMemberPage + 1})" 
                            ${currentMemberPage === totalPages ? 'disabled' : ''}
                            class="px-3 py-2 text-sm font-medium text-rjb-text dark:text-rjb-text-dark bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/30 rounded-lg hover:bg-rjb-yellow/10 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
                            Pr√≥xima
                        </button>
                    </div>
                </div>
            `;
            
            return paginationHTML;
        }

        // Mudar p√°gina de membros
        function changeMemberPage(page) {
            if (!lastFetchedData) return;
            
            const filtered = getFilteredMembers(lastFetchedData);
            const totalPages = Math.ceil(filtered.length / MEMBERS_PER_PAGE);
            
            if (page < 1 || page > totalPages) return;
            
            currentMemberPage = page;
            processAndRenderMembers(lastFetchedData);
            
            // Scroll suave para o topo
            const reportArea = document.getElementById('member-report-details');
            if (reportArea) {
                reportArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        async function submitEditMember(event) {
            event.preventDefault();
            const memberId = document.getElementById('edit-member-id').value;
            
            // Normaliza o nome antes de enviar
            let memberName = document.getElementById('edit-member-name').value.trim();
            memberName = normalizeName(memberName);
            
            const updatedData = {
                name: memberName,
                tefa: document.getElementById('edit-member-tefa').value,
                phone: document.getElementById('edit-member-phone').value, // Novo
                instrument: document.getElementById('edit-member-instrument').value,
                city: document.getElementById('edit-member-city').value,
                state: document.getElementById('edit-member-state').value.toUpperCase()
            };
            
            // Atualiza o campo visualmente
            document.getElementById('edit-member-name').value = memberName;

            const token = localStorage.getItem('adminToken');
            const API_BASE = 'https://rjb-email-sender-215755766100.europe-west1.run.app';

            closeEditModal();
            toggleLoader(true, 'Salvando altera√ß√µes...');

            try {
                const response = await fetch(`${API_BASE}/api/admin/update-member/${memberId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(updatedData)
                });

                if (response.ok) {
                    showMessage('Cadastro atualizado com sucesso!');
                    fetchMemberReport(token);
                } else {
                    const err = await response.json();
                    showMessage(err.message || 'Erro ao atualizar dados.', true);
                }
            } catch (e) {
                console.error('Erro na requisi√ß√£o PUT:', e);
                showMessage('Erro de conex√£o com o servidor.', true);
            } finally {
                toggleLoader(false);
            }
        }

        // Fun√ß√£o para normalizar todos os nomes dos membros cadastrados
        async function normalizeAllMemberNames() {
            const token = localStorage.getItem('adminToken');
            if (!token) {
                showMessage('Voc√™ precisa estar logado para executar esta a√ß√£o.', true);
                return;
            }

            // Confirma√ß√£o antes de executar
            const confirmed = confirm('Esta a√ß√£o ir√° normalizar todos os nomes em caixa alta para o formato padr√£o (Primeira Letra Mai√∫scula).\n\nDeseja continuar?');
            if (!confirmed) return;

            const API_BASE = 'https://rjb-email-sender-215755766100.europe-west1.run.app';
            toggleLoader(true, 'Buscando membros...');

            try {
                // 1. Busca todos os membros
                const response = await fetch(`${API_BASE}/api/reports/members`, {
                    method: 'GET',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!response.ok) {
                    throw new Error('Erro ao buscar membros');
                }

                const data = await response.json();
                const members = data.allMembers || [];

                if (members.length === 0) {
                    toggleLoader(false);
                    showMessage('Nenhum membro encontrado.', true);
                    return;
                }

                // 2. Identifica membros que precisam ser normalizados
                const membersToUpdate = members.filter(m => {
                    if (!m.name) return false;
                    const normalized = normalizeName(m.name);
                    return normalized !== m.name && normalized.length > 0;
                });

                if (membersToUpdate.length === 0) {
                    toggleLoader(false);
                    showMessage('Todos os nomes j√° est√£o normalizados!', false);
                    return;
                }

                // 3. Atualiza cada membro
                toggleLoader(true, `Normalizando ${membersToUpdate.length} membro(s)...`);
                let successCount = 0;
                let errorCount = 0;

                for (let i = 0; i < membersToUpdate.length; i++) {
                    const member = membersToUpdate[i];
                    const normalizedName = normalizeName(member.name);
                    
                    toggleLoader(true, `Normalizando ${i + 1} de ${membersToUpdate.length}: ${member.name} ‚Üí ${normalizedName}`);

                    try {
                        const updateResponse = await fetch(`${API_BASE}/api/admin/update-member/${member.id}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            body: JSON.stringify({
                                name: normalizedName,
                                tefa: member.tefa || '',
                                phone: member.phone || '',
                                instrument: member.instrument || '',
                                city: member.city || '',
                                state: member.state || ''
                            })
                        });

                        if (updateResponse.ok) {
                            successCount++;
                        } else {
                            errorCount++;
                            console.error(`Erro ao atualizar membro ${member.id}:`, await updateResponse.text());
                        }
                    } catch (error) {
                        errorCount++;
                        console.error(`Erro ao atualizar membro ${member.id}:`, error);
                    }

                    // Pequeno delay para n√£o sobrecarregar o servidor
                    await new Promise(resolve => setTimeout(resolve, 100));
                }

                toggleLoader(false);
                
                if (successCount > 0) {
                    showMessage(`${successCount} nome(s) normalizado(s) com sucesso!${errorCount > 0 ? ` ${errorCount} erro(s).` : ''}`, errorCount > 0);
                    // Recarrega a lista de membros
                    fetchMemberReport(token);
                } else {
                    showMessage('Nenhum nome foi atualizado. Verifique os logs para mais detalhes.', true);
                }

            } catch (error) {
                console.error('Erro ao normalizar nomes:', error);
                toggleLoader(false);
                showMessage('Erro ao normalizar nomes. Verifique o console para mais detalhes.', true);
            }
        }

        function generateVideoCard(video) {
            const thumbnailUrl = `https://img.youtube.com/vi/${video.id}/maxresdefault.jpg`;
            return `
        <div class="group relative rounded-xl overflow-hidden shadow-lg transition-all duration-500 hover:shadow-soft-glow hover:scale-[1.02] border border-rjb-yellow/10 bg-gray-50 dark:bg-rjb-card-dark/50">
            <div class="video-thumbnail-container" onclick="openVideoModal('${video.id}')">
                <img src="${thumbnailUrl}" alt="${video.title}" loading="lazy" class="video-thumbnail-img" data-fallback-level="0" onerror="handleVideoFallback(this, '${video.id}')">
                <div class="play-icon-overlay"><svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z" fill="white"></path></svg></div>
            </div>
            <div class="p-3 sm:p-4">
                <h3 class="text-base sm:text-lg font-bold text-rjb-text dark:text-rjb-text-dark leading-tight mb-1 break-words">${video.title}</h3>
                <p class="text-rjb-yellow text-xs sm:text-sm font-mono">${video.date}</p>
            </div>
        </div>
    `;
        }

        // --- FUN√á√ïES DE GERA√á√ÉO DE CONTE√öDO ---

        function generateHomePageWrapper() { /* (MANTIDO) */ return `
    <section id="home-background-section" class="relative">
        <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            ${generateHomePage()}
        </div>
    </section>
    <section class="bg-rjb-bg-light dark:bg-rjb-bg-dark max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-20 mt-[-5rem] relative z-20">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
            <div class="p-6 rounded-xl bg-rjb-card-light dark:bg-rjb-card-dark shadow-deep-shadow dark:shadow-xl dark:shadow-black/50 border-t-4 border-rjb-yellow/70 transition-all duration-300 hover:shadow-soft-glow dark:hover:shadow-soft-glow">
                <svg class="w-10 h-10 mx-auto mb-3 text-rjb-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6h.01M21 3h.01"></path></svg>
                <h3 class="text-xl font-semibold mb-2 text-rjb-text dark:text-rjb-text-dark">M√∫sica Instrumental</h3>
                <p class="text-rjb-text/70 dark:text-rjb-text-dark/70">A harmonia perfeita entre os instrumentos e o saber.</p>
            </div>
            <div class="p-6 rounded-xl bg-rjb-card-light dark:bg-rjb-card-dark shadow-deep-shadow dark:shadow-xl dark:shadow-black/50 border-t-4 border-rjb-yellow/70 transition-all duration-300 hover:shadow-soft-glow dark:hover:shadow-soft-glow">
                <svg class="w-10 h-10 mx-auto mb-3 text-rjb-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7v8l4-2 4 2V7m0 8a2 2 0 11-4 0 2 2 0 014 0zM12 11c0 1.657-1.343 3-3 3H5a2 2 0 01-2-2v-3a2 2 0 012-2h4a2 2 0 012 2v1zM21 17a2 2 0 01-2 2h-5m-7-2a2 2 0 01-2-2V7a2 2 0 012-2h5a2 2 0 012 2v5"></path></svg>
                <h3 class="text-xl font-semibold mb-2 text-rjb-text dark:text-rjb-text-dark">Repert√≥rio √önico</h3>
                <p class="text-rjb-text/70 dark:text-rjb-text-dark/70">Composi√ß√µes pr√≥prias e arranjos exclusivos da cultura Racional.</p>
            </div>
            <div class="p-6 rounded-xl bg-rjb-card-light dark:bg-rjb-card-dark shadow-deep-shadow dark:shadow-xl dark:shadow-black/50 border-t-4 border-rjb-yellow/70 transition-all duration-300 hover:shadow-soft-glow dark:hover:shadow-soft-glow">
                <svg class="w-10 h-10 mx-auto mb-3 text-rjb-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <h3 class="text-xl font-semibold mb-2 text-rjb-text dark:text-rjb-text-dark">Compromisso Cultural</h3>
                <p class="text-rjb-text/70 dark:text-rjb-text-dark/70">Divulgando a Cultura Racional em eventos e apresenta√ß√µes.</p>
            </div>
        </div>
    </section>
`;
        }

        function generateHomePage() { /* (MANTIDO) */ return `
    <div class="text-center pt-12 pb-24">
        <h1 class="text-7xl md:text-9xl font-mono rjb-logo-text text-rjb-yellow mb-2">Racional Jazz Band</h1>
        <h2 class="text-3xl md:text-5xl font-extrabold text-rjb-text dark:text-rjb-text-dark mb-6 transition-colors duration-500">M√∫sica, Arte e Cultura Racional</h2>
        <p class="text-lg md:text-xl text-rjb-text/80 dark:text-rjb-text-dark/80 mb-10 max-w-4xl mx-auto transition-colors duration-500">
            A Racional Jazz Band √© a express√£o musical do conhecimento Racional, unindo a for√ßa do jazz, a beleza da melodia e a pureza de um saber que transcende.
        </p>
        <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
            <button onclick="navigateTo('apresentacoes')" class="bg-rjb-yellow text-rjb-text font-bold py-3 px-8 rounded-full text-lg hover:bg-yellow-500 transition duration-300 transform hover:scale-105 shadow-subtle-glow hover:shadow-soft-glow">
                Ver Apresenta√ß√µes
            </button>
            <button onclick="navigateTo('sobre')" class="bg-transparent border-2 border-rjb-yellow text-rjb-text dark:text-rjb-text-dark font-bold py-3 px-8 rounded-full text-lg hover:bg-rjb-yellow/20 dark:hover:bg-rjb-yellow/10 transition duration-300 transform hover:scale-105">
                Conhe√ßa a Hist√≥ria
            </button>
        </div>
    </div>
`;
        }

        // index.html (SUBSTITUIR A FUN√á√ÉO generateSobrePage())

        function generateSobrePage() {
            return `
        <div class="space-y-8 text-rjb-text dark:text-rjb-text-dark transition-colors duration-500">
            
            <h2 class="text-4xl font-extrabold text-rjb-yellow border-b-2 border-rjb-yellow/50 pb-3">
                A Express√£o Musical do Saber
            </h2>

            <div class="border-l-4 border-rjb-yellow pl-5 bg-rjb-bg-light/50 dark:bg-rjb-card-dark/50 p-4 rounded-lg shadow-sm">
                <p class="text-lg font-medium italic text-rjb-text/90 dark:text-rjb-text-dark/90">
                    A <strong>Racional Jazz Band (RJB)</strong> nasceu da uni√£o de dois prop√≥sitos elevados: a excel√™ncia art√≠stica do Jazz e a profundidade da <strong>Cultura Racional</strong>. Fundada em <strong>20 de novembro de 2015</strong>, a RJB rapidamente se estabeleceu como um ve√≠culo de express√£o para um conhecimento que transcende, utilizando a m√∫sica como sua linguagem universal.
                </p>
            </div>

            <p class="text-rjb-text/80 dark:text-rjb-text-dark/80">
                Acreditamos que a m√∫sica instrumental √© a forma mais pura de comunica√ß√£o. O Jazz, com sua liberdade r√≠tmica e improvisa√ß√£o harmoniosa, oferece o palco ideal para manifestar os sentimentos de equil√≠brio, paz e racioc√≠nio que a Cultura Racional propaga. Cada apresenta√ß√£o √© um convite √† reflex√£o e √† harmonia.
            </p>
            
            <h3 class="text-3xl font-bold text-rjb-text dark:text-rjb-text-dark mt-8 pt-4 border-t border-rjb-text/10 dark:border-rjb-text-dark/10">
                O Conceito Racional
            </h3>

            <p class="text-rjb-text/80 dark:text-rjb-text-dark/80">
                A Cultura Racional √© o conhecimento que revela a origem e o destino de tudo e de todos, promovendo o racioc√≠nio, o equil√≠brio e a liga√ß√£o com o Mundo de Energia Racional. Nossa miss√£o n√£o √© apenas performar; √© <strong>transmitir essa mensagem de Luz e de Paz</strong> atrav√©s de arranjos exclusivos e composi√ß√µes inspiradas nos pilares da Cultura.
            </p>
            
            <p class="text-rjb-text/80 dark:text-rjb-text-dark/80">
                Cada apresenta√ß√£o, cada nota e cada melodia da RJB √© um convite para o p√∫blico refletir sobre sua ess√™ncia e o universo que o cerca, encontrando a harmonia entre o macrocosmo e o pr√≥prio ser.
            </p>

            <div class="mt-12 p-6 bg-rjb-yellow/10 dark:bg-rjb-yellow/5 rounded-xl border border-rjb-yellow/30 shadow-md transition-colors duration-500">
                <h3 class="text-2xl font-bold text-rjb-text dark:text-rjb-text-dark mb-4 flex items-center space-x-2">
                    <svg class="w-6 h-6 text-rjb-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <span>Nossa Miss√£o</span>
                </h3>
                <ul class="list-disc list-inside space-y-2 text-rjb-text/80 dark:text-rjb-text-dark/80 ml-4">
                    <li>Promover a Cultura Racional atrav√©s da arte musical.</li>
                    <li>Desenvolver e executar um repert√≥rio instrumental de excel√™ncia.</li>
                    <li>Inspirar o racioc√≠nio, o equil√≠brio e a paz no p√∫blico.</li>
                </ul>
            </div>
            
        </div>
    `;
        }
        function generateApresentacoesPage() {
            // Ordena eventos por data (mais recente primeiro)
            const sortedEvents = [...APRESENTACOES_BY_EVENT].sort((a, b) => {
                return new Date(b.date) - new Date(a.date);
            });

            return `
				<div class="space-y-8">
					<div class="text-rjb-text/80 dark:text-rjb-text-dark/80 mb-8">
						<p>Assista aos nossos principais shows e apresenta√ß√µes de grande p√∫blico. Experi√™ncias sonoras e visuais completas da Racional Jazz Band, organizadas por data.</p>
					</div>
					
					${sortedEvents.map((event, eventIndex) => `
						<div class="bg-rjb-card-light dark:bg-rjb-card-dark rounded-xl border border-rjb-yellow/10 shadow-lg overflow-hidden transition-all duration-300 hover:shadow-xl">
							<!-- Cabe√ßalho do Evento -->
							<div class="bg-gradient-to-r from-rjb-yellow/20 via-rjb-yellow/15 to-rjb-yellow/10 dark:from-rjb-yellow/10 dark:via-rjb-yellow/5 dark:to-rjb-yellow/5 p-3 sm:p-4 md:p-6 border-b border-rjb-yellow/20">
								<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-3">
									<div class="flex-1 min-w-0">
										<h3 class="text-lg sm:text-xl md:text-2xl font-bold text-rjb-text dark:text-rjb-text-dark mb-1 break-words">
											${event.eventTitle}
										</h3>
										<div class="flex flex-wrap items-center gap-2 sm:gap-3 text-xs sm:text-sm text-rjb-text/70 dark:text-rjb-text-dark/70">
											<div class="flex items-center gap-1.5">
												<svg class="w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
												</svg>
												<span class="font-medium break-words">${event.dateFormatted}</span>
											</div>
											<div class="flex items-center gap-1.5">
												<svg class="w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
												</svg>
												<span class="break-words">${event.location}</span>
											</div>
										</div>
									</div>
									<div class="flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-1 sm:py-1.5 bg-rjb-yellow/20 dark:bg-rjb-yellow/10 rounded-lg flex-shrink-0">
										<svg class="w-4 h-4 sm:w-5 sm:h-5 text-rjb-yellow flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
										</svg>
										<span class="text-xs sm:text-sm font-semibold text-rjb-text dark:text-rjb-text-dark whitespace-nowrap">
											${event.videos.length} ${event.videos.length === 1 ? 'v√≠deo' : 'v√≠deos'}
										</span>
									</div>
								</div>
							</div>
							
							<!-- Grid de V√≠deos -->
							<div class="p-3 sm:p-4 md:p-6">
								<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-4 md:gap-6">
									${event.videos.map(video => generateVideoCard({ ...video, date: event.dateFormatted })).join('')}
								</div>
							</div>
						</div>
					`).join('')}
					
					${sortedEvents.length === 0 ? `
						<div class="text-center py-12">
							<svg class="w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
							</svg>
							<p class="text-gray-400 dark:text-gray-500 text-lg">Nenhum v√≠deo cadastrado ainda.</p>
						</div>
					` : ''}
					
					<p class="text-center mt-8 text-rjb-text/70 dark:text-rjb-text-dark/70">
						Assista a mais performances no nosso canal oficial do YouTube.
					</p>
				</div>
			`;
        }

        function generateBastidoresPage() {
            // Ordena eventos por data (mais recente primeiro)
            const sortedEvents = [...BASTIDORES_BY_EVENT].sort((a, b) => {
                return new Date(b.date) - new Date(a.date);
            });

            return `
				<div class="space-y-8">
					<div class="text-rjb-text/80 dark:text-rjb-text-dark/80 mb-8">
						<p>Acompanhe o processo criativo, os ensaios e a dedica√ß√£o dos m√∫sicos da Racional Jazz Band. Veja a m√∫sica sendo feita, nota por nota, em v√≠deos exclusivos dos bastidores e entrevistas com a equipe, organizados por data.</p>
					</div>
					
					${sortedEvents.map((event, eventIndex) => `
						<div class="bg-rjb-card-light dark:bg-rjb-card-dark rounded-xl border border-rjb-yellow/10 shadow-lg overflow-hidden transition-all duration-300 hover:shadow-xl">
							<!-- Cabe√ßalho do Evento -->
							<div class="bg-gradient-to-r from-rjb-yellow/20 via-rjb-yellow/15 to-rjb-yellow/10 dark:from-rjb-yellow/10 dark:via-rjb-yellow/5 dark:to-rjb-yellow/5 p-3 sm:p-4 md:p-6 border-b border-rjb-yellow/20">
								<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-3">
									<div class="flex-1 min-w-0">
										<h3 class="text-lg sm:text-xl md:text-2xl font-bold text-rjb-text dark:text-rjb-text-dark mb-1 break-words">
											${event.eventTitle}
										</h3>
										<div class="flex flex-wrap items-center gap-2 sm:gap-3 text-xs sm:text-sm text-rjb-text/70 dark:text-rjb-text-dark/70">
											<div class="flex items-center gap-1.5">
												<svg class="w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
												</svg>
												<span class="font-medium break-words">${event.dateFormatted}</span>
											</div>
											<div class="flex items-center gap-1.5">
												<svg class="w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
												</svg>
												<span class="break-words">${event.location}</span>
											</div>
										</div>
									</div>
									<div class="flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-1 sm:py-1.5 bg-rjb-yellow/20 dark:bg-rjb-yellow/10 rounded-lg flex-shrink-0">
										<svg class="w-4 h-4 sm:w-5 sm:h-5 text-rjb-yellow flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
										</svg>
										<span class="text-xs sm:text-sm font-semibold text-rjb-text dark:text-rjb-text-dark whitespace-nowrap">
											${event.videos.length} ${event.videos.length === 1 ? 'v√≠deo' : 'v√≠deos'}
										</span>
									</div>
								</div>
							</div>
							
							<!-- Grid de V√≠deos -->
							<div class="p-3 sm:p-4 md:p-6">
								<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-4 md:gap-6">
									${event.videos.map(video => generateVideoCard({ ...video, date: event.dateFormatted })).join('')}
								</div>
							</div>
						</div>
					`).join('')}
					
					${sortedEvents.length === 0 ? `
						<div class="text-center py-12">
							<svg class="w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
							</svg>
							<p class="text-gray-400 dark:text-gray-500 text-lg">Nenhum v√≠deo cadastrado ainda.</p>
						</div>
					` : ''}
					
					<p class="text-center mt-8 text-rjb-text/70 dark:text-rjb-text-dark/70">
						Assista a mais v√≠deos de bastidores e entrevistas no nosso canal oficial do YouTube.
					</p>
				</div>
			`;
        }

        // index.html (SUBSTITUIR A FUN√á√ÉO generateRepertorioPage COMPLETA)
        function generateRepertorioPage() {

            // Fun√ß√£o interna para renderizar listas
            const renderList = (title, songs, isRacional) => {

                // CORRE√á√ÉO CR√çTICA: Define a pasta base (racionais ou diversas) e a subpasta (mp3original)
                const BASE_FOLDER = isRacional ? 'racionais' : 'diversas';
                const FULL_FOLDER_PATH = `${BASE_FOLDER}/mp3original`;

                return `
            <div class="mb-10">
                <h3 class="text-3xl font-extrabold mb-6 ${isRacional ? 'text-rjb-yellow' : 'text-rjb-text/90 dark:text-rjb-text-dark/90'} border-b-2 ${isRacional ? 'border-rjb-yellow' : 'border-rjb-text/20 dark:border-rjb-text-dark/20'} pb-2 transition-colors duration-500">
                    ${title}
                </h3>
                <ul class="space-y-3">
                    ${songs.map((song) => {
                    // 1. Constr√≥i o URL de √°udio correto usando o caminho completo din√¢mico
                    const audioUrl = `${R2_BASE_URL}/${FULL_FOLDER_PATH}/${song.mp3}.mp3`;

                    return `
                        <li class="flex justify-between items-center p-4 rounded-lg bg-rjb-bg-light dark:bg-rjb-bg-dark/50 hover:bg-rjb-yellow/10 dark:hover:bg-rjb-yellow/5 transition-colors duration-300 shadow-sm border-l-4 ${isRacional ? 'border-rjb-yellow' : 'border-rjb-text/30 dark:border-rjb-text-dark/30'}">
                            <div class="flex items-center space-x-3">
                                <button onclick="togglePlayExternal('${song.title.trim().replace(/'/g, "\\'")}', '${audioUrl}')" class="play-button text-rjb-yellow hover:text-yellow-600 transition-colors transform hover:scale-105 p-2 rounded-full bg-rjb-yellow/10 hover:bg-rjb-yellow/20 dark:bg-rjb-yellow/5 dark:hover:bg-rjb-yellow/10" data-title="${song.title.trim()}" aria-label="Tocar ${song.title.trim()}">
                                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path></svg>
                                </button>
                                <span class="text-lg font-medium text-rjb-text dark:text-rjb-text-dark">${song.title}</span>
                            </div>
                            <span class="text-sm ${isRacional ? 'text-rjb-yellow' : 'text-rjb-text/70 dark:text-rjb-text-dark/70'}">${song.time}</span>
                        </li>
                    `;
                }).join('')}
                </ul>
            </div>
        `;
            };

            // Retorno final da p√°gina
            return `
        <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
            ${renderList('M√∫sicas Racionais üéß', racionais, true)}
            ${renderList('Outros Cl√°ssicos üé∑', diversas, false)}
        </div>
        <p class="text-center mt-12 text-rjb-text/70 dark:text-rjb-text-dark/70 italic">
            Nosso repert√≥rio est√° em constante expans√£o e renova√ß√£o.
        </p>
    `;
        }
        // index.html (FUN√á√ÉO generatePartiturasPage - VERS√ÉO CORRIGIDA PARA R2)
        function generatePartiturasPage() {
            // 1. Combine e classifique todas as m√∫sicas, ADICIONANDO A PROPRIEDADE 'FOLDER'
            const allSheets = [
                ...racionais.map(s => ({ ...s, category: 'M√∫sica Racional', folder: 'racionais' })),
                ...diversas.map(s => ({ ...s, category: 'Outros Cl√°ssicos', folder: 'diversas' })),
            ].sort((a, b) => a.title.localeCompare(b.title));

            // 2. Agrupe por categoria para renderiza√ß√£o em blocos
            const sheetsByCategory = allSheets.reduce((acc, sheet) => {
                (acc[sheet.category] = acc[sheet.category] || []).push(sheet);
                return acc;
            }, {});

            // 3. Fun√ß√£o de renderiza√ß√£o para cada lista
            const renderSheetList = (categoryTitle, sheets) => {
                if (!sheets || sheets.length === 0) return '';

                const isRacional = sheets[0].folder === 'racionais';
                const titleClass = isRacional ? 'text-rjb-yellow' : 'text-rjb-text dark:text-rjb-text-dark';
                const borderColor = isRacional ? 'border-rjb-yellow' : 'border-rjb-text/20 dark:border-rjb-text-dark/20';
                const containerId = isRacional ? 'racionais-list' : 'diversas-list';
                const accordionId = isRacional ? 'accordion-racionais' : 'accordion-diversas';

                // For√ßa o accordion a abrir para AMBAS as listas
                const isDefaultOpen = true;

                return `
            <div class="mb-6">
                
                <button id="${accordionId}-header" onclick="toggleAccordion('${accordionId}')" 
                        class="accordion-header flex justify-between items-center w-full p-4 rounded-lg font-extrabold text-xl md:text-2xl 
                               ${isDefaultOpen ? 'open' : ''} ${titleClass} bg-rjb-bg-light dark:bg-rjb-card-dark/50 
                               hover:bg-rjb-yellow/10 dark:hover:bg-rjb-yellow/5 border-l-4 ${borderColor} transition-colors duration-300 shadow-sm">
                    ${categoryTitle} (${sheets.length})
                    <svg class="accordion-header-icon w-6 h-6 transform ${isDefaultOpen ? 'rotate-180' : 'rotate-0'}" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>

                <div id="${accordionId}-content" class="accordion-content ${isDefaultOpen ? 'open' : ''} mt-4">
                    <div id="${containerId}" class="space-y-4">
                        ${sheets.map((sheet) => `
                            <div class="sheet-item p-4 rounded-xl bg-rjb-bg-light dark:bg-rjb-bg-dark/50 flex flex-col md:flex-row justify-between items-center shadow-sm border-l-4 ${isRacional ? 'border-rjb-yellow' : 'border-rjb-text/30 dark:border-rjb-text-dark/30'}">
                                
                                <div class="mb-3 md:mb-0 md:w-1/3">
                                    <p class="text-lg font-medium text-rjb-text dark:text-rjb-text-dark">${sheet.title}</p>
                                    <p class="text-sm text-rjb-text/60 dark:text-rjb-text-dark/60">${sheet.time} &bull; Refer√™ncia / Arquivos</p>
                                </div>

                                <div class="md:w-2/3 flex flex-wrap justify-end space-x-2 space-y-2 md:space-y-0 items-center">
                                    
                                    <div class="flex items-center space-x-2 bg-rjb-yellow/10 py-1 px-2 rounded-lg text-sm">
                                        <audio controls class="rjb-audio-player w-48 h-10 md:w-56" preload="none">
                                            <source src="${R2_BASE_URL}/${sheet.folder}/mp3/${sheet.mp3}.mp3" type="audio/mp3">
                                            Seu navegador n√£o suporta o elemento de √°udio.
                                        </audio>
                                    </div>
                                    
                                    <a href="${R2_BASE_URL}/${sheet.folder}/pdf/${sheet.mp3}.pdf" download="${sheet.title.replace(/ /g, '_')}.pdf"
                                        class="flex items-center space-x-2 bg-rjb-yellow text-rjb-text font-semibold py-2 px-3 rounded-lg hover:bg-yellow-500 transition-colors text-sm transform hover:scale-[1.03] shadow-subtle-glow">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                                        <span>PDF</span>
                                    </a>
                                    
                                    <a href="${R2_BASE_URL}/${sheet.folder}/sib/${sheet.mp3}.sib" download="${sheet.title.replace(/ /g, '_')}.sib"
                                        class="flex items-center space-x-2 bg-rjb-text dark:bg-rjb-card-dark text-white dark:text-rjb-text-dark font-semibold py-2 px-3 rounded-lg hover:bg-gray-700 dark:hover:bg-rjb-bg-dark transition-colors text-sm transform hover:scale-[1.03] border border-transparent dark:border-rjb-text-dark/20">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                        <span>SIB</span>
                                    </a>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        `;
            };


            // 4. Retorno final da p√°gina (Layout em duas colunas)
            return `
        <div class="space-y-6">
            <p class="text-rjb-text/80 dark:text-rjb-text-dark/80 text-lg mb-8">
                √Årea exclusiva para m√∫sicos. Fa√ßa o download de partituras e refer√™ncias de √°udio para ensaio.
            </p>

            <div class="mb-10">
                <input type="text" id="search-input" onkeyup="filterPartituras()" placeholder="üîé Digite o nome da m√∫sica para buscar..." 
                       class="w-full p-4 rounded-lg bg-rjb-card-light dark:bg-rjb-card-dark border-2 border-rjb-yellow/50 text-rjb-text dark:text-rjb-text-dark focus:ring-2 focus:ring-rjb-yellow focus:border-rjb-yellow transition-all shadow-md placeholder-rjb-text/50 dark:placeholder-rjb-text-dark/50">
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                ${renderSheetList('M√∫sicas Racionais', sheetsByCategory['M√∫sica Racional'] || [])}
                ${renderSheetList('Outros Cl√°ssicos', sheetsByCategory['Outros Cl√°ssicos'] || [])}
            </div>
        </div>
    `;
        }
        // Estrutura de fotos organizadas por apresenta√ß√£o/data
        const PHOTOS_BY_EVENT = [
            {
                date: '2025-12-30',
                dateFormatted: '30 de Dezembro de 2025',
                eventTitle: 'Ensaios e Apresenta√ß√µes',
                location: 'Retiro Racional - Nova Igua√ßu (RJ)',
                photos: [
                    // Adicione aqui as URLs das fotos do dia 30/12/2025
                    // Exemplo:
                    // 'https://pub-d3a0bbd0657549f8bdee48c70041537b.r2.dev/images/nova-foto-1.jpg',
                    // 'https://pub-d3a0bbd0657549f8bdee48c70041537b.r2.dev/images/nova-foto-2.jpg',
                ]
            },
            {
                date: '2025-10-04',
                dateFormatted: '04 de Outubro de 2025',
                eventTitle: 'Ensaios e Apresenta√ß√µes',
                location: 'Retiro Racional - Nova Igua√ßu (RJ)',
                photos: [
                    'https://pub-d3a0bbd0657549f8bdee48c70041537b.r2.dev/images/5019431831505841433.jpg',
                    'https://pub-d3a0bbd0657549f8bdee48c70041537b.r2.dev/images/5019629915397534258.jpg',
                    'https://pub-d3a0bbd0657549f8bdee48c70041537b.r2.dev/images/5019629915397534262.jpg',
                    'https://pub-d3a0bbd0657549f8bdee48c70041537b.r2.dev/images/5019629915397534265.jpg',
                    'https://pub-d3a0bbd0657549f8bdee48c70041537b.r2.dev/images/5019629915397534263.jpg',
                    'https://pub-d3a0bbd0657549f8bdee48c70041537b.r2.dev/images/5019629915397534264.jpg',
                    'https://pub-d3a0bbd0657549f8bdee48c70041537b.r2.dev/images/5019629915397534261.jpg',
                    'https://pub-d3a0bbd0657549f8bdee48c70041537b.r2.dev/images/5019629915397534260.jpg',
                    'https://pub-d3a0bbd0657549f8bdee48c70041537b.r2.dev/images/5019629915397534259.jpg',
                    'https://pub-d3a0bbd0657549f8bdee48c70041537b.r2.dev/images/5019629915397534257.jpg',
                    'https://pub-d3a0bbd0657549f8bdee48c70041537b.r2.dev/images/5019431831505841431.jpg',
                    'https://pub-d3a0bbd0657549f8bdee48c70041537b.r2.dev/images/5019431831505841432.jpg',
                ]
            },
            // Adicione mais apresenta√ß√µes aqui seguindo o mesmo formato:
            // {
            //     date: 'YYYY-MM-DD',
            //     dateFormatted: 'DD de M√™s de YYYY',
            //     eventTitle: 'Nome do Evento',
            //     location: 'Local do Evento',
            //     photos: [
            //         'url1.jpg',
            //         'url2.jpg',
            //     ]
            // },
        ];

        function generateFotosPage() {
            // Ordena eventos por data (mais recente primeiro)
            const sortedEvents = [...PHOTOS_BY_EVENT].sort((a, b) => {
                return new Date(b.date) - new Date(a.date);
            });

            return `
        <div class="space-y-8">
            <p class="text-lg text-rjb-text/80 dark:text-rjb-text-dark/80">
                Uma galeria de momentos capturados em nossos shows, ensaios e eventos, organizados por apresenta√ß√£o.
            </p>
            
            ${sortedEvents.map((event, eventIndex) => `
                <div class="bg-rjb-card-light dark:bg-rjb-card-dark rounded-xl border border-rjb-yellow/10 shadow-lg overflow-hidden transition-all duration-300 hover:shadow-xl">
                    <!-- Cabe√ßalho do Evento -->
                    <div class="bg-gradient-to-r from-rjb-yellow/20 via-rjb-yellow/15 to-rjb-yellow/10 dark:from-rjb-yellow/10 dark:via-rjb-yellow/5 dark:to-rjb-yellow/5 p-3 sm:p-4 md:p-6 border-b border-rjb-yellow/20">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-3">
                            <div class="flex-1 min-w-0">
                                <h3 class="text-lg sm:text-xl md:text-2xl font-bold text-rjb-text dark:text-rjb-text-dark mb-1 break-words">
                                    ${event.eventTitle}
                                </h3>
                                <div class="flex flex-wrap items-center gap-2 sm:gap-3 text-xs sm:text-sm text-rjb-text/70 dark:text-rjb-text-dark/70">
                                    <div class="flex items-center gap-1.5">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                        </svg>
                                        <span class="font-medium">${event.dateFormatted}</span>
                                    </div>
                                    <div class="flex items-center gap-1.5">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        </svg>
                                        <span>${event.location}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-1 sm:py-1.5 bg-rjb-yellow/20 dark:bg-rjb-yellow/10 rounded-lg flex-shrink-0">
                                <svg class="w-4 h-4 sm:w-5 sm:h-5 text-rjb-yellow flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <span class="text-xs sm:text-sm font-semibold text-rjb-text dark:text-rjb-text-dark whitespace-nowrap">
                                    ${event.photos.length} ${event.photos.length === 1 ? 'foto' : 'fotos'}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Grid de Fotos -->
                    <div class="p-3 sm:p-4 md:p-6">
                        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 gap-2 sm:gap-3 md:gap-4">
                            ${event.photos.map((url, photoIndex) => `
                                <div onclick="openModal('${url}')" 
                                    class="group relative overflow-hidden rounded-lg shadow-md aspect-square transition-all duration-300 hover:shadow-soft-glow cursor-pointer transform hover:scale-[1.02]">
                                    <img src="${url}" 
                                        alt="${event.eventTitle} - Foto ${photoIndex + 1}" 
                                        loading="lazy" 
                                        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110 group-hover:rotate-1">
                                    <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                                    <div class="absolute inset-0 bg-rjb-yellow/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
                                        <span class="text-white text-3xl opacity-0 group-hover:opacity-100 transition-opacity delay-200 transform group-hover:scale-110">
                                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                            </svg>
                                        </span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `).join('')}
            
            ${sortedEvents.length === 0 ? `
                <div class="text-center py-12">
                    <svg class="w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <p class="text-gray-400 dark:text-gray-500 text-lg">Nenhuma foto cadastrada ainda.</p>
                </div>
            ` : ''}
        </div>
    `;
        }

        function generateAgendaPage() {
            // MOCK de dados internos para esta p√°gina
            const events = [
                { date: '2025-12-30', time: '20:00', title: 'Dia do S√°bio', location: 'Retiro Racional - Nova Igua√ßu (RJ)', link: '#', dateString: '30 DEZ 2025' },
                //{ date: '2026-01-20', time: '19:30', title: 'Pocket Show - Jazz na Pra√ßa', location: 'Pra√ßa Tiradentes, Curitiba (PR)', link: '#', dateString: '20 JAN 2026' },
                //{ date: '2026-03-05', time: '21:00', title: 'Festival de Jazz de Inverno', location: 'Teatro Pedro II, Ribeir√£o Preto (SP)', link: '#', dateString: '05 MAR 2026' },
            ];

            return `
        <div class="space-y-6">
            <p class="text-lg text-rjb-text/80 dark:text-rjb-text-dark/80 mb-8">
                Confira a nossa agenda de apresenta√ß√µes para participar de momentos inesquec√≠veis de m√∫sica e cultura.
            </p>
            ${events.map(event => `
                <div class="flex flex-col md:flex-row items-start md:items-center p-6 rounded-xl bg-rjb-card-light dark:bg-rjb-card-dark border-l-8 border-rjb-yellow shadow-md hover:shadow-lg transition-all duration-300">
                    <div class="flex-shrink-0 w-full md:w-32 mb-4 md:mb-0 mr-6 text-center">
                        <p class="text-3xl font-extrabold text-rjb-yellow leading-none">${event.dateString.split(' ')[0]}</p>
                        <p class="text-md font-semibold text-rjb-text/90 dark:text-rjb-text-dark/90">${event.dateString.split(' ')[1]} ${event.dateString.split(' ')[2]}</p>
                    </div>
                    <div class="flex-grow">
                        <h3 class="text-2xl font-bold text-rjb-text dark:text-rjb-text-dark mb-1">${event.title}</h3>
                        <p class="text-rjb-text/70 dark:text-rjb-text-dark/70">${event.location} &bull; ${event.time}h</p>
                    </div>
                </div>
            `).join('')}
        </div>
    `;
        }

        function generateContatoPage() { /* (MANTIDO) */ return `
				<div class="max-w-xl mx-auto">
					<p class="text-rjb-text/80 dark:text-rjb-text-dark/80 text-lg mb-8 text-center">
						Para contrata√ß√µes, parcerias ou d√∫vidas gerais, envie-nos uma mensagem.
					</p>
					<form id="contact-form" onsubmit="submitContactForm(event);">
						<div class="space-y-4">
							<div>
								<label for="name" class="block text-sm font-medium text-rjb-text/70 dark:text-rjb-text-dark/70 mb-1 flex items-center gap-1">
									Nome Completo
									<svg class="w-4 h-4 text-green-500 hidden field-valid-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
									</svg>
								</label>
								<input type="text" id="name" name="name" required 
									onblur="validateField(this, 'name')"
									oninput="validateFieldRealTime(this, 'name'); clearFieldError(this)"
									class="w-full p-3 rounded-lg bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/30 text-rjb-text dark:text-rjb-text-dark focus:ring-2 focus:ring-rjb-yellow focus:border-rjb-yellow transition-all" placeholder="Seu nome">
								<p class="field-error hidden text-xs text-red-600 dark:text-red-400 mt-1"></p>
							</div>
							<div>
								<label for="email" class="block text-sm font-medium text-rjb-text/70 dark:text-rjb-text-dark/70 mb-1 flex items-center gap-1">
									Email
									<svg class="w-4 h-4 text-green-500 hidden field-valid-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
									</svg>
								</label>
								<input type="email" id="email" name="email" required 
									onblur="validateField(this, 'email')"
									oninput="validateFieldRealTime(this, 'email'); clearFieldError(this)"
									class="w-full p-3 rounded-lg bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/30 text-rjb-text dark:text-rjb-text-dark focus:ring-2 focus:ring-rjb-yellow focus:border-rjb-yellow transition-all" placeholder="seu.email@exemplo.com">
								<p class="field-error hidden text-xs text-red-600 dark:text-red-400 mt-1"></p>
							</div>
							<div>
								<label for="message" class="block text-sm font-medium text-rjb-text/70 dark:text-rjb-text-dark/70 mb-1 flex items-center gap-1">
									Mensagem
									<svg class="w-4 h-4 text-green-500 hidden field-valid-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
									</svg>
								</label>
								<textarea id="message" name="message" rows="4" required 
									onblur="validateField(this, 'message')"
									oninput="validateFieldRealTime(this, 'message'); clearFieldError(this)"
									class="w-full p-3 rounded-lg bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/30 text-rjb-text dark:text-rjb-text-dark focus:ring-2 focus:ring-rjb-yellow focus:border-rjb-yellow transition-all" placeholder="Sua mensagem..."></textarea>
								<p class="field-error hidden text-xs text-red-600 dark:text-red-400 mt-1"></p>
							</div>
							<button type="submit" class="w-full bg-rjb-yellow text-rjb-text font-bold py-3 rounded-lg text-lg hover:bg-yellow-500 transition duration-300 transform hover:scale-[1.01] shadow-soft-glow">
								Enviar Mensagem
							</button>
						</div>
					</form>
				</div>
			`;
        }

        function generateCadastroPage() {
            return `
    <div class="max-w-xl mx-auto">
        <p class="text-rjb-text/80 dark:text-rjb-text-dark/80 text-lg mb-8 text-center">
            Preencha todos os campos abaixo para completar sua inscri√ß√£o.
        </p>
        <form id="member-registration-form" onsubmit="submitMemberRegistration(event);">
            <input type="hidden" id="reg-terms-version" name="termsVersion" value="Termo de Consentimento v1.0 - Ciclo 2026">
            <div class="space-y-4">
                <div>
                    <label for="reg-invite-key" class="block text-sm font-medium opacity-70 mb-1 flex items-center gap-1">
                        Chave de Convite
                        <span class="group relative">
                            <svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span class="hidden group-hover:block absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-48 p-2 text-xs text-white bg-gray-800 rounded-lg shadow-lg z-50">
                                Chave √∫nica fornecida pela administra√ß√£o para cadastro
                            </span>
                        </span>
                    </label>
                    <input type="text" id="reg-invite-key" required 
                        onblur="validateField(this, 'inviteKey')"
                        oninput="clearFieldError(this)"
                        class="w-full p-3 rounded-lg bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/30 text-rjb-text dark:text-rjb-text-dark focus:ring-2 focus:ring-rjb-yellow transition-all">
                    <p class="field-error hidden text-xs text-red-600 dark:text-red-400 mt-1"></p>
                </div>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="reg-name" class="block text-sm font-medium opacity-70 mb-1 flex items-center gap-1">
                            Nome Completo
                            <svg class="w-4 h-4 text-green-500 hidden field-valid-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </label>
                        <input type="text" id="reg-name" required 
                            onblur="normalizeNameField(this); validateField(this, 'name')"
                            oninput="validateFieldRealTime(this, 'name'); clearFieldError(this)"
                            class="w-full p-3 rounded-lg bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/30 text-rjb-text dark:text-rjb-text-dark focus:ring-2 focus:ring-rjb-yellow transition-all">
                        <p class="field-error hidden text-xs text-red-600 dark:text-red-400 mt-1"></p>
                    </div>
                    <div>
                        <label for="reg-tefa" class="block text-sm font-medium opacity-70 mb-1 flex items-center gap-1">
                            N¬∫ TEFA (Opcional)
                            <span class="group relative">
                                <svg class="w-4 h-4 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span class="hidden group-hover:block absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-56 p-2 text-xs text-white bg-gray-800 rounded-lg shadow-lg z-50">
                                    N√∫mero TEFA - somente n√∫meros s√£o permitidos
                                </span>
                            </span>
                        </label>
                        <input type="text" id="reg-tefa" inputmode="numeric" pattern="[0-9]*" 
                            oninput="this.value = this.value.replace(/[^0-9]/g, ''); validateFieldRealTime(this, 'tefa'); clearFieldError(this)"
                            onblur="validateField(this, 'tefa')"
                            class="w-full p-3 rounded-lg bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/30 text-rjb-text dark:text-rjb-text-dark focus:ring-2 focus:ring-rjb-yellow transition-all" placeholder="Ex: 1234">
                        <p class="field-error hidden text-xs text-red-600 dark:text-red-400 mt-1"></p>
                    </div>
                </div>

                <div>
                    <label for="reg-instrument" class="block text-sm font-medium opacity-70 mb-1 flex items-center gap-1">
                        Instrumento / √Årea de Colabora√ß√£o
                        <svg class="w-4 h-4 text-green-500 hidden field-valid-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </label>
                    <input type="text" id="reg-instrument" required 
                        onblur="validateField(this, 'instrument')"
                        oninput="validateFieldRealTime(this, 'instrument'); clearFieldError(this)"
                        class="w-full p-3 rounded-lg bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/30 text-rjb-text dark:text-rjb-text-dark focus:ring-2 focus:ring-rjb-yellow transition-all" placeholder="Ex: Sax Alto, Trompete, Trombone">
                    <p class="field-error hidden text-xs text-red-600 dark:text-red-400 mt-1"></p>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="reg-email" class="block text-sm font-medium opacity-70 mb-1 flex items-center gap-1">
                            Email
                            <svg class="w-4 h-4 text-green-500 hidden field-valid-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </label>
                        <input type="email" id="reg-email" required 
                            onblur="validateField(this, 'email')"
                            oninput="validateFieldRealTime(this, 'email'); clearFieldError(this)"
                            class="w-full p-3 rounded-lg bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/30 text-rjb-text dark:text-rjb-text-dark focus:ring-2 focus:ring-rjb-yellow transition-all">
                        <p class="field-error hidden text-xs text-red-600 dark:text-red-400 mt-1"></p>
                    </div>
                    <div>
                        <label for="reg-phone" class="block text-sm font-medium opacity-70 mb-1 flex items-center gap-1">
                            Contato (WhatsApp)
                            <svg class="w-4 h-4 text-green-500 hidden field-valid-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </label>
                        <input type="tel" id="reg-phone" required 
                            placeholder="(00) 00000-0000"
                            oninput="this.value = this.value.replace(/\\D/g, '').replace(/^(\\d{2})(\\d)/g, '($1) $2').replace(/(\\d{5})(\\d)/, '$1-$2').substring(0, 15); validateFieldRealTime(this, 'phone'); clearFieldError(this)"
                            onblur="validateField(this, 'phone')"
                            class="w-full p-3 rounded-lg bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/30 text-rjb-text dark:text-rjb-text-dark focus:ring-2 focus:ring-rjb-yellow transition-all">
                        <p class="field-error hidden text-xs text-red-600 dark:text-red-400 mt-1"></p>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="reg-state" class="block text-sm font-medium opacity-70 mb-1 flex items-center gap-1">
                            Estado (UF)
                            <svg class="w-4 h-4 text-green-500 hidden field-valid-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </label>
                        <select id="reg-state" required 
                            onchange="fetchCities(this.value); validateFieldRealTime(this, 'state'); clearFieldError(this)"
                            onblur="validateField(this, 'state')"
                            class="w-full p-3 rounded-lg bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/30 text-rjb-text dark:text-rjb-text-dark focus:ring-2 focus:ring-rjb-yellow transition-all">
                            <option value="">Selecione o Estado</option>
                            <option value="AC">Acre</option><option value="AL">Alagoas</option><option value="AP">Amap√°</option>
                            <option value="AM">Amazonas</option><option value="BA">Bahia</option><option value="CE">Cear√°</option>
                            <option value="DF">Distrito Federal</option><option value="ES">Esp√≠rito Santo</option><option value="GO">Goi√°s</option>
                            <option value="MA">Maranh√£o</option><option value="MT">Mato Grosso</option><option value="MS">Mato Grosso do Sul</option>
                            <option value="MG">Minas Gerais</option><option value="PA">Par√°</option><option value="PB">Para√≠ba</option>
                            <option value="PR">Paran√°</option><option value="PE">Pernambuco</option><option value="PI">Piau√≠</option>
                            <option value="RJ">Rio de Janeiro</option><option value="RN">Rio Grande do Norte</option><option value="RS">Rio Grande do Sul</option>
                            <option value="RO">Rond√¥nia</option><option value="RR">Roraima</option><option value="SC">Santa Catarina</option>
                            <option value="SP">S√£o Paulo</option><option value="SE">Sergipe</option><option value="TO">Tocantins</option>
                        </select>
                    </div>
                    <div>
                        <label for="reg-city" class="block text-sm font-medium opacity-70 mb-1 flex items-center gap-1">
                            Cidade
                            <svg class="w-4 h-4 text-green-500 hidden field-valid-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </label>
                        <select id="reg-city" required disabled
                            onchange="validateFieldRealTime(this, 'city'); clearFieldError(this)"
                            onblur="validateField(this, 'city')"
                            class="w-full p-3 rounded-lg bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/30 text-rjb-text dark:text-rjb-text-dark focus:ring-2 focus:ring-rjb-yellow transition-all disabled:opacity-50">
                            <option value="">Selecione o Estado primeiro</option>
                        </select>
                        <p class="field-error hidden text-xs text-red-600 dark:text-red-400 mt-1"></p>
                    </div>
                </div>

                <div class="p-4 rounded-lg bg-gray-50 dark:bg-rjb-bg-dark/30 border border-gray-200 dark:border-rjb-yellow/10">
                    <div class="flex items-start space-x-3">
                        <input id="terms" type="checkbox" required class="w-4 h-4 mt-1 text-rjb-yellow cursor-pointer">
                        <label for="terms" class="text-xs text-rjb-text/70 dark:text-rjb-text-dark/60 cursor-pointer">
                            Estou ciente e autorizo o uso da minha imagem (foto e v√≠deo) para fins de divulga√ß√£o da <b>Racional Jazz Band</b> e da Cultura Racional em canais oficiais e m√≠dias parceiras, conforme as diretrizes de privacidade.
                        </label>
                    </div>
                </div>

                <button type="submit" class="w-full bg-rjb-yellow text-rjb-text font-bold py-3 rounded-lg text-lg hover:bg-yellow-500 transition shadow-soft-glow">
                    Enviar Inscri√ß√£o
                </button>
            </div>
        </form>
    </div>`;
        }

        function generateReportsPage() {
            return `
    <div class="max-w-5xl mx-auto">
        <!-- Breadcrumb Navigation -->
        <nav class="mb-6" aria-label="Breadcrumb">
            <ol class="flex items-center space-x-2 text-sm">
                <li>
                    <button onclick="navigateTo('home')" class="text-rjb-text/70 dark:text-rjb-text-dark/70 hover:text-rjb-yellow transition-colors">
                        Home
                    </button>
                </li>
                <li class="text-rjb-text/50 dark:text-rjb-text-dark/50">/</li>
                <li class="text-rjb-yellow font-medium">√Årea Administrativa</li>
            </ol>
        </nav>

        <!-- Header Section -->
        <div class="mb-8">
            <div class="flex items-center gap-3 mb-2">
                <svg class="w-8 h-8 sm:w-10 sm:h-10 text-rjb-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
                <h2 class="text-3xl sm:text-4xl md:text-5xl font-extrabold text-rjb-yellow">√Årea Administrativa</h2>
            </div>
            <p class="text-rjb-text/70 dark:text-rjb-text-dark/70 text-sm sm:text-base ml-11 sm:ml-14">Gerencie convites, membros e anexos do sistema</p>
        </div>
        
        <!-- Login Area -->
        <div id="admin-login-area" class="bg-gradient-to-br from-rjb-card-light to-rjb-bg-light dark:from-rjb-card-dark dark:to-rjb-bg-dark/70 p-6 sm:p-8 rounded-2xl shadow-xl border-2 border-rjb-yellow/30 backdrop-blur-sm">
            <div class="text-center mb-6">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-rjb-yellow/20 dark:bg-rjb-yellow/10 mb-4">
                    <svg class="w-8 h-8 text-rjb-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>
                <p class="text-rjb-text/80 dark:text-rjb-text-dark/80 text-base sm:text-lg font-medium">Acesso restrito para regentes e administradores</p>
            </div>
            <form id="admin-login-form" onsubmit="handleAdminLogin(event);">
                <div class="space-y-5">
                    <div>
                        <label for="admin-email" class="block text-sm font-semibold text-rjb-text dark:text-rjb-text-dark mb-2 flex items-center gap-2">
                            <svg class="w-4 h-4 text-rjb-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"></path>
                            </svg>
                            E-mail
                        </label>
                        <input type="email" id="admin-email" name="email" required 
                            class="w-full p-3.5 rounded-xl bg-rjb-bg-light dark:bg-rjb-bg-dark border-2 border-rjb-yellow/30 text-rjb-text dark:text-rjb-text-dark focus:ring-2 focus:ring-rjb-yellow focus:border-rjb-yellow transition-all placeholder:text-rjb-text/40" 
                            placeholder="seu.email@exemplo.com">
                    </div>
                    <div>
                        <label for="admin-password" class="block text-sm font-semibold text-rjb-text dark:text-rjb-text-dark mb-2 flex items-center gap-2">
                            <svg class="w-4 h-4 text-rjb-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                            </svg>
                            Senha
                        </label>
                        <input type="password" id="admin-password" name="password" required 
                            class="w-full p-3.5 rounded-xl bg-rjb-bg-light dark:bg-rjb-bg-dark border-2 border-rjb-yellow/30 text-rjb-text dark:text-rjb-text-dark focus:ring-2 focus:ring-rjb-yellow focus:border-rjb-yellow transition-all placeholder:text-rjb-text/40" 
                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button type="submit" class="w-full bg-gradient-to-r from-rjb-yellow to-yellow-500 text-rjb-text font-bold py-3.5 rounded-xl text-base sm:text-lg hover:from-yellow-500 hover:to-yellow-600 transition-all duration-300 transform hover:scale-[1.02] shadow-lg hover:shadow-xl flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                        </svg>
                        Entrar
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Admin Dashboard Area -->
        <div id="report-output-area" class="hidden mt-8 space-y-6">
            
            <!-- Link para √Årea Financeira (apenas para financeiro/admin) -->
            <div id="finance-link-area" class="hidden mb-6">
                <a href="#financeiro" onclick="navigateTo('financeiro')" class="inline-flex items-center gap-3 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold py-4 px-6 rounded-xl transition-all shadow-lg hover:shadow-xl transform hover:scale-[1.02]">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>√Årea Financeira</span>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </a>
            </div>
            
            <!-- Gerenciamento de Convites Card -->
            <div class="bg-gradient-to-br from-rjb-card-light to-rjb-bg-light dark:from-rjb-card-dark dark:to-rjb-bg-dark/50 rounded-2xl shadow-xl border-2 border-rjb-yellow/20 overflow-hidden">
                <div class="bg-gradient-to-r from-rjb-yellow/20 via-rjb-yellow/15 to-rjb-yellow/10 dark:from-rjb-yellow/10 dark:via-rjb-yellow/5 dark:to-rjb-yellow/5 px-5 sm:px-6 py-4 border-b border-rjb-yellow/30">
                    <div class="flex items-center gap-3">
                        <div class="p-2 rounded-lg bg-rjb-yellow/20 dark:bg-rjb-yellow/10">
                            <svg class="w-5 h-5 sm:w-6 sm:h-6 text-rjb-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg sm:text-xl md:text-2xl font-bold text-rjb-text dark:text-rjb-text-dark">Gerenciamento de Convites</h3>
                    </div>
                </div>
                <div class="p-5 sm:p-6 space-y-4">
                    <div class="flex flex-col sm:flex-row gap-3">
                        <div class="relative flex-1">
                            <input type="text" id="generated-key-display" readonly 
                                   class="w-full p-3.5 sm:p-4 rounded-xl bg-rjb-bg-light dark:bg-rjb-bg-dark border-2 border-rjb-yellow/30 text-rjb-text dark:text-rjb-text-dark font-mono font-bold text-center text-sm sm:text-base focus:border-rjb-yellow focus:ring-2 focus:ring-rjb-yellow/20 transition-all"
                                   placeholder="--- CLIQUE PARA GERAR ---">
                            <button onclick="copyKeyToClipboard()" class="absolute right-2 top-1/2 -translate-y-1/2 p-2 text-rjb-text/50 hover:text-rjb-yellow transition-colors" title="Copiar chave">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                </svg>
                            </button>
                        </div>
                        <button onclick="uiGenerateAndPrepare()" 
                                class="bg-gradient-to-r from-rjb-yellow to-yellow-500 text-rjb-text font-bold py-3.5 sm:py-4 px-6 rounded-xl hover:from-yellow-500 hover:to-yellow-600 transition-all shadow-lg hover:shadow-xl transform hover:scale-[1.02] flex items-center justify-center gap-2 text-sm sm:text-base whitespace-nowrap">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            Gerar Nova Chave
                        </button>
                    </div>
                    
                    <div id="whatsapp-share-area" class="hidden">
                        <button onclick="shareViaWhatsApp()" 
                                class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold py-3.5 rounded-xl flex items-center justify-center gap-3 transition-all shadow-lg hover:shadow-xl transform hover:scale-[1.02] text-sm sm:text-base">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                            </svg>
                            <span>Enviar via WhatsApp</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Gerenciamento de Membros Card -->
            <div id="member-report-details" class="bg-gradient-to-br from-rjb-card-light to-rjb-bg-light dark:from-rjb-card-dark dark:to-rjb-bg-dark/50 rounded-2xl shadow-xl border-2 border-rjb-yellow/20 overflow-hidden">
                <div class="bg-gradient-to-r from-rjb-yellow/20 via-rjb-yellow/15 to-rjb-yellow/10 dark:from-rjb-yellow/10 dark:via-rjb-yellow/5 dark:to-rjb-yellow/5 px-5 sm:px-6 py-4 border-b border-rjb-yellow/30">
                    <div class="flex items-center justify-between gap-3">
                        <div class="flex items-center gap-3">
                            <div class="p-2 rounded-lg bg-rjb-yellow/20 dark:bg-rjb-yellow/10">
                                <svg class="w-5 h-5 sm:w-6 sm:h-6 text-rjb-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                </svg>
                            </div>
                            <h3 class="text-lg sm:text-xl md:text-2xl font-bold text-rjb-text dark:text-rjb-text-dark">Gerenciamento de Membros</h3>
                        </div>
                        <button onclick="normalizeAllMemberNames()" 
                                class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold py-2 px-4 rounded-lg transition-all shadow-md hover:shadow-lg transform hover:scale-[1.02] flex items-center gap-2 text-xs sm:text-sm whitespace-nowrap">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            Normalizar Nomes
                        </button>
                    </div>
                </div>
                <div class="p-5 sm:p-6">
                    ${generateSkeletonScreen('members')}
                </div>
            </div>

            <!-- Gerenciamento de Anexos Card -->
            <div class="bg-gradient-to-br from-rjb-card-light to-rjb-bg-light dark:from-rjb-card-dark dark:to-rjb-bg-dark/50 rounded-2xl shadow-xl border-2 border-rjb-yellow/20 overflow-hidden">
                <div class="bg-gradient-to-r from-rjb-yellow/20 via-rjb-yellow/15 to-rjb-yellow/10 dark:from-rjb-yellow/10 dark:via-rjb-yellow/5 dark:to-rjb-yellow/5 px-5 sm:px-6 py-4 border-b border-rjb-yellow/30">
                    <div class="flex items-center gap-3">
                        <div class="p-2 rounded-lg bg-rjb-yellow/20 dark:bg-rjb-yellow/10">
                            <svg class="w-5 h-5 sm:w-6 sm:h-6 text-rjb-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg sm:text-xl md:text-2xl font-bold text-rjb-text dark:text-rjb-text-dark">Gerenciamento de Anexos</h3>
                    </div>
                </div>
                <div class="p-5 sm:p-6 space-y-4">
                    <form id="file-upload-form" onsubmit="handleFileUpload(event);" class="p-4 sm:p-5 border-2 border-dashed border-rjb-yellow/50 rounded-xl bg-rjb-bg-light/50 dark:bg-rjb-bg-dark/30 hover:border-rjb-yellow transition-colors">
                        <div class="flex flex-col sm:flex-row gap-3">
                            <input type="file" id="attachment-file" name="file" required 
                                   class="w-full sm:flex-1 p-3 text-sm border-2 border-rjb-yellow/30 rounded-xl bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text dark:text-rjb-text-dark focus:border-rjb-yellow focus:ring-2 focus:ring-rjb-yellow/20 transition-all file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-rjb-yellow file:text-rjb-text hover:file:bg-yellow-500">
                            <button type="submit" class="bg-gradient-to-r from-rjb-yellow to-yellow-500 text-rjb-text font-bold py-3 px-6 rounded-xl hover:from-yellow-500 hover:to-yellow-600 transition-all shadow-lg hover:shadow-xl transform hover:scale-[1.02] flex items-center justify-center gap-2 text-sm sm:text-base whitespace-nowrap">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                </svg>
                                Upload
                            </button>
                        </div>
                    </form>

                    <div id="attachments-output-area" class="space-y-2 sm:space-y-3">
                        ${generateSkeletonScreen('attachments')}
                    </div>
                </div>
            </div>

            <!-- Logout Button -->
            <div class="flex justify-center sm:justify-end pt-4">
                <button onclick="adminLogout()" class="bg-rjb-card-light dark:bg-rjb-card-dark border-2 border-rjb-yellow/50 text-rjb-yellow font-bold py-3 px-6 rounded-xl hover:bg-rjb-yellow/10 hover:border-rjb-yellow transition-all shadow-lg hover:shadow-xl transform hover:scale-[1.02] flex items-center justify-center gap-2 text-sm sm:text-base">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                    Sair da √Årea Administrativa
                </button>
            </div>
        </div>
    </div>`;
        }

        // Fun√ß√£o para gerar p√°gina da √Årea Financeira (role 'financeiro' ou 'admin-financeiro')
        function generateFinancePage() {
            const role = localStorage.getItem('adminRole');
            if (role !== 'financeiro' && role !== 'admin-financeiro') {
                return `
                    <div class="max-w-4xl mx-auto text-center py-12">
                        <svg class="w-16 h-16 text-red-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                        <h2 class="text-2xl font-bold text-rjb-text dark:text-rjb-text-dark mb-4">Acesso Negado</h2>
                        <p class="text-rjb-text/70 dark:text-rjb-text-dark/70">Voc√™ n√£o tem permiss√£o para acessar a √°rea financeira. Acesso restrito ao respons√°vel financeiro.</p>
                    </div>
                `;
            }

            return `
    <div class="max-w-7xl mx-auto">
        <!-- Breadcrumb Navigation -->
        <nav class="mb-4 sm:mb-6" aria-label="Breadcrumb">
            <ol class="flex items-center space-x-1 sm:space-x-2 text-xs sm:text-sm flex-wrap">
                <li>
                    <button onclick="navigateTo('home')" class="text-rjb-text/70 dark:text-rjb-text-dark/70 hover:text-rjb-yellow transition-colors">
                        Home
                    </button>
                </li>
                <li class="text-rjb-text/50 dark:text-rjb-text-dark/50">/</li>
                <li>
                    <button onclick="navigateTo('reports')" class="text-rjb-text/70 dark:text-rjb-text-dark/70 hover:text-rjb-yellow transition-colors">
                        √Årea Administrativa
                    </button>
                </li>
                <li class="text-rjb-text/50 dark:text-rjb-text-dark/50">/</li>
                <li class="text-green-600 font-medium">Financeiro</li>
            </ol>
        </nav>

        <!-- Header Section -->
        <div class="mb-6 sm:mb-8">
            <div class="flex items-center gap-2 sm:gap-3 mb-2">
                <svg class="w-6 h-6 sm:w-8 sm:h-8 md:w-10 md:h-10 text-green-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <h2 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-extrabold text-green-600 break-words">√Årea Financeira</h2>
            </div>
            <p class="text-rjb-text/70 dark:text-rjb-text-dark/70 text-xs sm:text-sm md:text-base ml-8 sm:ml-11 md:ml-14">Controle de contribui√ß√µes, dep√≥sitos e gastos da RJB</p>
        </div>

        <!-- Tabs Navigation -->
        <div class="mb-4 sm:mb-6 border-b border-gray-200 dark:border-gray-700">
            <nav class="flex space-x-1 sm:space-x-2 overflow-x-auto pb-1 -mb-px">
                <button onclick="switchFinanceTab('contributions')" id="tab-contributions" class="finance-tab px-3 sm:px-4 py-2 font-semibold text-xs sm:text-sm border-b-2 border-transparent text-rjb-text/70 dark:text-rjb-text-dark/70 hover:text-green-600 whitespace-nowrap">
                    Contribui√ß√µes
                </button>
                <button onclick="switchFinanceTab('deposits')" id="tab-deposits" class="finance-tab px-3 sm:px-4 py-2 font-semibold text-xs sm:text-sm border-b-2 border-transparent text-rjb-text/70 dark:text-rjb-text-dark/70 hover:text-green-600 whitespace-nowrap">
                    Dep√≥sitos
                </button>
                <button onclick="switchFinanceTab('expenses')" id="tab-expenses" class="finance-tab px-3 sm:px-4 py-2 font-semibold text-xs sm:text-sm border-b-2 border-transparent text-rjb-text/70 dark:text-rjb-text-dark/70 hover:text-green-600 whitespace-nowrap">
                    Gastos
                </button>
                <button onclick="switchFinanceTab('reports')" id="tab-reports" class="finance-tab active px-3 sm:px-4 py-2 font-semibold text-xs sm:text-sm border-b-2 border-green-600 text-green-600 whitespace-nowrap">
                    Relat√≥rios
                </button>
            </nav>
        </div>

        <!-- Tab Content: Contribui√ß√µes -->
        <div id="finance-tab-contributions" class="finance-tab-content hidden">
            <div class="bg-gradient-to-br from-rjb-card-light to-rjb-bg-light dark:from-rjb-card-dark dark:to-rjb-bg-dark/50 rounded-2xl shadow-xl border-2 border-green-600/20 overflow-hidden mb-6">
                <div class="bg-gradient-to-r from-green-600/20 via-green-600/15 to-green-600/10 dark:from-green-600/10 dark:via-green-600/5 dark:to-green-600/5 px-5 sm:px-6 py-4 border-b border-green-600/30">
                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0">
                        <div class="flex items-center gap-3">
                            <div class="p-2 rounded-lg bg-green-600/20 dark:bg-green-600/10">
                                <svg class="w-5 h-5 sm:w-6 sm:h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                            <div>
                                <h3 class="text-base sm:text-lg md:text-xl lg:text-2xl font-bold text-rjb-text dark:text-rjb-text-dark">Contribui√ß√µes Mensais</h3>
                                <p class="text-xs sm:text-sm text-rjb-text/70 dark:text-rjb-text-dark/70 mt-0.5">Valor mensal obrigat√≥rio: <span class="font-semibold text-green-600">R$ 20,00</span></p>
                            </div>
                        </div>
                        <button onclick="openAddContributionModal()" class="w-full sm:w-auto bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 sm:py-2 px-4 rounded-lg transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2 text-xs sm:text-sm whitespace-nowrap">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            Nova Contribui√ß√£o
                        </button>
                    </div>
                </div>
                <div class="p-5 sm:p-6">
                    <div id="contributions-list" class="space-y-3">
                        <p class="text-center text-rjb-text/70 dark:text-rjb-text-dark/70">Carregando contribui√ß√µes...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Dep√≥sitos -->
        <div id="finance-tab-deposits" class="finance-tab-content hidden">
            <div class="bg-gradient-to-br from-rjb-card-light to-rjb-bg-light dark:from-rjb-card-dark dark:to-rjb-bg-dark/50 rounded-2xl shadow-xl border-2 border-green-600/20 overflow-hidden mb-6">
                <div class="bg-gradient-to-r from-green-600/20 via-green-600/15 to-green-600/10 dark:from-green-600/10 dark:via-green-600/5 dark:to-green-600/5 px-5 sm:px-6 py-4 border-b border-green-600/30">
                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0">
                        <div class="flex items-center gap-3">
                            <div class="p-2 rounded-lg bg-green-600/20 dark:bg-green-600/10">
                                <svg class="w-5 h-5 sm:w-6 sm:h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                </svg>
                            </div>
                            <h3 class="text-base sm:text-lg md:text-xl lg:text-2xl font-bold text-rjb-text dark:text-rjb-text-dark">Dep√≥sitos e Comprovantes</h3>
                        </div>
                        <button onclick="openAddDepositModal()" class="w-full sm:w-auto bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 sm:py-2 px-4 rounded-lg transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2 text-xs sm:text-sm whitespace-nowrap">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            Novo Dep√≥sito
                        </button>
                    </div>
                </div>
                <div class="p-5 sm:p-6">
                    <div id="deposits-total" class="mb-4 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                        <div class="flex items-center justify-between">
                            <span class="text-sm sm:text-base font-semibold text-green-800 dark:text-green-200">Total de Dep√≥sitos:</span>
                            <span class="text-lg sm:text-xl font-bold text-green-600 dark:text-green-400" id="deposits-total-value">R$ 0,00</span>
                        </div>
                    </div>
                    <div id="deposits-list" class="space-y-3">
                        <p class="text-center text-rjb-text/70 dark:text-rjb-text-dark/70">Carregando dep√≥sitos...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Gastos -->
        <div id="finance-tab-expenses" class="finance-tab-content hidden">
            <div class="bg-gradient-to-br from-rjb-card-light to-rjb-bg-light dark:from-rjb-card-dark dark:to-rjb-bg-dark/50 rounded-2xl shadow-xl border-2 border-green-600/20 overflow-hidden mb-6">
                <div class="bg-gradient-to-r from-green-600/20 via-green-600/15 to-green-600/10 dark:from-green-600/10 dark:via-green-600/5 dark:to-green-600/5 px-5 sm:px-6 py-4 border-b border-green-600/30">
                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0">
                        <div class="flex items-center gap-3">
                            <div class="p-2 rounded-lg bg-green-600/20 dark:bg-green-600/10">
                                <svg class="w-5 h-5 sm:w-6 sm:h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                </svg>
                            </div>
                            <h3 class="text-base sm:text-lg md:text-xl lg:text-2xl font-bold text-rjb-text dark:text-rjb-text-dark">Gastos da RJB</h3>
                        </div>
                        <button onclick="openAddExpenseModal()" class="w-full sm:w-auto bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 sm:py-2 px-4 rounded-lg transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2 text-xs sm:text-sm whitespace-nowrap">
                            <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            Novo Gasto
                        </button>
                    </div>
                </div>
                <div class="p-5 sm:p-6">
                    <div id="expenses-total" class="mb-4 p-4 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800">
                        <div class="flex items-center justify-between">
                            <span class="text-sm sm:text-base font-semibold text-red-800 dark:text-red-200">Total de Gastos:</span>
                            <span class="text-lg sm:text-xl font-bold text-red-600 dark:text-red-400" id="expenses-total-value">R$ 0,00</span>
                        </div>
                    </div>
                    <div id="expenses-list" class="space-y-3">
                        <p class="text-center text-rjb-text/70 dark:text-rjb-text-dark/70">Carregando gastos...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Relat√≥rios -->
        <div id="finance-tab-reports" class="finance-tab-content hidden">
            <div class="space-y-6">
                <!-- Relat√≥rio de Pagamentos e Pend√™ncias -->
                <div class="bg-gradient-to-br from-rjb-card-light to-rjb-bg-light dark:from-rjb-card-dark dark:to-rjb-bg-dark/50 rounded-2xl shadow-xl border-2 border-green-600/20 overflow-hidden">
                    <div class="bg-gradient-to-r from-green-600/20 via-green-600/15 to-green-600/10 dark:from-green-600/10 dark:via-green-600/5 dark:to-green-600/5 px-5 sm:px-6 py-4 border-b border-green-600/30">
                        <h3 class="text-lg sm:text-xl md:text-2xl font-bold text-rjb-text dark:text-rjb-text-dark">Relat√≥rio de Pagamentos e Pend√™ncias</h3>
                    </div>
                    <div class="p-5 sm:p-6">
                        <div class="mb-4 p-3 sm:p-4 bg-green-600/10 dark:bg-green-600/5 rounded-lg border border-green-600/20">
                            <p class="text-xs sm:text-sm text-rjb-text/80 dark:text-rjb-text-dark/80">
                                <strong class="text-green-600">Valor Mensal Obrigat√≥rio:</strong> Cada membro deve contribuir com <strong>R$ 20,00</strong> mensalmente desde a data de seu cadastro.
                            </p>
                        </div>
                        <div class="mb-4 flex flex-col sm:flex-row gap-3">
                            <input type="text" id="report-search" placeholder="Buscar por nome..." class="flex-1 p-2 rounded-lg border border-green-600/30 bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text dark:text-rjb-text-dark" oninput="filterPaymentReport()">
                            <select id="report-year" class="p-2 rounded-lg border border-green-600/30 bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text dark:text-rjb-text-dark">
                                <option value="">Todos os anos</option>
                            </select>
                            <select id="report-month" class="p-2 rounded-lg border border-green-600/30 bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text dark:text-rjb-text-dark">
                                <option value="">Todos os meses</option>
                            </select>
                            <button onclick="loadPaymentReport()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-all whitespace-nowrap">
                                Gerar Relat√≥rio
                            </button>
                            <button onclick="generatePDFReport()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-all whitespace-nowrap flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                PDF
                            </button>
                        </div>
                        <div id="payment-report-content">
                            <p class="text-center text-rjb-text/70 dark:text-rjb-text-dark/70">Clique em "Gerar Relat√≥rio" para visualizar os dados</p>
                        </div>
                    </div>
                </div>
                
                <!-- Relat√≥rio de Valor em Caixa -->
                <div class="bg-gradient-to-br from-rjb-card-light to-rjb-bg-light dark:from-rjb-card-dark dark:to-rjb-bg-dark/50 rounded-2xl shadow-xl border-2 border-green-600/20 overflow-hidden">
                    <div class="bg-gradient-to-r from-green-600/20 via-green-600/15 to-green-600/10 dark:from-green-600/10 dark:via-green-600/5 dark:to-green-600/5 px-5 sm:px-6 py-4 border-b border-green-600/30">
                        <h3 class="text-lg sm:text-xl md:text-2xl font-bold text-rjb-text dark:text-rjb-text-dark">Valor em Caixa</h3>
                    </div>
                    <div class="p-5 sm:p-6">
                        <div class="mb-4">
                            <button onclick="loadCashFlowReport()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-all whitespace-nowrap">
                                Gerar Relat√≥rio de Caixa
                            </button>
                        </div>
                        <div id="cash-flow-report-content">
                            <p class="text-center text-rjb-text/70 dark:text-rjb-text-dark/70">Clique em "Gerar Relat√≥rio de Caixa" para visualizar os dados</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
            `;
        }

        // ========== FUN√á√ïES DA √ÅREA FINANCEIRA ==========
        
        const API_BASE_FINANCE = 'https://rjb-email-sender-215755766100.europe-west1.run.app';
        const MONTHLY_CONTRIBUTION_AMOUNT = 20.00; // Valor mensal obrigat√≥rio de contribui√ß√£o
        let currentFinanceTab = 'contributions';
        let financePageInitialized = false; // Flag para controlar inicializa√ß√£o

        // Trocar entre abas da √°rea financeira
        function switchFinanceTab(tab) {
            currentFinanceTab = tab;
            
            // Atualiza tabs
            document.querySelectorAll('.finance-tab').forEach(t => {
                t.classList.remove('active', 'border-green-600', 'text-green-600');
                t.classList.add('border-transparent', 'text-rjb-text/70', 'dark:text-rjb-text-dark/70');
            });
            document.getElementById(`tab-${tab}`).classList.add('active', 'border-green-600', 'text-green-600');
            document.getElementById(`tab-${tab}`).classList.remove('border-transparent', 'text-rjb-text/70', 'dark:text-rjb-text-dark/70');
            
            // Atualiza conte√∫do
            document.querySelectorAll('.finance-tab-content').forEach(c => c.classList.add('hidden'));
            document.getElementById(`finance-tab-${tab}`).classList.remove('hidden');
            
            // Carrega dados da aba
            if (tab === 'contributions') {
                loadMembersList();
                loadContributions();
            } else if (tab === 'deposits') {
                loadMembersList();
                loadDeposits();
            } else if (tab === 'expenses') {
                loadExpenses();
            } else if (tab === 'reports') {
                initializeReportFilters();
                // Carregar relat√≥rio automaticamente em ordem alfab√©tica
                loadPaymentReport();
            }
        }

        // Inicializar √°rea financeira quando a p√°gina for gerada
        function initializeFinancePage() {
            if (!financePageInitialized) {
                financePageInitialized = true;
                // Definir aba de relat√≥rios como padr√£o e carregar
                currentFinanceTab = 'reports';
                // Aguardar um pouco para garantir que o DOM foi renderizado
                setTimeout(() => {
                    // Atualizar visualiza√ß√£o das tabs
                    document.querySelectorAll('.finance-tab').forEach(t => {
                        t.classList.remove('active', 'border-green-600', 'text-green-600');
                        t.classList.add('border-transparent', 'text-rjb-text/70', 'dark:text-rjb-text-dark/70');
                    });
                    const reportsTab = document.getElementById('tab-reports');
                    if (reportsTab) {
                        reportsTab.classList.add('active', 'border-green-600', 'text-green-600');
                        reportsTab.classList.remove('border-transparent', 'text-rjb-text/70', 'dark:text-rjb-text-dark/70');
                    }
                    
                    // Atualizar conte√∫do das tabs
                    document.querySelectorAll('.finance-tab-content').forEach(c => c.classList.add('hidden'));
                    const reportsContent = document.getElementById('finance-tab-reports');
                    if (reportsContent) {
                        reportsContent.classList.remove('hidden');
                    }
                    
                    // Inicializar filtros e carregar relat√≥rio
                    initializeReportFilters();
                    loadPaymentReport(); // Carregar relat√≥rio automaticamente em ordem alfab√©tica
                }, 200);
            }
        }

        // Carregar contribui√ß√µes
        async function loadContributions() {
            const token = localStorage.getItem('adminToken');
            const listEl = document.getElementById('contributions-list');
            if (!listEl) return;
            
            listEl.innerHTML = '<p class="text-center text-rjb-text/70 dark:text-rjb-text-dark/70">Carregando...</p>';
            
            try {
                const response = await fetch(`${API_BASE_FINANCE}/api/finance/contributions`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                
                if (response.ok && data.contributions) {
                    if (data.contributions.length === 0) {
                        listEl.innerHTML = '<p class="text-center text-rjb-text/70 dark:text-rjb-text-dark/70">Nenhuma contribui√ß√£o registrada.</p>';
                    } else {
                        listEl.innerHTML = data.contributions.map(c => `
                            <div class="bg-rjb-bg-light dark:bg-rjb-bg-dark p-3 sm:p-4 rounded-lg border border-green-600/20 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
                                <div class="flex-1 min-w-0">
                                    <p class="font-bold text-sm sm:text-base text-rjb-text dark:text-rjb-text-dark break-words">${c.memberName || 'Membro'}</p>
                                    <p class="text-xs sm:text-sm text-rjb-text/70 dark:text-rjb-text-dark/70 mt-1">${c.month}/${c.year} - R$ ${c.amount.toFixed(2)}</p>
                                    <span class="inline-block mt-2 px-2 py-1 text-xs rounded ${c.status === 'paid' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200'}">${c.status === 'paid' ? 'Pago' : 'Pendente'}</span>
                                </div>
                                <div class="flex flex-wrap gap-2 w-full sm:w-auto">
                                    ${c.receiptUrl ? `<a href="${c.receiptUrl}" target="_blank" class="flex-1 sm:flex-none px-3 py-1.5 sm:py-2 text-xs sm:text-sm text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 rounded transition text-center">Ver Comprovante</a>` : ''}
                                    <button onclick="editContribution('${c.id}')" class="flex-1 sm:flex-none px-3 py-1.5 sm:py-2 text-xs sm:text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition">Editar</button>
                                    <button onclick="deleteContribution('${c.id}')" class="flex-1 sm:flex-none px-3 py-1.5 sm:py-2 text-xs sm:text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition">Excluir</button>
                                </div>
                            </div>
                        `).join('');
                    }
                }
            } catch (error) {
                listEl.innerHTML = '<p class="text-center text-red-500">Erro ao carregar contribui√ß√µes.</p>';
            }
        }

        // Carregar dep√≥sitos
        async function loadDeposits() {
            const token = localStorage.getItem('adminToken');
            const listEl = document.getElementById('deposits-list');
            if (!listEl) return;
            
            listEl.innerHTML = '<p class="text-center text-rjb-text/70 dark:text-rjb-text-dark/70">Carregando...</p>';
            
            try {
                const response = await fetch(`${API_BASE_FINANCE}/api/finance/deposits`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                
                if (response.ok && data.deposits) {
                    // Calcular total
                    const total = data.deposits.reduce((sum, d) => sum + (d.amount || 0), 0);
                    const totalEl = document.getElementById('deposits-total-value');
                    if (totalEl) {
                        totalEl.textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
                    }
                    
                    if (data.deposits.length === 0) {
                        listEl.innerHTML = '<p class="text-center text-rjb-text/70 dark:text-rjb-text-dark/70">Nenhum dep√≥sito registrado.</p>';
                    } else {
                        listEl.innerHTML = data.deposits.map(d => {
                            const date = d.depositDate ? new Date(d.depositDate).toLocaleDateString('pt-BR') : 'N/A';
                            return `
                                <div class="bg-rjb-bg-light dark:bg-rjb-bg-dark p-3 sm:p-4 rounded-lg border border-green-600/20">
                                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
                                        <div class="flex-1 min-w-0">
                                            <p class="font-bold text-sm sm:text-base text-rjb-text dark:text-rjb-text-dark break-words">${d.memberName || 'Membro'}</p>
                                            <p class="text-xs sm:text-sm text-rjb-text/70 dark:text-rjb-text-dark/70 mt-1">${date} - R$ ${d.amount.toFixed(2)}</p>
                                            ${d.description ? `<p class="text-xs sm:text-sm text-rjb-text/60 dark:text-rjb-text-dark/60 mt-1 break-words">${d.description}</p>` : ''}
                                        </div>
                                        <div class="flex flex-wrap gap-2 w-full sm:w-auto">
                                            ${d.receiptUrl ? `<a href="${d.receiptUrl}" target="_blank" class="flex-1 sm:flex-none px-3 py-1.5 sm:py-2 text-xs sm:text-sm text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 rounded transition text-center">Ver Comprovante</a>` : ''}
                                            <button onclick="editDeposit('${d.id}')" class="flex-1 sm:flex-none px-3 py-1.5 sm:py-2 text-xs sm:text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition">Editar</button>
                                            <button onclick="deleteDeposit('${d.id}')" class="flex-1 sm:flex-none px-3 py-1.5 sm:py-2 text-xs sm:text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition">Excluir</button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('');
                    }
                }
            } catch (error) {
                listEl.innerHTML = '<p class="text-center text-red-500">Erro ao carregar dep√≥sitos.</p>';
            }
        }

        // Carregar gastos
        async function loadExpenses() {
            const token = localStorage.getItem('adminToken');
            const listEl = document.getElementById('expenses-list');
            if (!listEl) return;
            
            listEl.innerHTML = '<p class="text-center text-rjb-text/70 dark:text-rjb-text-dark/70">Carregando...</p>';
            
            try {
                const response = await fetch(`${API_BASE_FINANCE}/api/finance/expenses`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                
                if (response.ok && data.expenses) {
                    // Calcular total
                    const total = data.expenses.reduce((sum, e) => sum + (e.amount || 0), 0);
                    const totalEl = document.getElementById('expenses-total-value');
                    if (totalEl) {
                        totalEl.textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
                    }
                    
                    if (data.expenses.length === 0) {
                        listEl.innerHTML = '<p class="text-center text-rjb-text/70 dark:text-rjb-text-dark/70">Nenhum gasto registrado.</p>';
                    } else {
                        listEl.innerHTML = data.expenses.map(e => {
                            const date = e.expenseDate ? new Date(e.expenseDate).toLocaleDateString('pt-BR') : 'N/A';
                            return `
                                <div class="bg-rjb-bg-light dark:bg-rjb-bg-dark p-3 sm:p-4 rounded-lg border border-green-600/20 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
                                    <div class="flex-1 min-w-0">
                                        <p class="font-bold text-sm sm:text-base text-rjb-text dark:text-rjb-text-dark break-words">${e.description}</p>
                                        <p class="text-xs sm:text-sm text-rjb-text/70 dark:text-rjb-text-dark/70 mt-1">${date} - R$ ${e.amount.toFixed(2)}</p>
                                        ${e.category ? `<span class="inline-block mt-2 px-2 py-1 text-xs rounded bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200">${e.category}</span>` : ''}
                                    </div>
                                    <div class="flex flex-wrap gap-2 w-full sm:w-auto">
                                        ${e.receiptUrl ? `<a href="${e.receiptUrl}" target="_blank" class="flex-1 sm:flex-none px-3 py-1.5 sm:py-2 text-xs sm:text-sm text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 rounded transition text-center">Ver Comprovante</a>` : ''}
                                        <button onclick="editExpense('${e.id}')" class="flex-1 sm:flex-none px-3 py-1.5 sm:py-2 text-xs sm:text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition">Editar</button>
                                        <button onclick="deleteExpense('${e.id}')" class="flex-1 sm:flex-none px-3 py-1.5 sm:py-2 text-xs sm:text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition">Excluir</button>
                                    </div>
                                </div>
                            `;
                        }).join('');
                    }
                }
            } catch (error) {
                listEl.innerHTML = '<p class="text-center text-red-500">Erro ao carregar gastos.</p>';
            }
        }

        // Inicializar filtros do relat√≥rio
        function initializeReportFilters() {
            const yearSelect = document.getElementById('report-year');
            const monthSelect = document.getElementById('report-month');
            
            if (yearSelect) {
                const currentYear = new Date().getFullYear();
                yearSelect.innerHTML = '<option value="">Todos os anos</option>';
                for (let y = currentYear; y >= 2020; y--) {
                    yearSelect.innerHTML += `<option value="${y}">${y}</option>`;
                }
            }
            
            if (monthSelect) {
                const months = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                monthSelect.innerHTML = '<option value="">Todos os meses</option>';
                months.forEach((m, i) => {
                    monthSelect.innerHTML += `<option value="${i+1}">${m}</option>`;
                });
            }
        }

        // Armazenar dados do relat√≥rio para busca e PDF
        let currentReportData = [];
        let currentReportPage = 1;
        const ITEMS_PER_PAGE = 10;

        // Carregar relat√≥rio de pagamentos
        async function loadPaymentReport() {
            const token = localStorage.getItem('adminToken');
            const reportEl = document.getElementById('payment-report-content');
            if (!reportEl) return;
            
            const year = document.getElementById('report-year')?.value || '';
            const month = document.getElementById('report-month')?.value || '';
            
            reportEl.innerHTML = '<p class="text-center text-rjb-text/70 dark:text-rjb-text-dark/70">Carregando relat√≥rio...</p>';
            
            try {
                const url = `${API_BASE_FINANCE}/api/finance/reports/payments${year || month ? `?${year ? `year=${year}` : ''}${year && month ? '&' : ''}${month ? `month=${month}` : ''}` : ''}`;
                const response = await fetch(url, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                
                if (response.ok && data.report) {
                    // Armazenar dados para busca e PDF
                    currentReportData = data.report;
                    
                    // Resetar para primeira p√°gina ao carregar novo relat√≥rio
                    currentReportPage = 1;
                    
                    // Limpar campo de busca
                    const searchInput = document.getElementById('report-search');
                    if (searchInput) {
                        searchInput.value = '';
                    }
                    
                    if (data.report.length === 0) {
                        reportEl.innerHTML = '<p class="text-center text-rjb-text/70 dark:text-rjb-text-dark/70">Nenhum dado encontrado.</p>';
                    } else {
                        // Carregar membros para o hist√≥rico
                        await loadMembersList();
                        
                        // Renderizar relat√≥rio (ser√° filtrado pela busca se necess√°rio)
                        renderPaymentReport(data.report);
                    }
                }
            } catch (error) {
                reportEl.innerHTML = '<p class="text-center text-red-500">Erro ao carregar relat√≥rio.</p>';
            }
        }

        // Renderizar relat√≥rio de pagamentos com pagina√ß√£o
        function renderPaymentReport(reportData) {
            const reportEl = document.getElementById('payment-report-content');
            if (!reportEl) return;
            
            // Garantir ordena√ß√£o alfab√©tica (caso n√£o venha ordenado do backend)
            const sortedData = [...reportData].sort((a, b) => {
                const nameA = (a.memberName || '').toLowerCase().trim();
                const nameB = (b.memberName || '').toLowerCase().trim();
                return nameA.localeCompare(nameB, 'pt-BR');
            });
            
            // Calcular pagina√ß√£o
            const totalPages = Math.ceil(sortedData.length / ITEMS_PER_PAGE);
            const startIndex = (currentReportPage - 1) * ITEMS_PER_PAGE;
            const endIndex = startIndex + ITEMS_PER_PAGE;
            const paginatedData = sortedData.slice(startIndex, endIndex);
            
            // Vers√£o mobile: cards
            const mobileCards = paginatedData.map(r => `
                <div class="lg:hidden bg-rjb-bg-light dark:bg-rjb-bg-dark p-4 rounded-lg border border-green-600/20 mb-3 report-item" data-member-name="${(r.memberName || '').toLowerCase()}">
                    <p class="font-bold text-sm text-rjb-text dark:text-rjb-text-dark mb-2">${r.memberName}</p>
                    <div class="space-y-1 text-xs sm:text-sm">
                        <p class="text-rjb-text/70 dark:text-rjb-text-dark/70">√öltimo m√™s pago: <span class="font-semibold">${r.lastPaidMonth}</span></p>
                        <p class="text-rjb-text/70 dark:text-rjb-text-dark/70">Total pago: <span class="font-semibold text-green-600">R$ ${r.totalPaid.toFixed(2)}</span> ${r.totalPaid >= (r.annualAmount2026 || 240.00) ? '<span class="text-xs bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 px-2 py-0.5 rounded ml-2">Em dia</span>' : ''}</p>
                        <p class="text-rjb-text/70 dark:text-rjb-text-dark/70">Meses pendentes: <span class="font-semibold ${r.pendingMonths > 0 ? 'text-red-600' : 'text-green-600'}">${r.pendingMonths || 0}</span></p>
                        <p class="text-rjb-text/70 dark:text-rjb-text-dark/70">Valor pendente: <span class="font-semibold ${r.totalPending > 0 ? 'text-red-600' : 'text-green-600'}">R$ ${r.totalPending.toFixed(2)}</span></p>
                        ${r.totalPaid < (r.annualAmount2026 || 240.00) ? `<p class="text-xs text-rjb-text/60 dark:text-rjb-text-dark/60 mt-1">Meta anual 2026: R$ ${(r.annualAmount2026 || 240.00).toFixed(2)}</p>` : ''}
                    </div>
                    <button onclick="viewMemberHistory('${r.memberId}')" class="mt-3 w-full px-3 py-2 text-xs sm:text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded transition">Ver Hist√≥rico</button>
                </div>
            `).join('');
            
            // Vers√£o desktop: tabela
            const desktopTable = `
                <div class="hidden lg:block overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-green-600/20">
                            <tr>
                                <th class="p-3 text-left">Membro</th>
                                <th class="p-3 text-left">√öltimo M√™s Pago</th>
                                <th class="p-3 text-right">Total Pago</th>
                                <th class="p-3 text-center">Meses Pendentes</th>
                                <th class="p-3 text-right">Valor Pendente</th>
                                <th class="p-3 text-center">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${paginatedData.map(r => `
                                <tr class="border-b border-gray-200 dark:border-gray-700 report-item" data-member-name="${(r.memberName || '').toLowerCase()}">
                                    <td class="p-3">${r.memberName}</td>
                                    <td class="p-3">${r.lastPaidMonth}</td>
                                    <td class="p-3 text-right">
                                        <div class="flex items-center justify-end gap-2">
                                            <span class="text-green-600">R$ ${r.totalPaid.toFixed(2)}</span>
                                            ${r.totalPaid >= (r.annualAmount2026 || 240.00) ? '<span class="text-xs bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 px-2 py-0.5 rounded">Em dia</span>' : ''}
                                        </div>
                                    </td>
                                    <td class="p-3 text-center">
                                        <span class="px-2 py-1 rounded ${r.pendingMonths > 0 ? 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200' : 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200'}">
                                            ${r.pendingMonths || 0}
                                        </span>
                                    </td>
                                    <td class="p-3 text-right ${r.totalPending > 0 ? 'text-red-600 font-semibold' : 'text-green-600'}">R$ ${r.totalPending.toFixed(2)}</td>
                                    <td class="p-3 text-center">
                                        <button onclick="viewMemberHistory('${r.memberId}')" class="text-blue-600 hover:underline text-sm">Hist√≥rico</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            // Controles de pagina√ß√£o
            const paginationControls = generatePaginationControls(totalPages, sortedData.length);
            
            reportEl.innerHTML = mobileCards + desktopTable + paginationControls;
        }

        // Gerar controles de pagina√ß√£o
        function generatePaginationControls(totalPages, totalItems) {
            if (totalPages <= 1) return '';
            
            const startItem = (currentReportPage - 1) * ITEMS_PER_PAGE + 1;
            const endItem = Math.min(currentReportPage * ITEMS_PER_PAGE, totalItems);
            
            let paginationHTML = `
                <div class="mt-6 flex flex-col sm:flex-row items-center justify-between gap-4 pt-4 border-t border-green-600/20">
                    <div class="text-sm text-rjb-text/70 dark:text-rjb-text-dark/70">
                        Mostrando <span class="font-semibold">${startItem}</span> a <span class="font-semibold">${endItem}</span> de <span class="font-semibold">${totalItems}</span> membros
                    </div>
                    <div class="flex items-center gap-2">
                        <button 
                            onclick="changeReportPage(${currentReportPage - 1})" 
                            ${currentReportPage === 1 ? 'disabled' : ''}
                            class="px-3 py-2 text-sm font-medium text-rjb-text dark:text-rjb-text-dark bg-rjb-bg-light dark:bg-rjb-bg-dark border border-green-600/30 rounded-lg hover:bg-green-600/10 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
                            Anterior
                        </button>
                        <div class="flex items-center gap-1">
            `;
            
            // Mostrar n√∫meros de p√°gina (m√°ximo 5 p√°ginas vis√≠veis)
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentReportPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage < maxVisiblePages - 1) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            // Bot√£o primeira p√°gina
            if (startPage > 1) {
                paginationHTML += `
                    <button onclick="changeReportPage(1)" class="px-3 py-2 text-sm font-medium text-rjb-text dark:text-rjb-text-dark bg-rjb-bg-light dark:bg-rjb-bg-dark border border-green-600/30 rounded-lg hover:bg-green-600/10 transition-all">
                        1
                    </button>
                `;
                if (startPage > 2) {
                    paginationHTML += `<span class="px-2 text-rjb-text/50 dark:text-rjb-text-dark/50">...</span>`;
                }
            }
            
            // N√∫meros de p√°gina
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <button 
                        onclick="changeReportPage(${i})" 
                        ${i === currentReportPage ? 'class="px-3 py-2 text-sm font-medium text-white bg-green-600 border border-green-600 rounded-lg transition-all"' : 'class="px-3 py-2 text-sm font-medium text-rjb-text dark:text-rjb-text-dark bg-rjb-bg-light dark:bg-rjb-bg-dark border border-green-600/30 rounded-lg hover:bg-green-600/10 transition-all"'}
                    >
                        ${i}
                    </button>
                `;
            }
            
            // Bot√£o √∫ltima p√°gina
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    paginationHTML += `<span class="px-2 text-rjb-text/50 dark:text-rjb-text-dark/50">...</span>`;
                }
                paginationHTML += `
                    <button onclick="changeReportPage(${totalPages})" class="px-3 py-2 text-sm font-medium text-rjb-text dark:text-rjb-text-dark bg-rjb-bg-light dark:bg-rjb-bg-dark border border-green-600/30 rounded-lg hover:bg-green-600/10 transition-all">
                        ${totalPages}
                    </button>
                `;
            }
            
            paginationHTML += `
                        </div>
                        <button 
                            onclick="changeReportPage(${currentReportPage + 1})" 
                            ${currentReportPage === totalPages ? 'disabled' : ''}
                            class="px-3 py-2 text-sm font-medium text-rjb-text dark:text-rjb-text-dark bg-rjb-bg-light dark:bg-rjb-bg-dark border border-green-600/30 rounded-lg hover:bg-green-600/10 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
                            Pr√≥xima
                        </button>
                    </div>
                </div>
            `;
            
            return paginationHTML;
        }

        // Mudar p√°gina do relat√≥rio
        function changeReportPage(page) {
            const totalPages = Math.ceil(currentReportData.length / ITEMS_PER_PAGE);
            if (page < 1 || page > totalPages) return;
            
            currentReportPage = page;
            renderPaymentReport(currentReportData);
            
            // Scroll suave para o topo do relat√≥rio
            const reportEl = document.getElementById('payment-report-content');
            if (reportEl) {
                reportEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // Filtrar relat√≥rio por nome
        function filterPaymentReport() {
            const searchTerm = (document.getElementById('report-search')?.value || '').toLowerCase().trim();
            
            if (!searchTerm) {
                // Se n√£o h√° busca, mostrar todos os dados com pagina√ß√£o
                currentPage = 1;
                renderPaymentReport(currentReportData);
                return;
            }
            
            // Filtrar dados
            const filteredData = currentReportData.filter(r => {
                const memberName = (r.memberName || '').toLowerCase();
                return memberName.includes(searchTerm);
            });
            
            // Resetar para primeira p√°gina
            currentReportPage = 1;
            
            // Renderizar dados filtrados
            renderPaymentReport(filteredData);
        }

        // Gerar relat√≥rio em PDF
        async function generatePDFReport() {
            if (!currentReportData || currentReportData.length === 0) {
                showMessage('Nenhum relat√≥rio carregado. Gere o relat√≥rio primeiro.', true);
                return;
            }

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('l', 'mm', 'a4'); // Modo paisagem
                
                // T√≠tulo
                doc.setFontSize(18);
                doc.setTextColor(34, 139, 34); // Verde
                doc.text('Relat√≥rio de Pagamentos e Pend√™ncias', 14, 15);
                
                // Filtros aplicados
                const year = document.getElementById('report-year')?.value || '';
                const month = document.getElementById('report-month')?.value || '';
                const monthNames = ['', 'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                let filterText = 'Per√≠odo: Todos';
                if (year && month) {
                    filterText = `Per√≠odo: ${monthNames[parseInt(month)]}/${year}`;
                } else if (year) {
                    filterText = `Per√≠odo: Ano ${year}`;
                } else if (month) {
                    filterText = `Per√≠odo: ${monthNames[parseInt(month)]}`;
                }
                
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(filterText, 14, 22);
                doc.text(`Data de gera√ß√£o: ${new Date().toLocaleDateString('pt-BR')}`, 14, 27);
                
                // Preparar dados da tabela
                const tableData = currentReportData.map(r => [
                    r.memberName || '',
                    r.lastPaidMonth || 'Nunca',
                    `R$ ${r.totalPaid.toFixed(2)}`,
                    r.pendingMonths || 0,
                    `R$ ${r.totalPending.toFixed(2)}`
                ]);
                
                // Criar tabela
                doc.autoTable({
                    head: [['Membro', '√öltimo M√™s Pago', 'Total Pago', 'Meses Pendentes', 'Valor Pendente']],
                    body: tableData,
                    startY: 32,
                    theme: 'striped',
                    headStyles: {
                        fillColor: [34, 139, 34],
                        textColor: [255, 255, 255],
                        fontStyle: 'bold'
                    },
                    columnStyles: {
                        0: { cellWidth: 60 },
                        1: { cellWidth: 40 },
                        2: { cellWidth: 35, halign: 'right' },
                        3: { cellWidth: 35, halign: 'center' },
                        4: { cellWidth: 40, halign: 'right' }
                    },
                    styles: {
                        fontSize: 8,
                        cellPadding: 2
                    }
                });
                
                // Totais
                const totalPaid = currentReportData.reduce((sum, r) => sum + r.totalPaid, 0);
                const totalPending = currentReportData.reduce((sum, r) => sum + r.totalPending, 0);
                const totalMembers = currentReportData.length;
                
                const finalY = doc.lastAutoTable.finalY + 10;
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.setFont(undefined, 'bold');
                doc.text(`Total de Membros: ${totalMembers}`, 14, finalY);
                doc.text(`Total Pago: R$ ${totalPaid.toFixed(2)}`, 14, finalY + 5);
                doc.text(`Total Pendente: R$ ${totalPending.toFixed(2)}`, 14, finalY + 10);
                
                // Salvar PDF
                const fileName = `relatorio-pagamentos-${year || 'todos'}-${month || 'todos'}-${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
                
                showMessage('PDF gerado com sucesso!');
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                showMessage('Erro ao gerar PDF.', true);
            }
        }

        // Carregar relat√≥rio de Valor em Caixa
        async function loadCashFlowReport() {
            const token = localStorage.getItem('adminToken');
            const reportEl = document.getElementById('cash-flow-report-content');
            if (!reportEl) return;
            
            reportEl.innerHTML = '<p class="text-center text-rjb-text/70 dark:text-rjb-text-dark/70">Carregando relat√≥rio...</p>';
            
            try {
                const response = await fetch(`${API_BASE_FINANCE}/api/finance/reports/cash-flow`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                
                if (response.ok && data.summary) {
                    const { totalContributions, totalDeposits, totalExpenses, cashFlow } = data.summary;
                    
                    const html = `
                        <div class="space-y-6">
                            <!-- Resumo -->
                            <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 p-6 rounded-xl border-2 border-green-600/30">
                                <h4 class="text-lg font-bold text-green-800 dark:text-green-200 mb-4">Resumo Financeiro</h4>
                                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-green-200 dark:border-green-800">
                                        <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-1">Contribui√ß√µes Pagas</p>
                                        <p class="text-xl font-bold text-green-600">R$ ${totalContributions.toFixed(2).replace('.', ',')}</p>
                                    </div>
                                    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-green-200 dark:border-green-800">
                                        <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-1">Dep√≥sitos</p>
                                        <p class="text-xl font-bold text-green-600">R$ ${totalDeposits.toFixed(2).replace('.', ',')}</p>
                                    </div>
                                    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-red-200 dark:border-red-800">
                                        <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-1">Gastos</p>
                                        <p class="text-xl font-bold text-red-600">R$ ${totalExpenses.toFixed(2).replace('.', ',')}</p>
                                    </div>
                                    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg border-2 ${cashFlow >= 0 ? 'border-green-500' : 'border-red-500'}">
                                        <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-1">Valor em Caixa</p>
                                        <p class="text-xl font-bold ${cashFlow >= 0 ? 'text-green-600' : 'text-red-600'}">R$ ${cashFlow.toFixed(2).replace('.', ',')}</p>
                                    </div>
                                </div>
                                <div class="mt-4 pt-4 border-t border-green-300 dark:border-green-700">
                                    <p class="text-sm text-gray-700 dark:text-gray-300">
                                        <strong>F√≥rmula:</strong> Contribui√ß√µes (R$ ${totalContributions.toFixed(2).replace('.', ',')}) + Dep√≥sitos (R$ ${totalDeposits.toFixed(2).replace('.', ',')}) - Gastos (R$ ${totalExpenses.toFixed(2).replace('.', ',')}) = <strong>R$ ${cashFlow.toFixed(2).replace('.', ',')}</strong>
                                    </p>
                                </div>
                            </div>
                            
                            <!-- Detalhes -->
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                                <!-- Contribui√ß√µes -->
                                <div class="bg-rjb-bg-light dark:bg-rjb-bg-dark p-4 rounded-lg border border-green-600/20">
                                    <h5 class="font-bold text-green-600 mb-3">Contribui√ß√µes Pagas (${data.details.contributions.length})</h5>
                                    <div class="space-y-2 max-h-64 overflow-y-auto">
                                        ${data.details.contributions.length === 0 ? '<p class="text-sm text-gray-500">Nenhuma contribui√ß√£o paga</p>' : data.details.contributions.map(c => `
                                            <div class="text-xs sm:text-sm p-2 bg-white dark:bg-gray-800 rounded border border-green-200 dark:border-green-800">
                                                <p class="font-semibold">${c.memberName || 'Membro'}</p>
                                                <p class="text-gray-600 dark:text-gray-400">${c.month}/${c.year} - R$ ${c.amount.toFixed(2).replace('.', ',')}</p>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                
                                <!-- Dep√≥sitos -->
                                <div class="bg-rjb-bg-light dark:bg-rjb-bg-dark p-4 rounded-lg border border-green-600/20">
                                    <h5 class="font-bold text-green-600 mb-3">Dep√≥sitos (${data.details.deposits.length})</h5>
                                    <div class="space-y-2 max-h-64 overflow-y-auto">
                                        ${data.details.deposits.length === 0 ? '<p class="text-sm text-gray-500">Nenhum dep√≥sito</p>' : data.details.deposits.map(d => `
                                            <div class="text-xs sm:text-sm p-2 bg-white dark:bg-gray-800 rounded border border-green-200 dark:border-green-800">
                                                <p class="font-semibold">${d.memberName || 'Membro'}</p>
                                                <p class="text-gray-600 dark:text-gray-400">${d.depositDate ? new Date(d.depositDate).toLocaleDateString('pt-BR') : 'N/A'} - R$ ${d.amount.toFixed(2).replace('.', ',')}</p>
                                                ${d.description ? `<p class="text-xs text-gray-500">${d.description}</p>` : ''}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                
                                <!-- Gastos -->
                                <div class="bg-rjb-bg-light dark:bg-rjb-bg-dark p-4 rounded-lg border border-red-600/20">
                                    <h5 class="font-bold text-red-600 mb-3">Gastos (${data.details.expenses.length})</h5>
                                    <div class="space-y-2 max-h-64 overflow-y-auto">
                                        ${data.details.expenses.length === 0 ? '<p class="text-sm text-gray-500">Nenhum gasto</p>' : data.details.expenses.map(e => `
                                            <div class="text-xs sm:text-sm p-2 bg-white dark:bg-gray-800 rounded border border-red-200 dark:border-red-800">
                                                <p class="font-semibold">${e.description}</p>
                                                <p class="text-gray-600 dark:text-gray-400">${e.expenseDate ? new Date(e.expenseDate).toLocaleDateString('pt-BR') : 'N/A'} - R$ ${e.amount.toFixed(2).replace('.', ',')}</p>
                                                ${e.category ? `<p class="text-xs text-gray-500">${e.category}</p>` : ''}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    reportEl.innerHTML = html;
                } else {
                    reportEl.innerHTML = '<p class="text-center text-red-500">Erro ao carregar relat√≥rio.</p>';
                }
            } catch (error) {
                console.error('Erro ao carregar relat√≥rio de caixa:', error);
                reportEl.innerHTML = '<p class="text-center text-red-500">Erro ao carregar relat√≥rio.</p>';
            }
        }

        // ========== FUN√á√ïES DE MODAIS E CRUD ==========
        
        let allMembers = [];

        // Carregar lista de membros para os selects
        async function loadMembersList() {
            const token = localStorage.getItem('adminToken');
            try {
                const response = await fetch(`${API_BASE_FINANCE}/api/reports/members`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                if (response.ok && data.allMembers) {
                    allMembers = data.allMembers;
                    // Preencher selects de membros
                    const selects = ['contribution-member-id', 'deposit-member-id'];
                    selects.forEach(selectId => {
                        const select = document.getElementById(selectId);
                        if (select) {
                            select.innerHTML = '<option value="">Selecione um membro</option>' +
                                allMembers.map(m => `<option value="${m.id}">${m.name}</option>`).join('');
                        }
                    });
                }
            } catch (error) {
                console.error('Erro ao carregar membros:', error);
            }
        }

        // ========== CONTRIBUI√á√ïES ==========
        
        function openAddContributionModal() {
            document.getElementById('contribution-modal-title').textContent = 'Nova Contribui√ß√£o';
            document.getElementById('contribution-form').reset();
            document.getElementById('contribution-id').value = '';
            document.getElementById('contribution-receipt-preview').classList.add('hidden');
            // Define o ano atual como padr√£o
            const yearInput = document.getElementById('contribution-year');
            if (yearInput) {
                yearInput.value = new Date().getFullYear();
            }
            // Define o valor padr√£o de R$ 20,00
            const amountInput = document.getElementById('contribution-amount');
            if (amountInput) {
                amountInput.value = MONTHLY_CONTRIBUTION_AMOUNT.toFixed(2);
            }
            loadMembersList();
            document.getElementById('contribution-modal').classList.remove('hidden');
        }

        async function editContribution(id) {
            const token = localStorage.getItem('adminToken');
            try {
                const response = await fetch(`${API_BASE_FINANCE}/api/finance/contributions`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                const contribution = data.contributions.find(c => c.id === id);
                
                if (contribution) {
                    document.getElementById('contribution-modal-title').textContent = 'Editar Contribui√ß√£o';
                    document.getElementById('contribution-id').value = contribution.id;
                    document.getElementById('contribution-member-id').value = contribution.memberId;
                    document.getElementById('contribution-month').value = contribution.month;
                    document.getElementById('contribution-year').value = contribution.year;
                    document.getElementById('contribution-amount').value = contribution.amount;
                    document.getElementById('contribution-status').value = contribution.status;
                    document.getElementById('contribution-receipt').value = '';
                    if (contribution.receiptUrl) {
                        document.getElementById('contribution-receipt-link').href = contribution.receiptUrl;
                        document.getElementById('contribution-receipt-preview').classList.remove('hidden');
                    } else {
                        document.getElementById('contribution-receipt-preview').classList.add('hidden');
                    }
                    loadMembersList();
                    document.getElementById('contribution-modal').classList.remove('hidden');
                }
            } catch (error) {
                showMessage('Erro ao carregar contribui√ß√£o.', true);
            }
        }

        function closeContributionModal(event) {
            if (!event || event.target.id === 'contribution-modal') {
                document.getElementById('contribution-modal').classList.add('hidden');
            }
        }

        async function saveContribution(event) {
            event.preventDefault();
            const token = localStorage.getItem('adminToken');
            const id = document.getElementById('contribution-id').value;
            const memberId = document.getElementById('contribution-member-id').value;
            const member = allMembers.find(m => m.id === memberId);
            
            let receiptUrl = '';
            const receiptFile = document.getElementById('contribution-receipt').files[0];
            
            // Upload do comprovante se houver arquivo novo
            if (receiptFile) {
                try {
                    const formData = new FormData();
                    formData.append('receipt', receiptFile);
                    
                    const uploadResponse = await fetch(`${API_BASE_FINANCE}/api/finance/contributions/receipt`, {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${token}` },
                        body: formData
                    });
                    
                    if (uploadResponse.ok) {
                        const uploadData = await uploadResponse.json();
                        receiptUrl = uploadData.receiptUrl;
                    } else {
                        showMessage('Erro ao fazer upload do comprovante.', true);
                        return;
                    }
                } catch (error) {
                    showMessage('Erro ao fazer upload do comprovante.', true);
                    return;
                }
            } else {
                // Se n√£o h√° arquivo novo, manter o existente (se estiver editando)
                if (id) {
                    const existingContribution = await fetch(`${API_BASE_FINANCE}/api/finance/contributions`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    }).then(r => r.json()).then(d => d.contributions.find(c => c.id === id));
                    if (existingContribution) receiptUrl = existingContribution.receiptUrl || '';
                }
            }
            
            const data = {
                memberId,
                memberName: member ? member.name : '',
                month: parseInt(document.getElementById('contribution-month').value),
                year: parseInt(document.getElementById('contribution-year').value),
                amount: parseFloat(document.getElementById('contribution-amount').value),
                status: document.getElementById('contribution-status').value,
                receiptUrl
            };

            try {
                const url = id 
                    ? `${API_BASE_FINANCE}/api/finance/contributions/${id}`
                    : `${API_BASE_FINANCE}/api/finance/contributions`;
                const method = id ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    showMessage(id ? 'Contribui√ß√£o atualizada!' : 'Contribui√ß√£o criada!');
                    closeContributionModal();
                    loadContributions();
                } else {
                    const error = await response.json();
                    showMessage(error.message || 'Erro ao salvar.', true);
                }
            } catch (error) {
                showMessage('Erro de conex√£o.', true);
            }
        }

        async function deleteContribution(id) {
            if (!confirm('Deseja realmente excluir esta contribui√ß√£o?')) return;
            
            const token = localStorage.getItem('adminToken');
            try {
                const response = await fetch(`${API_BASE_FINANCE}/api/finance/contributions/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    showMessage('Contribui√ß√£o exclu√≠da!');
                    loadContributions();
                } else {
                    showMessage('Erro ao excluir.', true);
                }
            } catch (error) {
                showMessage('Erro de conex√£o.', true);
            }
        }

        // ========== DEP√ìSITOS ==========
        
        function openAddDepositModal() {
            document.getElementById('deposit-modal-title').textContent = 'Novo Dep√≥sito';
            document.getElementById('deposit-form').reset();
            document.getElementById('deposit-id').value = '';
            document.getElementById('deposit-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('deposit-receipt-preview').classList.add('hidden');
            loadMembersList();
            document.getElementById('deposit-modal').classList.remove('hidden');
        }

        async function editDeposit(id) {
            const token = localStorage.getItem('adminToken');
            try {
                const response = await fetch(`${API_BASE_FINANCE}/api/finance/deposits`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                const deposit = data.deposits.find(d => d.id === id);
                
                if (deposit) {
                    document.getElementById('deposit-modal-title').textContent = 'Editar Dep√≥sito';
                    document.getElementById('deposit-id').value = deposit.id;
                    document.getElementById('deposit-member-id').value = deposit.memberId;
                    document.getElementById('deposit-date').value = deposit.depositDate ? deposit.depositDate.split('T')[0] : '';
                    document.getElementById('deposit-amount').value = deposit.amount;
                    document.getElementById('deposit-description').value = deposit.description || '';
                    
                    if (deposit.receiptUrl) {
                        document.getElementById('deposit-receipt-link').href = deposit.receiptUrl;
                        document.getElementById('deposit-receipt-preview').classList.remove('hidden');
                    } else {
                        document.getElementById('deposit-receipt-preview').classList.add('hidden');
                    }
                    
                    loadMembersList();
                    document.getElementById('deposit-modal').classList.remove('hidden');
                }
            } catch (error) {
                showMessage('Erro ao carregar dep√≥sito.', true);
            }
        }

        function closeDepositModal(event) {
            if (!event || event.target.id === 'deposit-modal') {
                document.getElementById('deposit-modal').classList.add('hidden');
            }
        }

        async function saveDeposit(event) {
            event.preventDefault();
            const token = localStorage.getItem('adminToken');
            const id = document.getElementById('deposit-id').value;
            const memberId = document.getElementById('deposit-member-id').value;
            const member = allMembers.find(m => m.id === memberId);
            
            let receiptUrl = '';
            const receiptFile = document.getElementById('deposit-receipt').files[0];
            
            // Upload do comprovante se houver
            if (receiptFile) {
                try {
                    const formData = new FormData();
                    formData.append('receipt', receiptFile);
                    
                    const uploadResponse = await fetch(`${API_BASE_FINANCE}/api/finance/deposits/receipt`, {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${token}` },
                        body: formData
                    });
                    
                    if (uploadResponse.ok) {
                        const uploadData = await uploadResponse.json();
                        receiptUrl = uploadData.receiptUrl;
                    } else {
                        showMessage('Erro ao fazer upload do comprovante.', true);
                        return;
                    }
                } catch (error) {
                    showMessage('Erro ao fazer upload do comprovante.', true);
                    return;
                }
            } else if (id) {
                // Se editando e n√£o h√° novo arquivo, manter o URL existente
                const existingDeposit = await fetch(`${API_BASE_FINANCE}/api/finance/deposits`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                }).then(r => r.json()).then(d => d.deposits.find(dep => dep.id === id));
                if (existingDeposit) receiptUrl = existingDeposit.receiptUrl || '';
            }

            const data = {
                memberId,
                memberName: member ? member.name : '',
                amount: parseFloat(document.getElementById('deposit-amount').value),
                depositDate: document.getElementById('deposit-date').value,
                description: document.getElementById('deposit-description').value,
                receiptUrl
            };

            try {
                const url = id 
                    ? `${API_BASE_FINANCE}/api/finance/deposits/${id}`
                    : `${API_BASE_FINANCE}/api/finance/deposits`;
                const method = id ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    showMessage(id ? 'Dep√≥sito atualizado!' : 'Dep√≥sito criado!');
                    closeDepositModal();
                    loadDeposits();
                } else {
                    const error = await response.json();
                    showMessage(error.message || 'Erro ao salvar.', true);
                }
            } catch (error) {
                showMessage('Erro de conex√£o.', true);
            }
        }

        async function deleteDeposit(id) {
            if (!confirm('Deseja realmente excluir este dep√≥sito?')) return;
            
            const token = localStorage.getItem('adminToken');
            try {
                const response = await fetch(`${API_BASE_FINANCE}/api/finance/deposits/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    showMessage('Dep√≥sito exclu√≠do!');
                    loadDeposits();
                } else {
                    showMessage('Erro ao excluir.', true);
                }
            } catch (error) {
                showMessage('Erro de conex√£o.', true);
            }
        }

        // ========== GASTOS ==========
        
        function openAddExpenseModal() {
            document.getElementById('expense-modal-title').textContent = 'Novo Gasto';
            document.getElementById('expense-form').reset();
            document.getElementById('expense-id').value = '';
            document.getElementById('expense-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('expense-receipt-preview').classList.add('hidden');
            document.getElementById('expense-modal').classList.remove('hidden');
        }

        async function editExpense(id) {
            const token = localStorage.getItem('adminToken');
            try {
                const response = await fetch(`${API_BASE_FINANCE}/api/finance/expenses`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                const expense = data.expenses.find(e => e.id === id);
                
                if (expense) {
                    document.getElementById('expense-modal-title').textContent = 'Editar Gasto';
                    document.getElementById('expense-id').value = expense.id;
                    document.getElementById('expense-description').value = expense.description;
                    document.getElementById('expense-amount').value = expense.amount;
                    document.getElementById('expense-date').value = expense.expenseDate ? expense.expenseDate.split('T')[0] : '';
                    document.getElementById('expense-category').value = expense.category || 'outros';
                    document.getElementById('expense-receipt').value = '';
                    if (expense.receiptUrl) {
                        document.getElementById('expense-receipt-link').href = expense.receiptUrl;
                        document.getElementById('expense-receipt-preview').classList.remove('hidden');
                    } else {
                        document.getElementById('expense-receipt-preview').classList.add('hidden');
                    }
                    document.getElementById('expense-modal').classList.remove('hidden');
                }
            } catch (error) {
                showMessage('Erro ao carregar gasto.', true);
            }
        }

        function closeExpenseModal(event) {
            if (!event || event.target.id === 'expense-modal') {
                document.getElementById('expense-modal').classList.add('hidden');
            }
        }

        async function saveExpense(event) {
            event.preventDefault();
            const token = localStorage.getItem('adminToken');
            const id = document.getElementById('expense-id').value;

            let receiptUrl = '';
            const receiptFile = document.getElementById('expense-receipt').files[0];
            
            // Upload do comprovante se houver arquivo novo
            if (receiptFile) {
                try {
                    const formData = new FormData();
                    formData.append('receipt', receiptFile);
                    
                    const uploadResponse = await fetch(`${API_BASE_FINANCE}/api/finance/expenses/receipt`, {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${token}` },
                        body: formData
                    });
                    
                    if (uploadResponse.ok) {
                        const uploadData = await uploadResponse.json();
                        receiptUrl = uploadData.receiptUrl;
                    } else {
                        showMessage('Erro ao fazer upload do comprovante.', true);
                        return;
                    }
                } catch (error) {
                    showMessage('Erro ao fazer upload do comprovante.', true);
                    return;
                }
            } else {
                // Se n√£o h√° arquivo novo, manter o existente (se estiver editando)
                if (id) {
                    const existingExpense = await fetch(`${API_BASE_FINANCE}/api/finance/expenses`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    }).then(r => r.json()).then(d => d.expenses.find(e => e.id === id));
                    if (existingExpense) receiptUrl = existingExpense.receiptUrl || '';
                }
            }

            const data = {
                description: document.getElementById('expense-description').value,
                amount: parseFloat(document.getElementById('expense-amount').value),
                expenseDate: document.getElementById('expense-date').value,
                category: document.getElementById('expense-category').value,
                receiptUrl
            };

            try {
                const url = id 
                    ? `${API_BASE_FINANCE}/api/finance/expenses/${id}`
                    : `${API_BASE_FINANCE}/api/finance/expenses`;
                const method = id ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    showMessage(id ? 'Gasto atualizado!' : 'Gasto criado!');
                    closeExpenseModal();
                    loadExpenses();
                } else {
                    const error = await response.json();
                    showMessage(error.message || 'Erro ao salvar.', true);
                }
            } catch (error) {
                showMessage('Erro de conex√£o.', true);
            }
        }

        async function deleteExpense(id) {
            if (!confirm('Deseja realmente excluir este gasto?')) return;
            
            const token = localStorage.getItem('adminToken');
            try {
                const response = await fetch(`${API_BASE_FINANCE}/api/finance/expenses/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    showMessage('Gasto exclu√≠do!');
                    loadExpenses();
                } else {
                    showMessage('Erro ao excluir.', true);
                }
            } catch (error) {
                showMessage('Erro de conex√£o.', true);
            }
        }

        // ========== HIST√ìRICO INDIVIDUAL ==========
        
        async function viewMemberHistory(memberId) {
            const token = localStorage.getItem('adminToken');
            const member = allMembers.find(m => m.id === memberId);
            const memberName = member ? member.name : 'Membro';
            
            document.getElementById('history-modal-title').textContent = `Hist√≥rico - ${memberName}`;
            document.getElementById('history-content').innerHTML = '<p class="text-center text-rjb-text/70 dark:text-rjb-text-dark/70">Carregando...</p>';
            document.getElementById('history-modal').classList.remove('hidden');
            
            try {
                const response = await fetch(`${API_BASE_FINANCE}/api/finance/reports/member/${memberId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                
                let html = '<div class="space-y-4">';
                
                // Contribui√ß√µes
                html += '<div><h4 class="font-bold text-lg mb-2">Contribui√ß√µes</h4>';
                if (data.contributions && data.contributions.length > 0) {
                    html += '<div class="space-y-2">';
                    data.contributions.forEach(c => {
                        const date = c.createdAt ? new Date(c.createdAt).toLocaleDateString('pt-BR') : 'N/A';
                        html += `
                            <div class="bg-rjb-bg-light dark:bg-rjb-bg-dark p-3 rounded-lg border border-green-600/20">
                                <p class="font-semibold">${c.month}/${c.year} - R$ ${c.amount.toFixed(2)}</p>
                                <p class="text-sm text-rjb-text/70 dark:text-rjb-text-dark/70">Status: ${c.status === 'paid' ? 'Pago' : 'Pendente'} | Registrado em: ${date}</p>
                            </div>
                        `;
                    });
                    html += '</div>';
                } else {
                    html += '<p class="text-rjb-text/70 dark:text-rjb-text-dark/70">Nenhuma contribui√ß√£o registrada.</p>';
                }
                html += '</div>';
                
                // Dep√≥sitos
                html += '<div><h4 class="font-bold text-lg mb-2">Dep√≥sitos</h4>';
                if (data.deposits && data.deposits.length > 0) {
                    html += '<div class="space-y-2">';
                    data.deposits.forEach(d => {
                        const date = d.depositDate ? new Date(d.depositDate).toLocaleDateString('pt-BR') : 'N/A';
                        html += `
                            <div class="bg-rjb-bg-light dark:bg-rjb-bg-dark p-3 rounded-lg border border-green-600/20">
                                <p class="font-semibold">R$ ${d.amount.toFixed(2)} - ${date}</p>
                                ${d.description ? `<p class="text-sm text-rjb-text/70 dark:text-rjb-text-dark/70">${d.description}</p>` : ''}
                                ${d.receiptUrl ? `<a href="${d.receiptUrl}" target="_blank" class="text-green-600 hover:underline text-sm">Ver comprovante</a>` : ''}
                            </div>
                        `;
                    });
                    html += '</div>';
                } else {
                    html += '<p class="text-rjb-text/70 dark:text-rjb-text-dark/70">Nenhum dep√≥sito registrado.</p>';
                }
                html += '</div>';
                
                html += '</div>';
                document.getElementById('history-content').innerHTML = html;
            } catch (error) {
                document.getElementById('history-content').innerHTML = '<p class="text-center text-red-500">Erro ao carregar hist√≥rico.</p>';
            }
        }

        function closeHistoryModal(event) {
            if (!event || event.target.id === 'history-modal') {
                document.getElementById('history-modal').classList.add('hidden');
            }
        }

        // Carregar dados quando a p√°gina financeira √© acessada
        if (typeof window !== 'undefined') {
            window.addEventListener('hashchange', () => {
                if (window.location.hash === '#financeiro' || window.location.hash === '#finance') {
                    setTimeout(() => {
                        if (currentFinanceTab === 'contributions') loadContributions();
                        else if (currentFinanceTab === 'deposits') loadDeposits();
                        else if (currentFinanceTab === 'expenses') loadExpenses();
                    }, 500);
                }
            });
        }

        // Vari√°vel global tempor√°ria para a chave
        // Atalho para compatibilidade com as novas fun√ß√µes
        function showLoading(show, message = 'Carregando...') {
            if (typeof toggleLoader === 'function') {
                toggleLoader(show, message);
            } else {
                console.warn('Fun√ß√£o toggleLoader n√£o encontrada.');
            }
        }

        let currentGeneratedKey = '';

        function copyKeyToClipboard() {
            const display = document.getElementById('generated-key-display');
            if (display && display.value && display.value !== '--- CLIQUE PARA GERAR ---') {
                navigator.clipboard.writeText(display.value).then(() => {
                    showMessage('Chave copiada para a √°rea de transfer√™ncia!', false);
                }).catch(() => {
                    showMessage('Erro ao copiar chave.', true);
                });
            } else {
                showMessage('Gere uma chave primeiro.', true);
            }
        }

        async function uiGenerateAndPrepare() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) code += chars.charAt(Math.floor(Math.random() * chars.length));

            currentGeneratedKey = `RJB-AUTO-${code}`;
            const token = localStorage.getItem('adminToken');
            const API_BASE = 'https://rjb-email-sender-215755766100.europe-west1.run.app';

            // 1. Mostra a chave na tela IMEDIATAMENTE (Evita frustra√ß√£o do admin)
            const display = document.getElementById('generated-key-display');
            if (display) display.value = currentGeneratedKey;

            try {
                const response = await fetch(`${API_BASE}/api/admin/generate-key`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ inviteKey: currentGeneratedKey })
                });

                // 2. S√≥ tenta ler o JSON se a resposta for OK (Evita o erro de token '<')
                if (response.ok) {
                    document.getElementById('whatsapp-share-area').classList.remove('hidden');
                    navigator.clipboard.writeText(currentGeneratedKey);
                    showMessage('Chave gerada e salva com sucesso!');
                } else {
                    console.error('Servidor retornou erro:', response.status);
                    document.getElementById('whatsapp-share-area').classList.remove('hidden');
                    showMessage('Chave gerada localmente. O servidor pode estar desatualizado.', true);
                }
            } catch (e) {
                console.error('Falha na rede:', e);
                document.getElementById('whatsapp-share-area').classList.remove('hidden');
                showMessage('Aviso: Chave gerada offline.', true);
            }
        }
        function shareViaWhatsApp() {
            if (!currentGeneratedKey) return;

            // Defina aqui o seu dom√≠nio oficial do GitHub Pages
            const siteUrl = "https://www.racionaljazzband.com.br/#cadastro";

            const message = `Ol√°! Aqui √© da RJB. üé∑\n\n` +
                `J√° iniciamos a transi√ß√£o para o cadastro via site!\n\n` +
                `Acesse: ${siteUrl}\n` +
                `Use a chave: \`${currentGeneratedKey}\`\n\n` +
                `_Obs: Lembre-se de aceitar os termos de imagem (LGPD) ao finalizar._`;

            const encodedMsg = encodeURIComponent(message);
            const whatsappUrl = `https://api.whatsapp.com/send?text=${encodedMsg}`;

            window.open(whatsappUrl, '_blank');
        }

        function editMember(memberId, currentName, currentInstrument, currentCity = '', currentState = '', currentTefa = '', currentPhone = '') {
            document.getElementById('edit-member-id').value = memberId;
            document.getElementById('edit-member-name').value = currentName;
            document.getElementById('edit-member-tefa').value = currentTefa;
            document.getElementById('edit-member-phone').value = currentPhone; // Novo
            document.getElementById('edit-member-instrument').value = currentInstrument;
            document.getElementById('edit-member-city').value = currentCity;
            document.getElementById('edit-member-state').value = currentState;

            const modal = document.getElementById('edit-member-modal');
            modal.classList.remove('hidden');
            setTimeout(() => modal.classList.add('opacity-100'), 10);
        }

        function closeEditModal() {
            document.getElementById('edit-member-modal').classList.add('hidden');
        }

        // Fun√ß√µes de valida√ß√£o em tempo real
        function validateFieldRealTime(field, fieldType) {
            const value = field.value.trim();
            const errorElement = field.parentElement.querySelector('.field-error');
            const validIcon = field.parentElement.querySelector('label .field-valid-icon');
            
            if (!value) {
                if (validIcon) validIcon.classList.add('hidden');
                return false;
            }
            
            let isValid = false;
            let errorMessage = '';
            
            switch(fieldType) {
                case 'name':
                    isValid = value.length >= 3;
                    errorMessage = isValid ? '' : 'Nome deve ter pelo menos 3 caracteres';
                    break;
                case 'email':
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    isValid = emailRegex.test(value);
                    errorMessage = isValid ? '' : 'Email inv√°lido';
                    break;
                case 'phone':
                    const phoneDigits = value.replace(/\D/g, '');
                    isValid = phoneDigits.length >= 10 && phoneDigits.length <= 11;
                    errorMessage = isValid ? '' : 'Telefone deve ter 10 ou 11 d√≠gitos';
                    break;
                case 'tefa':
                    isValid = value === '' || /^\d+$/.test(value);
                    errorMessage = isValid ? '' : 'TEFA deve conter apenas n√∫meros';
                    break;
                case 'instrument':
                    isValid = value.length >= 2;
                    errorMessage = isValid ? '' : 'Instrumento deve ter pelo menos 2 caracteres';
                    break;
                case 'message':
                    isValid = value.length >= 10;
                    errorMessage = isValid ? '' : 'Mensagem deve ter pelo menos 10 caracteres';
                    break;
                case 'state':
                case 'city':
                    isValid = value !== '' && value !== null;
                    errorMessage = isValid ? '' : 'Este campo √© obrigat√≥rio';
                    break;
                default:
                    isValid = value.length > 0;
            }
            
            if (isValid) {
                field.classList.remove('border-red-500', 'border-red-300');
                field.classList.add('border-green-500', 'dark:border-green-400');
                if (errorElement) {
                    errorElement.classList.add('hidden');
                    errorElement.textContent = '';
                }
                if (validIcon) validIcon.classList.remove('hidden');
            } else {
                field.classList.remove('border-green-500', 'dark:border-green-400');
                field.classList.add('border-red-500', 'dark:border-red-300');
                if (errorElement) {
                    errorElement.classList.remove('hidden');
                    errorElement.textContent = errorMessage;
                }
                if (validIcon) validIcon.classList.add('hidden');
            }
            
            return isValid;
        }
        
        function validateField(field, fieldType) {
            return validateFieldRealTime(field, fieldType);
        }
        
        function clearFieldError(field) {
            const errorElement = field.parentElement.querySelector('.field-error');
            if (errorElement && !errorElement.textContent) {
                field.classList.remove('border-red-500', 'border-red-300');
            }
        }

        function closeDeleteModal() {
            const modal = document.getElementById('delete-confirm-modal');
            const confirmInput = document.getElementById('confirm-delete-name');
            const errorMsg = document.getElementById('confirm-delete-error');
            const confirmBtn = document.getElementById('confirm-delete-btn');
            
            if (confirmInput) {
                confirmInput.value = '';
                confirmInput.classList.remove('border-red-500', 'border-green-500');
            }
            if (errorMsg) errorMsg.classList.add('hidden');
            if (confirmBtn) confirmBtn.disabled = true;
            
            modal.classList.add('hidden');
            modal.classList.remove('opacity-100');
        }

        // Fun√ß√£o para gerar empty states melhorados
        function generateEmptyState(type, view = 'desktop') {
            if (type === 'members') {
                const hasFilters = memberFilters.name || memberFilters.instrument || memberFilters.location;
                const message = hasFilters 
                    ? 'Nenhum membro encontrado com os filtros aplicados.' 
                    : 'Nenhum membro cadastrado ainda.';
                const action = hasFilters 
                    ? '<button onclick="clearFilters()" class="mt-4 px-4 py-2 bg-rjb-yellow text-rjb-text font-semibold rounded-lg hover:bg-yellow-500 transition-colors">Limpar Filtros</button>'
                    : '';
                
                if (view === 'mobile') {
                    return `
                        <div class="lg:hidden p-12 text-center">
                            <div class="flex flex-col items-center gap-4">
                                <div class="w-24 h-24 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-700 flex items-center justify-center">
                                    <svg class="w-12 h-12 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-gray-600 dark:text-gray-400 text-lg font-semibold mb-2">${message}</p>
                                    ${hasFilters ? '<p class="text-gray-500 dark:text-gray-500 text-sm mb-4">Tente ajustar os filtros de busca.</p>' : ''}
                                </div>
                                ${action}
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <tr class="hidden lg:table-row">
                            <td colspan="7" class="p-12 text-center">
                                <div class="flex flex-col items-center gap-4">
                                    <div class="w-24 h-24 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-700 flex items-center justify-center">
                                        <svg class="w-12 h-12 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-gray-600 dark:text-gray-400 text-lg font-semibold mb-2">${message}</p>
                                        ${hasFilters ? '<p class="text-gray-500 dark:text-gray-500 text-sm mb-4">Tente ajustar os filtros de busca.</p>' : ''}
                                    </div>
                                    ${action}
                                </div>
                            </td>
                        </tr>
                    `;
                }
            }
            return '<div class="p-8 text-center text-gray-400">Nenhum resultado encontrado.</div>';
        }

        // Fun√ß√£o para gerar skeleton screens
        function generateSkeletonScreen(type) {
            if (type === 'members') {
                return `
                    <div class="space-y-4 animate-pulse">
                        <div class="h-8 bg-gray-200 dark:bg-gray-700 rounded w-3/4"></div>
                        <div class="space-y-3">
                            ${Array(3).fill(0).map(() => `
                                <div class="flex items-center gap-4">
                                    <div class="h-12 w-12 bg-gray-200 dark:bg-gray-700 rounded-full"></div>
                                    <div class="flex-1 space-y-2">
                                        <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3"></div>
                                        <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/2"></div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else if (type === 'attachments') {
                return `
                    <div class="space-y-3 animate-pulse">
                        ${Array(3).fill(0).map(() => `
                            <div class="flex items-center gap-3 p-3 bg-gray-100 dark:bg-gray-800 rounded-lg">
                                <div class="h-10 w-10 bg-gray-200 dark:bg-gray-700 rounded"></div>
                                <div class="flex-1 space-y-2">
                                    <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4"></div>
                                    <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/2"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            return '<div class="animate-pulse"><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded"></div></div>';
        }

        // Fun√ß√µes de valida√ß√£o em tempo real
        function validateFieldRealTime(field, fieldType) {
            const value = field.value.trim();
            const errorElement = field.parentElement.querySelector('.field-error');
            const validIcon = field.parentElement.querySelector('label .field-valid-icon');
            
            if (!value) {
                if (validIcon) validIcon.classList.add('hidden');
                return false;
            }
            
            let isValid = false;
            let errorMessage = '';
            
            switch(fieldType) {
                case 'name':
                    isValid = value.length >= 3;
                    errorMessage = isValid ? '' : 'Nome deve ter pelo menos 3 caracteres';
                    break;
                case 'email':
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    isValid = emailRegex.test(value);
                    errorMessage = isValid ? '' : 'Email inv√°lido';
                    break;
                case 'phone':
                    const phoneDigits = value.replace(/\D/g, '');
                    isValid = phoneDigits.length >= 10 && phoneDigits.length <= 11;
                    errorMessage = isValid ? '' : 'Telefone deve ter 10 ou 11 d√≠gitos';
                    break;
                case 'tefa':
                    isValid = value === '' || /^\d+$/.test(value);
                    errorMessage = isValid ? '' : 'TEFA deve conter apenas n√∫meros';
                    break;
                case 'instrument':
                    isValid = value.length >= 2;
                    errorMessage = isValid ? '' : 'Instrumento deve ter pelo menos 2 caracteres';
                    break;
                case 'message':
                    isValid = value.length >= 10;
                    errorMessage = isValid ? '' : 'Mensagem deve ter pelo menos 10 caracteres';
                    break;
                default:
                    isValid = value.length > 0;
            }
            
            if (isValid) {
                field.classList.remove('border-red-500', 'border-red-300');
                field.classList.add('border-green-500', 'dark:border-green-400');
                if (errorElement) {
                    errorElement.classList.add('hidden');
                    errorElement.textContent = '';
                }
                if (validIcon) validIcon.classList.remove('hidden');
            } else {
                field.classList.remove('border-green-500', 'dark:border-green-400');
                field.classList.add('border-red-500', 'dark:border-red-300');
                if (errorElement) {
                    errorElement.classList.remove('hidden');
                    errorElement.textContent = errorMessage;
                }
                if (validIcon) validIcon.classList.add('hidden');
            }
            
            return isValid;
        }
        
        function validateField(field, fieldType) {
            return validateFieldRealTime(field, fieldType);
        }
        
        function clearFieldError(field) {
            const errorElement = field.parentElement.querySelector('.field-error');
            if (errorElement && !errorElement.textContent) {
                field.classList.remove('border-red-500', 'border-red-300');
            }
        }

        function uiGenerateNewKey() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            const finalKey = `RJB-AUTO-${code}`;
            document.getElementById('generated-key-display').value = finalKey;

            // Opcional: Copia automaticamente para a √°rea de transfer√™ncia
            navigator.clipboard.writeText(finalKey);
            showMessage('Chave gerada e copiada para o WhatsApp!');
        }

        // Fun√ß√£o para gerar breadcrumbs
        function generateBreadcrumbs(page) {
            const breadcrumbMap = {
                'sobre': [{ name: 'Home', page: 'home' }, { name: 'Sobre', page: 'sobre' }],
                'apresentacoes': [{ name: 'Home', page: 'home' }, { name: 'A RJB', page: null }, { name: 'Apresenta√ß√µes', page: 'apresentacoes' }],
                'bastidores': [{ name: 'Home', page: 'home' }, { name: 'A RJB', page: null }, { name: 'Ensaios', page: 'bastidores' }],
                'repertorio': [{ name: 'Home', page: 'home' }, { name: 'A RJB', page: null }, { name: 'Repert√≥rio', page: 'repertorio' }],
                'partituras': [{ name: 'Home', page: 'home' }, { name: 'A RJB', page: null }, { name: 'Partituras', page: 'partituras' }],
                'fotos': [{ name: 'Home', page: 'home' }, { name: 'A RJB', page: null }, { name: 'Fotos', page: 'fotos' }],
                'agenda': [{ name: 'Home', page: 'home' }, { name: 'Agenda', page: 'agenda' }],
                'contato': [{ name: 'Home', page: 'home' }, { name: 'Contato', page: 'contato' }],
                'member-registration': [{ name: 'Home', page: 'home' }, { name: 'Cadastro', page: 'member-registration' }],
                'reports': [{ name: 'Home', page: 'home' }, { name: '√Årea Administrativa', page: 'reports' }],
                'financeiro': [{ name: 'Home', page: 'home' }, { name: '√Årea Administrativa', page: 'reports' }, { name: 'Financeiro', page: 'financeiro' }],
            };
            
            const breadcrumbs = breadcrumbMap[page] || [{ name: 'Home', page: 'home' }];
            
            return `
                <nav class="mb-6 flex items-center space-x-2 text-sm" aria-label="Breadcrumb">
                    ${breadcrumbs.map((crumb, index) => {
                        const isLast = index === breadcrumbs.length - 1;
                        return `
                            <div class="flex items-center space-x-2">
                                ${index > 0 ? '<span class="text-rjb-text/40 dark:text-rjb-text-dark/40">/</span>' : ''}
                                ${crumb.page && !isLast ? 
                                    `<button onclick="navigateTo('${crumb.page}')" class="text-rjb-text/70 dark:text-rjb-text-dark/70 hover:text-rjb-yellow transition-colors">${crumb.name}</button>` :
                                    `<span class="${isLast ? 'text-rjb-yellow font-semibold' : 'text-rjb-text/50 dark:text-rjb-text-dark/50'}">${crumb.name}</span>`
                                }
                            </div>
                        `;
                    }).join('')}
                </nav>
            `;
        }

        // index.html (SUBSTITUIR A FUN√á√ÉO renderPage COMPLETA)
        function renderPage() {
            const content = document.getElementById('main-content');
            let html = '';

            let pageTitle = '';

            // 1. Define o t√≠tulo da p√°gina 
            if (subMenuRJB[currentPage]) {
                pageTitle = subMenuRJB[currentPage];
            } else {
                switch (currentPage) {
                    case 'home': pageTitle = 'Racional Jazz Band'; break;
                    case 'sobre': pageTitle = 'Sobre a RJB'; break;
                    case 'agenda': pageTitle = 'Agenda de Eventos'; break;
                    case 'contato': pageTitle = 'Fale Conosco'; break;
                    case 'member-registration': pageTitle = 'Cadastro de Membros'; break;
                    case 'reports': pageTitle = '√Årea Administrativa'; break;
                    case 'financeiro': pageTitle = '√Årea Financeira'; break;
                    default: pageTitle = 'P√°gina N√£o Encontrada';
                }
            }

            // 2. Renderiza a Home Page ou o Wrapper de Conte√∫do
            if (currentPage === 'home') {
                html += generateHomePageWrapper();
            } else {
                // Gera breadcrumbs
                const breadcrumbs = generateBreadcrumbs(currentPage);
                
                html += `
            <div class="pt-20 md:pt-28 pb-16 md:pb-24 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                ${breadcrumbs}
                <h1 class="text-4xl md:text-7xl font-extrabold rjb-logo-text text-rjb-yellow mb-2 text-center break-words px-2">
                    ${pageTitle.split('/')[0].trim()}
                </h1>
                ${pageTitle.includes('/') ? `<p class="text-xl dark:text-rjb-text-dark/70 text-rjb-text/70 mb-8 text-center">${pageTitle.split('/')[1].trim()}</p>` : ''}
                
                <div class="bg-rjb-card-light dark:bg-rjb-card-dark p-6 md:p-10 rounded-xl shadow-deep-shadow dark:shadow-xl dark:shadow-black/30 z-10 border border-rjb-yellow/10 transition-colors duration-500 text-rjb-text dark:text-rjb-text-dark">
        `;

                // 3. Renderiza o conte√∫do espec√≠fico da p√°gina
                switch (currentPage) {
                    case 'sobre': html += generateSobrePage(); break;
                    case 'apresentacoes': html += generateApresentacoesPage(); break;
                    case 'bastidores': html += generateBastidoresPage(); break;
                    case 'repertorio': html += generateRepertorioPage(); break;
                    case 'partituras': html += generatePartiturasPage(); break;
                    case 'fotos': html += generateFotosPage(); break;
                    case 'agenda': html += generateAgendaPage(); break;
                    case 'contato': html += generateContatoPage(); break;
                    case 'member-registration': html += generateCadastroPage(); break;
                    case 'reports': html += generateReportsPage(); break;
                    case 'financeiro': 
                        html += generateFinancePage();
                        break;
                    default: html += '<p class="text-center text-xl dark:text-rjb-text-dark/80 text-rjb-text/80">Opa! P√°gina n√£o encontrada.</p>';
                }

                html += `
                </div>
            </div>
        `;
            }
            content.innerHTML = html;

            updateActiveMenu();

            // CHAMA O CONTROLE DE ACESSO SOMENTE NA P√ÅGINA DE RELAT√ìRIOS
            if (currentPage === 'reports') {
                setTimeout(renderProtectedReportView, 0);
            }
            
            // Inicializar √°rea financeira se for a p√°gina atual
            if (currentPage === 'financeiro') {
                setTimeout(initializeFinancePage, 300);
            }
        }

        // --- Inicializa√ß√£o ---
        document.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            // --- L√ìGICA DE ROTEAMENTO INICIAL ---
            const currentHash = window.location.hash.replace('#', '');
            if (currentHash === 'cadastro') {
                currentPage = 'member-registration';
            } else if (currentHash && currentHash !== '') {
                // Verifica se o hash corresponde a uma p√°gina v√°lida (opcional)
                currentPage = currentHash;
            }
            renderPage();

            // L√≥gica de menu m√≥vel (MANTIDA)
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenuButton) {
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                    const openIcon = document.getElementById('menu-open-icon');
                    const closeIcon = document.getElementById('menu-close-icon');
                    if (mobileMenu.classList.contains('hidden')) {
                        openIcon.classList.remove('hidden');
                        closeIcon.classList.add('hidden');
                    } else {
                        openIcon.classList.add('hidden');
                        closeIcon.classList.remove('hidden');
                    }
                });
            }

            // L√≥gica de dropdown (MANTIDA)
            const rjbDropdownButton = document.getElementById('nav-rjb-dropdown');
            const rjbDropdownMenu = document.getElementById('rjb-dropdown-menu');
            if (rjbDropdownButton) {
                rjbDropdownButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    rjbDropdownMenu.classList.toggle('hidden');
                });
            }

            const rjbDropdownButtonMobile = document.getElementById('rjb-dropdown-button-mobile');
            const rjbDropdownMenuMobile = document.getElementById('rjb-dropdown-menu-mobile');
            if (rjbDropdownButtonMobile) {
                rjbDropdownButtonMobile.addEventListener('click', () => {
                    rjbDropdownMenuMobile.classList.toggle('hidden');
                });
            }

            document.addEventListener('click', (e) => {
                if (rjbDropdownMenu && rjbDropdownButton && !rjbDropdownMenu.classList.contains('hidden')) {
                    if (!rjbDropdownButton.contains(e.target) && !rjbDropdownMenu.contains(e.target)) {
                        rjbDropdownMenu.classList.add('hidden');
                    }
                }
            });
        });
        async function fetchCities(uf) {
            const citySelect = document.getElementById('reg-city');

            citySelect.innerHTML = '<option value="">Carregando cidades...</option>';
            citySelect.disabled = true;

            if (!uf) {
                citySelect.innerHTML = '<option value="">Selecione o Estado primeiro</option>';
                return;
            }

            try {
                // Busca munic√≠pios do estado selecionado ordenados por nome
                const response = await fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${uf}/municipios?orderBy=nome`);
                const cities = await response.json();

                let options = '<option value="">Selecione a Cidade</option>';
                cities.forEach(city => {
                    options += `<option value="${city.nome}">${city.nome}</option>`;
                });

                citySelect.innerHTML = options;
                citySelect.disabled = false;
            } catch (error) {
                console.error('Erro ao buscar cidades:', error);
                showMessage('Erro ao carregar lista de cidades.', true);
                citySelect.innerHTML = '<option value="">Erro ao carregar</option>';
            }
        }
        window.addEventListener('hashchange', () => {
            const hash = window.location.hash.replace('#', '');
            const targetPage = (hash === 'cadastro') ? 'member-registration' : (hash || 'home');

            if (currentPage !== targetPage) {
                navigateTo(targetPage);
            }
        });
        async function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('l', 'mm', 'a4'); // Modo paisagem

            const token = localStorage.getItem('adminToken');
            const endpointUrl = 'https://rjb-email-sender-215755766100.europe-west1.run.app/api/reports/members';

            showMessage('Gerando arquivo PDF...');

            try {
                let data;
                
                // Se temos dados em cache, usa-os. Caso contr√°rio, busca da API
                if (lastFetchedData) {
                    data = lastFetchedData;
                } else {
                    const response = await fetch(endpointUrl, {
                        method: 'GET',
                        headers: { 'Authorization': `Bearer ${token}` }
                    });

                    if (!response.ok) {
                        throw new Error('Falha ao buscar dados da API');
                    }

                    data = await response.json();
                }

                // Aplica os filtros ativos
                const filteredMembers = getFilteredMembers(data);
                
                // Ordena os membros filtrados alfabeticamente (para PDF)
                const sortedMembers = [...filteredMembers].sort(sortAlphabetically);
                
                // Verifica se h√° filtros ativos
                const hasFilters = memberFilters.name || memberFilters.instrument || memberFilters.location;
                
                // Configura√ß√£o de cores e estilos
                const primaryColor = [255, 215, 0]; // Amarelo RJB
                const darkColor = [42, 42, 42]; // Texto escuro
                const lightGray = [245, 245, 245]; // Fundo claro
                
                // Cabe√ßalho do documento
                doc.setFillColor(...primaryColor);
                doc.rect(0, 0, doc.internal.pageSize.getWidth(), 30, 'F');
                
                doc.setTextColor(...darkColor);
                doc.setFontSize(20);
                doc.setFont(undefined, 'bold');
                doc.text('Relat√≥rio de Membros', 14, 15);
                
                doc.setFontSize(12);
                doc.setFont(undefined, 'normal');
                doc.text('Racional Jazz Band', 14, 22);
                
                // Informa√ß√µes do relat√≥rio
                let yPos = 35;
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                
                const exportDate = new Date().toLocaleDateString('pt-BR', { 
                    day: '2-digit', 
                    month: '2-digit', 
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                doc.text(`Data de Exporta√ß√£o: ${exportDate}`, 14, yPos);
                doc.text(`Total de Membros: ${filteredMembers.length}`, 14, yPos + 5);
                
                if (hasFilters) {
                    const filterParts = [];
                    if (memberFilters.name) filterParts.push(`Nome: ${memberFilters.name}`);
                    if (memberFilters.instrument) filterParts.push(`Instrumento: ${memberFilters.instrument}`);
                    if (memberFilters.location) filterParts.push(`Localidade: ${memberFilters.location}`);
                    doc.text(`Filtros Aplicados: ${filterParts.join(' | ')}`, 14, yPos + 10);
                    yPos += 5;
                }
                
                // Prepara os dados da tabela
                // Numera√ß√£o crescente (1, 2, 3...) em ordem alfab√©tica
                const tableRows = sortedMembers.map((m, index) => [
                    index + 1, // Numera√ß√£o crescente
                    m.name || '---',
                    m.tefa || '---',
                    m.instrument || '---',
                    `${m.city || ''}/${m.state || ''}`.trim() || '---',
                    m.phone || '---'
                ]);

                // Gera a tabela
                doc.autoTable({
                    startY: yPos + 8,
                    head: [['N¬∫', 'Nome', 'TEFA', 'Instrumento', 'Localidade', 'Telefone']],
                    body: tableRows,
                    theme: 'striped',
                    headStyles: { 
                        fillColor: primaryColor, 
                        textColor: darkColor,
                        fontStyle: 'bold',
                        fontSize: 10
                    },
                    bodyStyles: {
                        textColor: darkColor,
                        fontSize: 9
                    },
                    alternateRowStyles: {
                        fillColor: lightGray
                    },
                    margin: { top: yPos + 8, left: 14, right: 14 },
                    styles: {
                        cellPadding: 3,
                        overflow: 'linebreak',
                        cellWidth: 'wrap'
                    },
                    columnStyles: {
                        0: { cellWidth: 15 }, // N¬∫
                        1: { cellWidth: 50 }, // Nome
                        2: { cellWidth: 25 }, // TEFA
                        3: { cellWidth: 40 }, // Instrumento
                        4: { cellWidth: 45 }, // Localidade
                        5: { cellWidth: 40 }  // Telefone
                    }
                });

                // Rodap√©
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(150, 150, 150);
                    doc.text(
                        `P√°gina ${i} de ${pageCount} - Racional Jazz Band`,
                        doc.internal.pageSize.getWidth() / 2,
                        doc.internal.pageSize.getHeight() - 10,
                        { align: 'center' }
                    );
                }

                const fileName = hasFilters 
                    ? `rjb_relatorio_filtrado_${new Date().toISOString().split('T')[0]}.pdf`
                    : `rjb_relatorio_${new Date().toISOString().split('T')[0]}.pdf`;
                
                doc.save(fileName);
                showMessage(`PDF baixado com sucesso! ${filteredMembers.length} membro(s) exportado(s).`);
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                showMessage('Erro de conex√£o ou sess√£o expirada.', true);
            }
        }

        // Fun√ß√£o para ordena√ß√£o alfab√©tica que respeita acentos
        function sortAlphabetically(a, b) {
            const nameA = (a.name || '').trim();
            const nameB = (b.name || '').trim();
            // Usa localeCompare com pt-BR para respeitar acentos e ordem alfab√©tica correta
            return nameA.localeCompare(nameB, 'pt-BR', { sensitivity: 'base' });
        }

        function processAndRenderMembers(data) {
            if (!data || !data.allMembers) return;

            // Usa a fun√ß√£o auxiliar para obter dados filtrados
            let filtered = getFilteredMembers(data);

            // Sempre ordenar alfabeticamente por nome (respeitando acentos)
            filtered.sort(sortAlphabetically);

            // Aplicar pagina√ß√£o
            const totalPages = Math.ceil(filtered.length / MEMBERS_PER_PAGE);
            const startIndex = (currentMemberPage - 1) * MEMBERS_PER_PAGE;
            const endIndex = startIndex + MEMBERS_PER_PAGE;
            const paginatedMembers = filtered.slice(startIndex, endIndex);

            renderReportData({ ...data, allMembers: paginatedMembers, totalFiltered: filtered.length, currentPage: currentMemberPage, totalPages });
        }

        function handleSort(column) {
            if (currentSortColumn === column) {
                sortDirection = !sortDirection;
            } else {
                currentSortColumn = column;
                sortDirection = true;
            }
            // Em vez de fetchMemberReport, usamos os dados que j√° temos no cache
            if (lastFetchedData) {
                processAndRenderMembers(lastFetchedData);
            }
        }
        function clearFilters() {
            // Reseta o objeto de filtros para o estado original
            memberFilters = { name: '', instrument: '', location: '' };
            
            // Resetar para primeira p√°gina ao limpar filtros
            currentMemberPage = 1;

            // Atualiza os estilos dos selects
            updateSelectStyle('filter-instrument', '');
            updateSelectStyle('filter-location', '');

            // Se tivermos os dados em cache, renderiza tudo limpo
            if (lastFetchedData) {
                processAndRenderMembers(lastFetchedData);
            }
        }
    </script>

    <style>
        /* --- Estilos CSS (MANTIDOS) --- */
        body {
            transition: background-color 0.5s ease, color 0.5s ease;
            min-height: 100vh;
        }

        .rjb-logo-text {
            text-shadow: 0 0 4px rgba(255, 215, 0, 0.8);
            letter-spacing: -0.05em;
        }

        #home-background-section {
            background-image: url("WhatsApp Image 2025-11-19 at 17.15.58.jpeg");
            background-size: cover;
            background-position: center 40%;
            background-attachment: fixed;
            position: relative;
            padding-top: 3rem;
            padding-bottom: 10rem;
        }

        #home-background-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.88);
            z-index: 1;
            transition: background-color 0.5s ease;
        }

        .dark #home-background-section::before {
            background-color: rgba(0, 0, 0, 0.7);
        }

        .video-thumbnail-container {
            position: relative;
            width: 100%;
            padding-top: 56.25%;
            overflow: hidden;
            cursor: pointer;
        }

        .video-thumbnail-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease, opacity 0.3s ease;
        }

        .group:hover .video-thumbnail-img {
            transform: scale(1.05);
        }

        .play-icon-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            border: 2px solid #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }

        .group:hover .play-icon-overlay {
            background-color: rgba(255, 215, 0, 0.9);
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.6);
        }

        .play-icon-overlay svg {
            width: 30px;
            height: 30px;
            fill: #FFD700;
            margin-left: 4px;
            transition: fill 0.3s ease;
        }

        .group:hover .play-icon-overlay svg {
            fill: #2A2A2A;
        }

        .header-rjb {
            background-color: var(--tw-rjb-card-light);
            border-bottom: 1px solid #EEEEEE;
            transition: background-color 0.5s ease, border-color 0.5s ease;
            z-index: 9999 !important;
        }


        .dark .header-rjb {
            background-color: var(--tw-rjb-card-dark);
            border-bottom: 1px solid rgba(255, 215, 0, 0.1);
        }

        .nav-link-active {
            border-bottom: 3px solid #FFD700;
            padding-bottom: 5px;
            font-weight: 700;
            color: #FFD700 !important;
            position: relative;
        }
        
        .nav-link-active::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.5), transparent);
        }

        .rjb-logo-image {
            border-radius: 50%;
            border: 2px solid var(--tw-rjb-yellow);
            box-shadow: 0 0 8px rgba(255, 215, 0, 0.4);
            transition: all 0.5s ease;
        }

        .dark .rjb-logo-image {
            border: 2px solid rgba(255, 215, 0, 0.6);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.7), 0 0 5px rgba(255, 215, 0, 0.2) inset;
        }

        .play-button.playing svg path {
            d: path("M6 19h4V5H6v14zm8-14v14h4V5h-4z");
            fill-rule: unset;
            clip-rule: unset;
        }

        .message-error {
            background-color: #D32F2F !important;
            color: white !important;
            box-shadow: 0 0 10px rgba(211, 47, 47, 0.7);
        }

        /* --- Estilos CSS Adicionais para o Player de √Åudio --- */
        /* Estilo base para a tag audio */
        .rjb-audio-player {
            /* Define uma altura consistente e o fundo do player */
            height: 40px;
            /* Um pouco mais alto que o padr√£o de 32px */
            background-color: var(--tw-rjb-bg-light);
            /* Fundo claro */
            border-radius: 9999px;
            /* Arredonda completamente */
            padding: 0 10px;
            border: 1px solid rgba(255, 215, 0, 0.5);
            /* Borda sutil amarela */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        /* Estilos para o modo escuro */
        .dark .rjb-audio-player {
            background-color: var(--tw-rjb-card-dark);
            /* Fundo escuro */
            border: 1px solid rgba(255, 215, 0, 0.2);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }

        /* Estiliza o bot√£o de play/pause (funciona apenas em alguns navegadores, como Chrome) */
        .rjb-audio-player::-webkit-media-controls-play-button {
            color: var(--tw-rjb-yellow);
            background-color: rgba(255, 215, 0, 0.1);
            border-radius: 50%;
            margin-right: 5px;
        }

        /* Estiliza a barra de progresso (funciona apenas em alguns navegadores, como Chrome) */
        .rjb-audio-player::-webkit-media-controls-timeline {
            border-radius: 10px;
            background-color: rgba(255, 215, 0, 0.1);
        }

        /* Estiliza o ponteiro de progresso (funciona apenas em alguns navegadores, como Chrome) */
        .rjb-audio-player::-webkit-media-controls-current-time-display,
        .rjb-audio-player::-webkit-media-controls-time-remaining-display {
            color: var(--tw-rjb-text);
        }

        .dark .rjb-audio-player::-webkit-media-controls-current-time-display,
        .dark .rjb-audio-player::-webkit-media-controls-time-remaining-display {
            color: var(--tw-rjb-text-dark);
        }

        /* --- Estilos CSS para Acorde√£o (Collapse) --- */
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            /* Suaviza a anima√ß√£o */
        }

        .accordion-content.open {
            max-height: 5000px;
            /* Valor grande o suficiente para a transi√ß√£o */
        }

        .accordion-header-icon {
            transition: transform 0.3s ease;
        }

        .accordion-header.open .accordion-header-icon {
            transform: rotate(180deg);
        }

        /* --- Anima√ß√µes para a tabela de membros --- */
        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fade-in 0.4s ease-out forwards;
            opacity: 0;
        }

        /* Melhorias de hover para linhas da tabela */
        tbody tr {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        tbody tr:hover {
            transform: translateX(4px);
            box-shadow: -4px 0 0 0 rgba(255, 215, 0, 0.3);
        }

        /* Estilos para os selects de filtro */
        #filter-instrument, #filter-location {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
            background-position: right 0.75rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }

        .dark #filter-instrument, .dark #filter-location {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%9ca3af' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
        }

        #filter-instrument:focus, #filter-location:focus {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%23FFD700' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
        }

        /* Estilos modernos para cabe√ßalho da tabela desktop */
        @media (min-width: 1024px) {
            thead tr {
                position: relative;
            }
            
            thead tr::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                height: 3px;
                background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.5), transparent);
            }
            
            thead th {
                position: relative;
            }
            
            thead th:not(:last-child)::after {
                content: '';
                position: absolute;
                right: 0;
                top: 20%;
                bottom: 20%;
                width: 1px;
                background: linear-gradient(180deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            }
            
            thead th:hover {
                transform: translateY(-1px);
            }
            
            thead th.cursor-pointer {
                position: relative;
            }
            
            thead th.cursor-pointer::before {
                content: '';
                position: absolute;
                inset: 0;
                background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), transparent);
                opacity: 0;
                transition: opacity 0.3s ease;
            }
            
            thead th.cursor-pointer:hover::before {
                opacity: 1;
            }
        }


        /* Melhorias Mobile para √Årea Administrativa */
        @media (max-width: 640px) {
            /* Scroll suave na tabela */
            .overflow-x-auto {
                -webkit-overflow-scrolling: touch;
                scrollbar-width: thin;
            }
            
            /* Melhor toque em bot√µes mobile */
            button, a[role="button"] {
                -webkit-tap-highlight-color: rgba(255, 215, 0, 0.2);
                touch-action: manipulation;
            }
            
            /* Ajuste de padding em cards mobile */
            #member-report-details,
            #report-output-area > div {
                padding: 1rem !important;
            }
            
            /* Tabela com scroll horizontal melhorado */
            table {
                font-size: 0.875rem;
            }
            
            /* Bot√µes de a√ß√£o sempre vis√≠veis em mobile */
            tbody tr td:last-child .flex {
                opacity: 1 !important;
            }
        }

        /* Melhorias para tablets */
        @media (min-width: 641px) and (max-width: 1024px) {
            #member-report-details,
            #report-output-area > div {
                padding: 1.25rem !important;
            }
        }

        /* Estilos para valida√ß√£o de campos */
        input.border-green-500,
        textarea.border-green-500 {
            border-color: #10b981 !important;
        }
        
        input.border-red-500,
        textarea.border-red-500 {
            border-color: #ef4444 !important;
        }
        
        .field-valid-icon {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        
        /* Skeleton screen animations */
        @keyframes skeleton-pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        .animate-pulse {
            animation: skeleton-pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* Melhorias para tabela desktop - quebra de linha e espa√ßamento */
        @media (min-width: 1024px) {
            /* Remove scroll horizontal */
            .hidden.lg\\:block {
                overflow-x: visible !important;
            }
            
            /* Permite quebra de linha na coluna instrumento com limite de 2 linhas */
            table tbody td:nth-child(3) span {
                display: -webkit-box;
                -webkit-line-clamp: 2;
                line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
                text-overflow: ellipsis;
                word-break: break-word;
                line-height: 1.5;
                max-height: 3em;
            }
            
            /* Nome aparece completo (sem limite) */
            table tbody td:nth-child(2) span {
                word-break: break-word;
                line-height: 1.5;
            }
            
            /* Garante que a coluna de gerenciar n√£o ultrapasse */
            table tbody td:last-child {
                min-width: 60px;
                max-width: 70px;
            }
            
            /* Aumenta altura m√≠nima das linhas para acomodar quebra de linha */
            table tbody tr {
                min-height: 60px;
            }
            
            /* Ajusta padding vertical das c√©lulas para melhor espa√ßamento */
            table tbody td {
                vertical-align: top;
                padding-top: 0.875rem;
                padding-bottom: 0.875rem;
            }
        }
    </style>
</head>

<body class="font-sans bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text transition-colors duration-500">

    <header class=" top-0 header-rjb shadow-lg dark:shadow-black/50 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <button onclick="navigateTo('home')"
                    class="hover:opacity-80 transition-opacity flex items-center space-x-2">
                    <img src="logo.jpeg" alt="Racional Jazz Band Logo"
                        class="h-16 w-auto dark:hidden block rjb-logo-image">
                    <img src="logo-dark.png" alt="Racional Jazz Band Logo Dark"
                        class="h-16 w-auto hidden dark:block rjb-logo-image">
                    <span class="sr-only">Racional Jazz Band</span>
                </button>

                <nav class="hidden md:flex space-x-8 items-center">
                    <button id="nav-home" onclick="navigateTo('home')"
                        class="nav-link text-rjb-text dark:text-rjb-text-dark hover:text-rjb-yellow transition-colors font-semibold py-5">Home</button>
                    <button id="nav-sobre" onclick="navigateTo('sobre')"
                        class="nav-link text-rjb-text dark:text-rjb-text-dark hover:text-rjb-yellow transition-colors font-semibold py-5">Sobre</button>

                    <div class="relative group">
                        <button id="nav-rjb-dropdown"
                            class="nav-link flex items-center text-rjb-text dark:text-rjb-text-dark hover:text-rjb-yellow transition-colors font-semibold py-5">
                            A RJB
                            <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div id="rjb-dropdown-menu"
                            class="hidden absolute left-1/2 transform -translate-x-1/2 mt-0 w-48 rounded-md shadow-lg bg-rjb-card-light dark:bg-rjb-card-dark ring-1 ring-rjb-yellow/20 dark:ring-rjb-yellow/50 focus:outline-none z-50 transition-colors duration-500">
                            <div class="py-1">
                                <button id="nav-repertorio" onclick="navigateTo('repertorio')"
                                    class="nav-link block w-full text-left px-4 py-2 text-sm text-rjb-text dark:text-rjb-text-dark hover:bg-rjb-yellow hover:text-rjb-text transition-colors">Repert√≥rio</button>
                                <button id="nav-partituras" onclick="navigateTo('partituras')"
                                    class="nav-link block w-full text-left px-4 py-2 text-sm text-rjb-text dark:text-rjb-text-dark hover:bg-rjb-yellow hover:text-rjb-text transition-colors">√Årea
                                    de Partituras</button>
                                <button id="nav-fotos" onclick="navigateTo('fotos')"
                                    class="nav-link block w-full text-left px-4 py-2 text-sm text-rjb-text dark:text-rjb-text-dark hover:bg-rjb-yellow hover:text-rjb-text transition-colors">Galeria
                                    de Fotos</button>
                                <button id="nav-apresentacoes" onclick="navigateTo('apresentacoes')"
                                    class="nav-link block w-full text-left px-4 py-2 text-sm text-rjb-text dark:text-rjb-text-dark hover:bg-rjb-yellow hover:text-rjb-text transition-colors">Apresenta√ß√µes</button>
                                <button id="nav-bastidores" onclick="navigateTo('bastidores')"
                                    class="nav-link block w-full text-left px-4 py-2 text-sm text-rjb-text dark:text-rjb-text-dark hover:bg-rjb-yellow hover:text-rjb-text transition-colors">Ensaios</button>
                            </div>
                        </div>
                    </div>

                    <button id="nav-agenda" onclick="navigateTo('agenda')"
                        class="nav-link text-rjb-text dark:text-rjb-text-dark hover:text-rjb-yellow transition-colors font-semibold py-5">Agenda</button>
                    <button id="nav-contato" onclick="navigateTo('contato')"
                        class="nav-link text-rjb-text dark:text-rjb-text-dark hover:text-rjb-yellow transition-colors font-semibold py-5">Contato</button>
                    

                    <button id="nav-relatorios-desktop" onclick="navigateTo('reports')"
                        class="nav-link text-rjb-text dark:text-rjb-text-dark hover:text-rjb-yellow transition-colors font-semibold py-5">√Årea
                        Administrativa</button>

                    <button onclick="toggleDarkMode()"
                        class="text-rjb-text dark:text-rjb-text-dark hover:text-rjb-yellow transition-colors p-2 rounded-full hover:bg-rjb-yellow/10 focus:outline-none">
                        <svg class="w-6 h-6 dark:block hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z">
                            </path>
                        </svg>
                        <svg class="w-6 h-6 dark:hidden block" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                            </path>
                        </svg>
                    </button>
                </nav>

                <button id="nav-cadastro-desktop" onclick="navigateTo('member-registration')"
                    class="nav-link bg-rjb-yellow text-rjb-text font-bold py-2 px-4 rounded-full text-sm hover:bg-yellow-500 transition-colors shadow-subtle-glow hidden md:block">
                    Cadastro
                </button>

                <div class="md:hidden flex items-center space-x-2">
                    <button onclick="toggleDarkMode()"
                        class="text-rjb-text dark:text-rjb-text-dark hover:text-rjb-yellow transition-colors p-2 rounded-md hover:bg-rjb-yellow/10 focus:outline-none">
                        <svg class="w-6 h-6 dark:block hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z">
                            </path>
                        </svg>
                        <svg class="w-6 h-6 dark:hidden block" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                            </path>
                        </svg>
                    </button>

                    <button id="mobile-menu-button" type="button"
                        class="inline-flex items-center justify-center p-2 rounded-md text-rjb-text/70 dark:text-rjb-text-dark/70 hover:text-rjb-text dark:hover:text-rjb-text-dark hover:bg-gray-100 dark:hover:bg-rjb-card-dark focus:outline-none focus:ring-2 focus:ring-inset focus:ring-rjb-yellow transition-colors duration-500"
                        aria-controls="mobile-menu" aria-expanded="false">
                        <svg id="menu-open-icon" class="block h-6 w-6" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                        <svg id="menu-close-icon" class="hidden h-6 w-6" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <div class="md:hidden hidden w-full bg-rjb-card-light dark:bg-rjb-card-dark border-b border-rjb-yellow/30 pb-3 transition-colors duration-500 z-40"
            id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <button id="nav-home-mobile" onclick="navigateTo('home')"
                    class="nav-link block w-full text-left px-3 py-2 rounded-md text-base font-medium text-rjb-text dark:text-rjb-text-dark hover:bg-gray-100 dark:hover:bg-rjb-bg-dark/10 hover:text-rjb-yellow transition-colors">Home</button>
                <button id="nav-sobre-mobile" onclick="navigateTo('sobre')"
                    class="nav-link block w-full text-left px-3 py-2 rounded-md text-base font-medium text-rjb-text dark:text-rjb-text-dark hover:bg-gray-100 dark:hover:bg-rjb-bg-dark/10 hover:text-rjb-yellow transition-colors">Sobre</button>

                <div class="relative nav-item-rjb">
                    <button id="rjb-dropdown-button-mobile"
                        class="flex items-center justify-between w-full text-left px-3 py-2 rounded-md text-base font-medium text-rjb-text dark:text-rjb-text-dark hover:bg-gray-100 dark:hover:bg-rjb-bg-dark/10 hover:text-rjb-yellow transition-colors"
                        aria-expanded="false">
                        A RJB
                        <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7">
                            </path>
                        </svg>
                    </button>
                    <div id="rjb-dropdown-menu-mobile"
                        class="hidden pl-4 bg-rjb-bg-light dark:bg-rjb-card-dark/70 rounded-md transition-colors duration-500">
                        <button id="nav-apresentacoes-mobile" onclick="navigateTo('apresentacoes')"
                            class="nav-link block w-full text-left px-3 py-2 text-sm text-rjb-text/90 dark:text-rjb-text-dark/90 hover:bg-rjb-yellow/20 dark:hover:bg-rjb-yellow/10 hover:text-rjb-text transition-colors">Performances
                            Oficiais</button>
                        <button id="nav-bastidores-mobile" onclick="navigateTo('bastidores')"
                            class="nav-link block w-full text-left px-3 py-2 text-sm text-rjb-text/90 dark:text-rjb-text-dark/90 hover:bg-rjb-yellow/20 dark:hover:bg-rjb-yellow/10 hover:text-rjb-text transition-colors">Bastidores
                            & Ensaios</button>
                        <button id="nav-repertorio-mobile" onclick="navigateTo('repertorio')"
                            class="nav-link block w-full text-left px-3 py-2 text-sm text-rjb-text/90 dark:text-rjb-text-dark/90 hover:bg-rjb-yellow/20 dark:hover:bg-rjb-yellow/10 hover:text-rjb-text transition-colors">Repert√≥rio</button>
                        <button id="nav-partituras-mobile" onclick="navigateTo('partituras')"
                            class="nav-link block w-full text-left px-3 py-2 text-sm text-rjb-text/90 dark:text-rjb-text-dark/90 hover:bg-rjb-yellow/20 dark:hover:bg-rjb-yellow/10 hover:text-rjb-text transition-colors">√Årea
                            de Partituras</button>
                        <button id="nav-fotos-mobile" onclick="navigateTo('fotos')"
                            class="nav-link block w-full text-left px-3 py-2 text-sm text-rjb-text/90 dark:text-rjb-text-dark/90 hover:bg-rjb-yellow/20 dark:hover:bg-rjb-yellow/10 hover:text-rjb-text transition-colors">Fotos</button>
                    </div>
                </div>

                <button id="nav-agenda-mobile" onclick="navigateTo('agenda')"
                    class="nav-link block w-full text-left px-3 py-2 rounded-md text-base font-medium text-rjb-text dark:text-rjb-text-dark hover:bg-gray-100 dark:hover:bg-rjb-bg-dark/10 hover:text-rjb-yellow transition-colors">Agenda</button>
                <button id="nav-contato-mobile" onclick="navigateTo('contato')"
                    class="nav-link block w-full text-left px-3 py-2 rounded-md text-base font-medium text-rjb-text dark:text-rjb-text-dark hover:bg-gray-100 dark:hover:bg-rjb-bg-dark/10 hover:text-rjb-yellow transition-colors">Contato</button>

                <button id="nav-relatorios-mobile" onclick="navigateTo('reports')"
                    class="nav-link block w-full text-left px-3 py-2 rounded-md text-base font-medium text-rjb-text dark:text-rjb-text-dark hover:bg-gray-100 dark:hover:bg-rjb-bg-dark/10 hover:text-rjb-yellow transition-colors">√Årea
                    Administrativa</button>

                <button id="nav-cadastro-mobile" onclick="navigateTo('member-registration')"
                    class="nav-link block w-full text-left mt-2 bg-rjb-yellow text-rjb-text font-bold py-2 px-3 rounded-md text-base hover:bg-yellow-500 transition-colors shadow-subtle-glow">Cadastro</button>
            </div>
        </div>
    </header>

    <main id="main-content" class="opacity-100 transition-opacity duration-500 pt-20">
    </main>

    <footer
        class="bg-rjb-card-light dark:bg-rjb-card-dark border-t border-rjb-yellow/20 mt-12 py-8 z-20 relative transition-colors duration-500">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="rjb-logo-text text-xl font-mono font-extrabold text-rjb-yellow">RJB</div>
            <p class="text-rjb-text/70 dark:text-rjb-text-dark/70 text-sm mt-1 mb-4">Racional Jazz Band &copy; 2025.
                Todos os direitos reservados.</p>
            <div class="space-x-4 text-rjb-text/50 dark:text-rjb-text-dark/50 text-sm">
                <button onclick="navigateTo('sobre')" class="hover:text-rjb-yellow transition-colors">Pol√≠tica de
                    Privacidade</button>
                <span>|</span>
                <button onclick="navigateTo('contato')" class="hover:text-rjb-yellow transition-colors">Termos de
                    Uso</button>
                <span>|</span>
                <button onclick="navigateTo('member-registration')"
                    class="hover:text-rjb-yellow transition-colors">Trabalhe
                    Conosco</button>
            </div>
        </div>
        <div id="audio-player-container" class="hidden"></div>
    </footer>

    <div id="image-modal" onclick="closeModal()"
        class="fixed inset-0 bg-black bg-opacity-90 z-[70] hidden flex items-center justify-center transition-opacity duration-300 opacity-0">
        <div onclick="event.stopPropagation()" class="max-w-7xl max-h-[90vh] mx-auto p-4 relative">
            <button onclick="closeModal()"
                class="absolute top-4 right-4 text-white hover:text-rjb-yellow transition-colors text-4xl font-light z-10 p-2">
                &times;
            </button>
            <img id="modal-image" src="" alt="Imagem Ampliada"
                class="max-h-[85vh] w-auto object-contain rounded-lg shadow-soft-glow">
        </div>
    </div>

    <div id="video-modal" onclick="closeVideoModal()"
        class="fixed inset-0 bg-black bg-opacity-95 z-[80] hidden flex items-center justify-center transition-opacity duration-300 opacity-0">
        <div onclick="event.stopPropagation()" class="w-full max-w-5xl mx-auto p-4 relative">
            <button onclick="closeVideoModal()"
                class="absolute -top-10 right-4 text-white hover:text-rjb-yellow text-4xl font-light z-10 p-2 transition-colors">&times;</button>

            <div
                class="relative w-full pt-[56.25%] bg-black rounded-lg shadow-soft-glow overflow-hidden border border-rjb-yellow/30">
                <iframe id="video-iframe" class="absolute top-0 left-0 w-full h-full" src=""
                    title="YouTube video player" frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    allowfullscreen>
                </iframe>
            </div>
        </div>
    </div>
    <div id="custom-message-box"
        class="hidden opacity-0 fixed top-5 left-1/2 transform -translate-x-1/2 bg-rjb-yellow text-rjb-text px-6 py-3 rounded-lg shadow-deep-shadow z-[60] transition-opacity duration-300">
        <p id="message-text" class="font-semibold"></p>
    </div>

    <div id="loading-overlay"
        class="fixed inset-0 bg-rjb-bg-light/90 dark:bg-rjb-bg-dark/90 z-[100] hidden items-center justify-center transition-opacity duration-300 opacity-0">
        <div class="flex flex-col items-center space-y-4">
            <svg class="animate-spin h-10 w-10 text-rjb-yellow" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                </path>
            </svg>
            <p id="loader-message" class="text-lg font-semibold text-rjb-text dark:text-rjb-text-dark">Carregando...</p>
        </div>
    </div>

    <div id="custom-message-box"
        class="hidden opacity-0 fixed top-5 left-1/2 transform -translate-x-1/2 bg-rjb-yellow text-rjb-text px-6 py-3 rounded-lg shadow-deep-shadow dark:shadow-soft-glow z-[60] transition-opacity duration-300">
        <p id="message-text" class="font-semibold"></p>
    </div>
    <div id="edit-member-modal" onclick="closeEditModal()"
        class="fixed inset-0 bg-black bg-opacity-80 z-[90] hidden flex items-center justify-center transition-opacity duration-300 opacity-0">
        <div onclick="event.stopPropagation()"
            class="w-full max-w-md mx-auto p-6 bg-rjb-card-light dark:bg-rjb-card-dark rounded-xl shadow-soft-glow border border-rjb-yellow/30 relative">
            <button onclick="closeEditModal()"
                class="absolute top-4 right-4 text-rjb-text/50 dark:text-rjb-text-dark/50 hover:text-rjb-yellow transition-colors text-2xl">&times;</button>
            <h3 class="text-2xl font-bold text-rjb-yellow mb-6">Editar Membro</h3>
            <form id="edit-member-form" onsubmit="submitEditMember(event)">
                <input type="hidden" id="edit-member-id">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1 opacity-70">Nome Completo</label>
                        <input type="text" id="edit-member-name" required onblur="normalizeNameField(this)"
                            class="w-full p-3 rounded-lg bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/20 text-rjb-text dark:text-rjb-text-dark outline-none focus:ring-2 focus:ring-rjb-yellow transition-all">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-1 opacity-70">TEFA</label>
                            <input type="text" id="edit-member-tefa" inputmode="numeric"
                                oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                                class="w-full p-3 rounded-lg bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/20 text-rjb-text dark:text-rjb-text-dark outline-none focus:ring-2 focus:ring-rjb-yellow transition-all">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1 opacity-70">Telefone</label>
                            <input type="text" id="edit-member-phone" required
                                class="w-full p-3 rounded-lg bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/20 text-rjb-text dark:text-rjb-text-dark outline-none focus:ring-2 focus:ring-rjb-yellow transition-all">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1 opacity-70">Instrumento / √Årea</label>
                        <input type="text" id="edit-member-instrument" required
                            class="w-full p-3 rounded-lg bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/20 text-rjb-text dark:text-rjb-text-dark outline-none focus:ring-2 focus:ring-rjb-yellow transition-all">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-1 opacity-70">Cidade</label>
                            <input type="text" id="edit-member-city" required
                                class="w-full p-3 rounded-lg bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/20 text-rjb-text dark:text-rjb-text-dark outline-none focus:ring-2 focus:ring-rjb-yellow transition-all">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1 opacity-70">Estado (UF)</label>
                            <input type="text" id="edit-member-state" required maxlength="2"
                                class="w-full p-3 rounded-lg bg-rjb-bg-light dark:bg-rjb-bg-dark border border-rjb-yellow/20 text-rjb-text dark:text-rjb-text-dark outline-none focus:ring-2 focus:ring-rjb-yellow transition-all">
                        </div>
                    </div>
                    <div class="flex space-x-3 pt-4">
                        <button type="button" onclick="closeEditModal()"
                            class="flex-1 py-3 rounded-lg border border-rjb-yellow/50 font-bold hover:bg-rjb-yellow/10 transition-colors">Cancelar</button>
                        <button type="submit"
                            class="flex-1 py-3 rounded-lg bg-rjb-yellow text-rjb-text font-bold hover:bg-yellow-500 shadow-subtle-glow transition-all">Salvar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div id="delete-confirm-modal" onclick="closeDeleteModal()"
        class="fixed inset-0 bg-black bg-opacity-80 z-[95] hidden flex items-center justify-center transition-opacity duration-300 opacity-0">
        <div onclick="event.stopPropagation()"
            class="w-full max-w-sm mx-auto p-6 bg-rjb-card-light dark:bg-rjb-card-dark rounded-xl border border-red-500/30 text-center">
            <div class="text-red-500 mb-4">
                <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z">
                    </path>
                </svg>
            </div>
            <h3 class="text-xl font-bold mb-2 text-red-600 dark:text-red-400">Confirmar Exclus√£o</h3>
            <p class="text-sm opacity-70 mb-4">Esta a√ß√£o n√£o pode ser desfeita. Deseja realmente excluir o membro:</p>
            <p class="text-base font-bold mb-4 text-rjb-text dark:text-rjb-text-dark bg-gray-100 dark:bg-gray-800 p-3 rounded-lg">
                <span id="delete-member-name"></span>
            </p>
            <div class="mb-4">
                <label for="confirm-delete-name" class="block text-sm font-medium mb-2 text-rjb-text dark:text-rjb-text-dark">
                    Digite o nome completo para confirmar:
                </label>
                <input type="text" id="confirm-delete-name" 
                    class="w-full p-3 rounded-lg bg-rjb-bg-light dark:bg-rjb-bg-dark border border-red-300 dark:border-red-600 text-rjb-text dark:text-rjb-text-dark focus:ring-2 focus:ring-red-500 transition-all"
                    placeholder="Digite o nome completo do membro">
                <p id="confirm-delete-error" class="hidden text-xs text-red-600 dark:text-red-400 mt-1">Os nomes n√£o coincidem</p>
            </div>
            <div class="flex space-x-3">
                <button onclick="closeDeleteModal()"
                    class="flex-1 py-2.5 rounded-lg bg-gray-200 dark:bg-gray-700 font-bold hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">Cancelar</button>
                <button id="confirm-delete-btn" disabled
                    class="flex-1 py-2.5 rounded-lg bg-red-600 text-white font-bold hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
                    Excluir Permanentemente
                </button>
            </div>
        </div>
    </div>

    <!-- Modais da √Årea Financeira -->
    
    <!-- Modal: Adicionar/Editar Contribui√ß√£o -->
    <div id="contribution-modal" onclick="closeContributionModal(event)" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-3 sm:p-4 overflow-y-auto">
        <div onclick="event.stopPropagation()" class="bg-rjb-card-light dark:bg-rjb-card-dark rounded-xl sm:rounded-2xl shadow-xl max-w-md w-full p-4 sm:p-6 my-4">
            <h3 class="text-xl sm:text-2xl font-bold text-green-600 mb-4" id="contribution-modal-title">Nova Contribui√ß√£o</h3>
            <form id="contribution-form" onsubmit="saveContribution(event)" class="space-y-4">
                <input type="hidden" id="contribution-id">
                <div>
                    <label class="block text-sm font-medium mb-1">Membro</label>
                    <select id="contribution-member-id" required class="w-full p-3 rounded-lg border border-green-600/30 bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text dark:text-rjb-text-dark">
                        <option value="">Selecione um membro</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">M√™s</label>
                    <select id="contribution-month" required class="w-full p-3 rounded-lg border border-green-600/30 bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text dark:text-rjb-text-dark">
                        <option value="">Selecione</option>
                        <option value="1">Janeiro</option>
                        <option value="2">Fevereiro</option>
                        <option value="3">Mar√ßo</option>
                        <option value="4">Abril</option>
                        <option value="5">Maio</option>
                        <option value="6">Junho</option>
                        <option value="7">Julho</option>
                        <option value="8">Agosto</option>
                        <option value="9">Setembro</option>
                        <option value="10">Outubro</option>
                        <option value="11">Novembro</option>
                        <option value="12">Dezembro</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Ano</label>
                    <input type="number" id="contribution-year" required min="2020" max="2100" class="w-full p-3 rounded-lg border border-green-600/30 bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text dark:text-rjb-text-dark">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Valor (R$) <span class="text-xs text-rjb-text/60 dark:text-rjb-text-dark/60">(Padr√£o: R$ 20,00)</span></label>
                    <input type="number" id="contribution-amount" required step="0.01" min="0" value="20.00" class="w-full p-3 rounded-lg border border-green-600/30 bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text dark:text-rjb-text-dark">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Status</label>
                    <select id="contribution-status" required class="w-full p-3 rounded-lg border border-green-600/30 bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text dark:text-rjb-text-dark">
                        <option value="pending">Pendente</option>
                        <option value="paid">Pago</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Comprovante (opcional)</label>
                    <input type="file" id="contribution-receipt" accept="image/*,.pdf" class="w-full p-3 rounded-lg border border-green-600/30 bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text dark:text-rjb-text-dark">
                    <p class="text-xs text-rjb-text/60 dark:text-rjb-text-dark/60 mt-1">Formatos aceitos: JPG, PNG, PDF</p>
                    <div id="contribution-receipt-preview" class="mt-2 hidden">
                        <a id="contribution-receipt-link" href="#" target="_blank" class="text-green-600 hover:underline">Ver comprovante atual</a>
                    </div>
                </div>
                <div class="flex gap-3">
                    <button type="button" onclick="closeContributionModal()" class="flex-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Adicionar/Editar Dep√≥sito -->
    <div id="deposit-modal" onclick="closeDepositModal(event)" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-3 sm:p-4 overflow-y-auto">
        <div onclick="event.stopPropagation()" class="bg-rjb-card-light dark:bg-rjb-card-dark rounded-xl sm:rounded-2xl shadow-xl max-w-md w-full p-4 sm:p-6 my-4">
            <h3 class="text-xl sm:text-2xl font-bold text-green-600 mb-4" id="deposit-modal-title">Novo Dep√≥sito</h3>
            <form id="deposit-form" onsubmit="saveDeposit(event)" class="space-y-4">
                <input type="hidden" id="deposit-id">
                <div>
                    <label class="block text-sm font-medium mb-1">Membro</label>
                    <select id="deposit-member-id" required class="w-full p-3 rounded-lg border border-green-600/30 bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text dark:text-rjb-text-dark">
                        <option value="">Selecione um membro</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Data do Dep√≥sito</label>
                    <input type="date" id="deposit-date" required class="w-full p-3 rounded-lg border border-green-600/30 bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text dark:text-rjb-text-dark">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Valor (R$)</label>
                    <input type="number" id="deposit-amount" required step="0.01" min="0" class="w-full p-3 rounded-lg border border-green-600/30 bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text dark:text-rjb-text-dark">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Descri√ß√£o (opcional)</label>
                    <textarea id="deposit-description" rows="2" class="w-full p-3 rounded-lg border border-green-600/30 bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text dark:text-rjb-text-dark"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Comprovante</label>
                    <input type="file" id="deposit-receipt" accept="image/*,.pdf" class="w-full p-3 rounded-lg border border-green-600/30 bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text dark:text-rjb-text-dark">
                    <p class="text-xs text-rjb-text/60 dark:text-rjb-text-dark/60 mt-1">Formatos aceitos: JPG, PNG, PDF</p>
                    <div id="deposit-receipt-preview" class="mt-2 hidden">
                        <a id="deposit-receipt-link" href="#" target="_blank" class="text-green-600 hover:underline">Ver comprovante atual</a>
                    </div>
                </div>
                <div class="flex gap-3">
                    <button type="button" onclick="closeDepositModal()" class="flex-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Adicionar/Editar Gasto -->
    <div id="expense-modal" onclick="closeExpenseModal(event)" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-3 sm:p-4 overflow-y-auto">
        <div onclick="event.stopPropagation()" class="bg-rjb-card-light dark:bg-rjb-card-dark rounded-xl sm:rounded-2xl shadow-xl max-w-md w-full p-4 sm:p-6 my-4">
            <h3 class="text-xl sm:text-2xl font-bold text-green-600 mb-4" id="expense-modal-title">Novo Gasto</h3>
            <form id="expense-form" onsubmit="saveExpense(event)" class="space-y-4">
                <input type="hidden" id="expense-id">
                <div>
                    <label class="block text-sm font-medium mb-1">Descri√ß√£o</label>
                    <input type="text" id="expense-description" required class="w-full p-3 rounded-lg border border-green-600/30 bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text dark:text-rjb-text-dark">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Valor (R$)</label>
                    <input type="number" id="expense-amount" required step="0.01" min="0" class="w-full p-3 rounded-lg border border-green-600/30 bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text dark:text-rjb-text-dark">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Data</label>
                    <input type="date" id="expense-date" required class="w-full p-3 rounded-lg border border-green-600/30 bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text dark:text-rjb-text-dark">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Categoria</label>
                    <select id="expense-category" class="w-full p-3 rounded-lg border border-green-600/30 bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text dark:text-rjb-text-dark">
                        <option value="lanche">Lanche</option>
                        <option value="transporte">Transporte</option>
                        <option value="equipamento">Equipamento</option>
                        <option value="evento">Evento</option>
                        <option value="outros">Outros</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Comprovante (opcional)</label>
                    <input type="file" id="expense-receipt" accept="image/*,.pdf" class="w-full p-3 rounded-lg border border-green-600/30 bg-rjb-bg-light dark:bg-rjb-bg-dark text-rjb-text dark:text-rjb-text-dark">
                    <p class="text-xs text-rjb-text/60 dark:text-rjb-text-dark/60 mt-1">Formatos aceitos: JPG, PNG, PDF</p>
                    <div id="expense-receipt-preview" class="mt-2 hidden">
                        <a id="expense-receipt-link" href="#" target="_blank" class="text-green-600 hover:underline">Ver comprovante atual</a>
                    </div>
                </div>
                <div class="flex gap-3">
                    <button type="button" onclick="closeExpenseModal()" class="flex-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                        Cancelar
                    </button>
                    <button type="submit" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Hist√≥rico Individual -->
    <div id="history-modal" onclick="closeHistoryModal(event)" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-3 sm:p-4 overflow-y-auto">
        <div onclick="event.stopPropagation()" class="bg-rjb-card-light dark:bg-rjb-card-dark rounded-xl sm:rounded-2xl shadow-xl max-w-3xl w-full p-4 sm:p-6 my-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-lg sm:text-xl md:text-2xl font-bold text-green-600 mb-4" id="history-modal-title">Hist√≥rico de Pagamentos</h3>
            <div id="history-content">
                <p class="text-center text-rjb-text/70 dark:text-rjb-text-dark/70">Carregando...</p>
            </div>
            <div class="mt-4">
                <button onclick="closeHistoryModal()" class="w-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                    Fechar
                </button>
            </div>
        </div>
    </div>

</body>

</html>